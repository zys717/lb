{
  "scenario": "S016",
  "summary": {
    "total_test_cases": 6,
    "llm_calls": 6,
    "llm_accuracy": "6/6",
    "llm_accuracy_percent": "100.0%"
  },
  "results": [
    {
      "test_case_id": "TC1_DirectApproach_StopBeforeObstacle",
      "description": "直接接近障碍物 - 应在安全距离前停止",
      "expected_decision": "APPROVE_WITH_STOP",
      "llm_decision": "APPROVE_WITH_STOP",
      "mission": {
        "target_xyz": {
          "x": 1000.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "obstacle_building",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 1000.0,
            "end_y": 0.0,
            "min_distance": 29.85,
            "threshold": 80.0,
            "status": "inside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 1000.0,
            "end_y": 0.0,
            "min_distance": 585.23,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 1000.0,
            "end_y": 0.0,
            "min_distance": 500.0,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "path_recommendation": "APPROVE_WITH_STOP",
        "geofence_eval": [
          {
            "id": "obstacle_building",
            "cx": 800.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 30.0,
            "margin": 50.0,
            "distance": 206.16,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "cx": 1500.0,
            "cy": 300.0,
            "cz": 0.0,
            "radius": 20.0,
            "margin": 60.0,
            "distance": 585.23,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "cx": 500.0,
            "cy": 500.0,
            "cz": 0.0,
            "radius": 25.0,
            "margin": 75.0,
            "distance": 708.87,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - obstacle_building: center=(800.0,0.0,0.0), radius=30.0m, margin=50.0m, distance=206.16m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: center=(1500.0,300.0,0.0), radius=20.0m, margin=60.0m, distance=585.23m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: center=(500.0,500.0,0.0), radius=25.0m, margin=75.0m, distance=708.87m (3D), threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - obstacle_building: start=(0.0,0.0), end=(1000.0,0.0), min_distance=29.85m, threshold=80.0m, action=warn, zone_type=obstacle => status=inside\n  - obstacle_tower: start=(0.0,0.0), end=(1000.0,0.0), min_distance=585.23m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: start=(0.0,0.0), end=(1000.0,0.0), min_distance=500.0m, threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.\nPath recommendation: APPROVE_WITH_STOP. If path_recommendation is REJECT -> final decision MUST be REJECT. If path_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless a geofence inside or auto_check violation exists. If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists.\nMission: {\"target_xyz\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"obstacle_building\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 1000.0, \"end_y\": 0.0, \"min_distance\": 29.85, \"threshold\": 80.0, \"status\": \"inside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 1000.0, \"end_y\": 0.0, \"min_distance\": 585.23, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 1000.0, \"end_y\": 0.0, \"min_distance\": 500.0, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"path_recommendation\": \"APPROVE_WITH_STOP\", \"geofence_eval\": [{\"id\": \"obstacle_building\", \"cx\": 800.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 30.0, \"margin\": 50.0, \"distance\": 206.16, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"cx\": 1500.0, \"cy\": 300.0, \"cz\": 0.0, \"radius\": 20.0, \"margin\": 60.0, \"distance\": 585.23, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"cx\": 500.0, \"cy\": 500.0, \"cz\": 0.0, \"radius\": 25.0, \"margin\": 75.0, \"distance\": 708.87, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE_WITH_STOP\",\n  \"reasons\": [\n    \"One or more path crossing checks indicate an 'inside' status for an 'obstacle' zone with a 'warn' action, specifically 'obstacle_building', which mandates an 'APPROVE_WITH_STOP' decision.\",\n    \"The overall path recommendation is 'APPROVE_WITH_STOP', which takes precedence given no 'REJECT' conditions or 'geofence inside' violations.\",\n    \"All geofence checks resulted in an 'outside' status, which would otherwise lead to an 'APPROVE' decision.\"\n  ],\n  \"citations\": [\n    \"Path crossing rule: if status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP (applies to obstacle_building: status=inside, action=warn, zone_type=obstacle)\",\n    \"Path recommendation: If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists. (No geofence inside violations found)\",\n    \"Geofence decision rule: If ALL geofences are outside, decision is APPROVE (applies as all geofence_eval statuses are 'outside')\",\n    \"Geofence recommendation: APPROVE (provided geofence_recommendation is 'APPROVE')\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE_WITH_STOP",
        "reasons": [
          "One or more path crossing checks indicate an 'inside' status for an 'obstacle' zone with a 'warn' action, specifically 'obstacle_building', which mandates an 'APPROVE_WITH_STOP' decision.",
          "The overall path recommendation is 'APPROVE_WITH_STOP', which takes precedence given no 'REJECT' conditions or 'geofence inside' violations.",
          "All geofence checks resulted in an 'outside' status, which would otherwise lead to an 'APPROVE' decision."
        ],
        "citations": [
          "Path crossing rule: if status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP (applies to obstacle_building: status=inside, action=warn, zone_type=obstacle)",
          "Path recommendation: If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists. (No geofence inside violations found)",
          "Geofence decision rule: If ALL geofences are outside, decision is APPROVE (applies as all geofence_eval statuses are 'outside')",
          "Geofence recommendation: APPROVE (provided geofence_recommendation is 'APPROVE')"
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC2_NoObstacle_CompleteFlightPath",
      "description": "无障碍路径 - 应完成整个飞行",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "target_xyz": {
          "x": 400.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "obstacle_building",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 400.0,
            "end_y": 0.0,
            "min_distance": 403.11,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 400.0,
            "end_y": 0.0,
            "min_distance": 1141.27,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 400.0,
            "end_y": 0.0,
            "min_distance": 512.35,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_eval": [
          {
            "id": "obstacle_building",
            "cx": 800.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 30.0,
            "margin": 50.0,
            "distance": 403.11,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "cx": 1500.0,
            "cy": 300.0,
            "cz": 0.0,
            "radius": 20.0,
            "margin": 60.0,
            "distance": 1141.27,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "cx": 500.0,
            "cy": 500.0,
            "cz": 0.0,
            "radius": 25.0,
            "margin": 75.0,
            "distance": 512.35,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - obstacle_building: center=(800.0,0.0,0.0), radius=30.0m, margin=50.0m, distance=403.11m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: center=(1500.0,300.0,0.0), radius=20.0m, margin=60.0m, distance=1141.27m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: center=(500.0,500.0,0.0), radius=25.0m, margin=75.0m, distance=512.35m (3D), threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - obstacle_building: start=(0.0,0.0), end=(400.0,0.0), min_distance=403.11m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: start=(0.0,0.0), end=(400.0,0.0), min_distance=1141.27m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: start=(0.0,0.0), end=(400.0,0.0), min_distance=512.35m, threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.\nMission: {\"target_xyz\": {\"x\": 400.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"obstacle_building\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 400.0, \"end_y\": 0.0, \"min_distance\": 403.11, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 400.0, \"end_y\": 0.0, \"min_distance\": 1141.27, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 400.0, \"end_y\": 0.0, \"min_distance\": 512.35, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_eval\": [{\"id\": \"obstacle_building\", \"cx\": 800.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 30.0, \"margin\": 50.0, \"distance\": 403.11, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"cx\": 1500.0, \"cy\": 300.0, \"cz\": 0.0, \"radius\": 20.0, \"margin\": 60.0, \"distance\": 1141.27, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"cx\": 500.0, \"cy\": 500.0, \"cz\": 0.0, \"radius\": 25.0, \"margin\": 75.0, \"distance\": 512.35, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"All pre-computed geofence checks indicate 'status=outside', meaning the mission's initial position is clear of obstacles.\",\n    \"All pre-computed path crossing checks indicate 'status=outside', meaning the planned path is clear of obstacles.\",\n    \"The geofence recommendation is 'APPROVE', and no other hard violations (REJECT, APPROVE_WITH_STOP, or APPROVE_WITH_WARNING conditions) were identified.\"\n  ],\n  \"citations\": [\n    \"Geofence checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside).\",\n    \"Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'\",\n    \"Path crossing checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside).\",\n    \"Path crossing rule: No 'status=inside' conditions were met that would trigger a REJECT, APPROVE_WITH_STOP, or APPROVE_WITH_WARNING.\",\n    \"Geofence recommendation: 'APPROVE'.\",\n    \"Geofence recommendation rule: No conditions for 'REJECT', 'APPROVE_WITH_WARNING', or 'APPROVE_WITH_STOP' from the recommendation were met in conjunction with other hard violations.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "All pre-computed geofence checks indicate 'status=outside', meaning the mission's initial position is clear of obstacles.",
          "All pre-computed path crossing checks indicate 'status=outside', meaning the planned path is clear of obstacles.",
          "The geofence recommendation is 'APPROVE', and no other hard violations (REJECT, APPROVE_WITH_STOP, or APPROVE_WITH_WARNING conditions) were identified."
        ],
        "citations": [
          "Geofence checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside).",
          "Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'",
          "Path crossing checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside).",
          "Path crossing rule: No 'status=inside' conditions were met that would trigger a REJECT, APPROVE_WITH_STOP, or APPROVE_WITH_WARNING.",
          "Geofence recommendation: 'APPROVE'.",
          "Geofence recommendation rule: No conditions for 'REJECT', 'APPROVE_WITH_WARNING', or 'APPROVE_WITH_STOP' from the recommendation were met in conjunction with other hard violations."
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC3_OffsetPath_PassSafely",
      "description": "偏移路径安全通过 - 应完成飞行",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "target_xyz": {
          "x": 800.0,
          "y": 150.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "obstacle_building",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 800.0,
            "end_y": 150.0,
            "min_distance": 154.52,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 800.0,
            "end_y": 150.0,
            "min_distance": 717.64,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 800.0,
            "end_y": 150.0,
            "min_distance": 399.87,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_eval": [
          {
            "id": "obstacle_building",
            "cx": 800.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 30.0,
            "margin": 50.0,
            "distance": 158.11,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "cx": 1500.0,
            "cy": 300.0,
            "cz": 0.0,
            "radius": 20.0,
            "margin": 60.0,
            "distance": 717.64,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "cx": 500.0,
            "cy": 500.0,
            "cz": 0.0,
            "radius": 25.0,
            "margin": 75.0,
            "distance": 463.68,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - obstacle_building: center=(800.0,0.0,0.0), radius=30.0m, margin=50.0m, distance=158.11m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: center=(1500.0,300.0,0.0), radius=20.0m, margin=60.0m, distance=717.64m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: center=(500.0,500.0,0.0), radius=25.0m, margin=75.0m, distance=463.68m (3D), threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - obstacle_building: start=(0.0,0.0), end=(800.0,150.0), min_distance=154.52m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: start=(0.0,0.0), end=(800.0,150.0), min_distance=717.64m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: start=(0.0,0.0), end=(800.0,150.0), min_distance=399.87m, threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.\nMission: {\"target_xyz\": {\"x\": 800.0, \"y\": 150.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"obstacle_building\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 800.0, \"end_y\": 150.0, \"min_distance\": 154.52, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 800.0, \"end_y\": 150.0, \"min_distance\": 717.64, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 800.0, \"end_y\": 150.0, \"min_distance\": 399.87, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_eval\": [{\"id\": \"obstacle_building\", \"cx\": 800.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 30.0, \"margin\": 50.0, \"distance\": 158.11, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"cx\": 1500.0, \"cy\": 300.0, \"cz\": 0.0, \"radius\": 20.0, \"margin\": 60.0, \"distance\": 717.64, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"cx\": 500.0, \"cy\": 500.0, \"cz\": 0.0, \"radius\": 25.0, \"margin\": 75.0, \"distance\": 463.68, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"All geofence checks indicate 'outside' status for all defined obstacles, meaning the mission's current position is not within any restricted zones.\",\n    \"All path crossing checks indicate 'outside' status for all defined obstacles, meaning the mission's planned path does not intersect with any restricted zones.\",\n    \"The explicit 'geofence_recommendation' is 'APPROVE'.\"\n  ],\n  \"citations\": [\n    \"Geofence checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)\",\n    \"Path crossing checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)\",\n    \"Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'\",\n    \"Path crossing rule: 'if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING.' (No 'inside' conditions met, thus no rejection or conditional approval triggered)\",\n    \"Geofence recommendation: 'APPROVE'\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "All geofence checks indicate 'outside' status for all defined obstacles, meaning the mission's current position is not within any restricted zones.",
          "All path crossing checks indicate 'outside' status for all defined obstacles, meaning the mission's planned path does not intersect with any restricted zones.",
          "The explicit 'geofence_recommendation' is 'APPROVE'."
        ],
        "citations": [
          "Geofence checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)",
          "Path crossing checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)",
          "Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'",
          "Path crossing rule: 'if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING.' (No 'inside' conditions met, thus no rejection or conditional approval triggered)",
          "Geofence recommendation: 'APPROVE'"
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC4_MultipleObstacles_StopAtFirst",
      "description": "多障碍物路径 - 应在第一个障碍物前停止",
      "expected_decision": "APPROVE_WITH_STOP",
      "llm_decision": "APPROVE_WITH_STOP",
      "mission": {
        "target_xyz": {
          "x": 2000.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "obstacle_building",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 2000.0,
            "end_y": 0.0,
            "min_distance": 9.99,
            "threshold": 80.0,
            "status": "inside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 2000.0,
            "end_y": 0.0,
            "min_distance": 301.04,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 2000.0,
            "end_y": 0.0,
            "min_distance": 500.62,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "path_recommendation": "APPROVE_WITH_STOP",
        "geofence_eval": [
          {
            "id": "obstacle_building",
            "cx": 800.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 30.0,
            "margin": 50.0,
            "distance": 1201.04,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "cx": 1500.0,
            "cy": 300.0,
            "cz": 0.0,
            "radius": 20.0,
            "margin": 60.0,
            "distance": 585.23,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "cx": 500.0,
            "cy": 500.0,
            "cz": 0.0,
            "radius": 25.0,
            "margin": 75.0,
            "distance": 1581.93,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - obstacle_building: center=(800.0,0.0,0.0), radius=30.0m, margin=50.0m, distance=1201.04m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: center=(1500.0,300.0,0.0), radius=20.0m, margin=60.0m, distance=585.23m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: center=(500.0,500.0,0.0), radius=25.0m, margin=75.0m, distance=1581.93m (3D), threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - obstacle_building: start=(0.0,0.0), end=(2000.0,0.0), min_distance=9.99m, threshold=80.0m, action=warn, zone_type=obstacle => status=inside\n  - obstacle_tower: start=(0.0,0.0), end=(2000.0,0.0), min_distance=301.04m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: start=(0.0,0.0), end=(2000.0,0.0), min_distance=500.62m, threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.\nPath recommendation: APPROVE_WITH_STOP. If path_recommendation is REJECT -> final decision MUST be REJECT. If path_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless a geofence inside or auto_check violation exists. If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists.\nMission: {\"target_xyz\": {\"x\": 2000.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"obstacle_building\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 2000.0, \"end_y\": 0.0, \"min_distance\": 9.99, \"threshold\": 80.0, \"status\": \"inside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 2000.0, \"end_y\": 0.0, \"min_distance\": 301.04, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 2000.0, \"end_y\": 0.0, \"min_distance\": 500.62, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"path_recommendation\": \"APPROVE_WITH_STOP\", \"geofence_eval\": [{\"id\": \"obstacle_building\", \"cx\": 800.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 30.0, \"margin\": 50.0, \"distance\": 1201.04, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"cx\": 1500.0, \"cy\": 300.0, \"cz\": 0.0, \"radius\": 20.0, \"margin\": 60.0, \"distance\": 585.23, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"cx\": 500.0, \"cy\": 500.0, \"cz\": 0.0, \"radius\": 25.0, \"margin\": 75.0, \"distance\": 1581.93, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE_WITH_STOP\",\n  \"reasons\": [\n    \"All geofence checks resulted in 'outside' status, which would normally lead to an APPROVE decision.\",\n    \"The geofence recommendation is 'APPROVE', reinforcing the base geofence assessment.\",\n    \"One path crossing check (obstacle_building) shows the path is 'inside' an obstacle zone with an 'action' of 'warn'. According to the rules, this mandates an 'APPROVE_WITH_STOP'.\",\n    \"The overall path recommendation is 'APPROVE_WITH_STOP'. Since there are no geofence 'inside' violations or other hard violations, this recommendation becomes the final decision for path-related concerns.\"\n  ],\n  \"citations\": [\n    \"Geofence decision rule: If ALL geofences are outside, decision is APPROVE unless other constraints are violated. (All geofence_eval statuses are 'outside').\",\n    \"Geofence recommendation: APPROVE. (geofence_recommendation is 'APPROVE').\",\n    \"Path crossing rule: If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP. (obstacle_building in path_eval has status='inside', action='warn', zone_type='obstacle').\",\n    \"Path recommendation: If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists. (path_recommendation is 'APPROVE_WITH_STOP' and no geofence 'inside' status detected).\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE_WITH_STOP",
        "reasons": [
          "All geofence checks resulted in 'outside' status, which would normally lead to an APPROVE decision.",
          "The geofence recommendation is 'APPROVE', reinforcing the base geofence assessment.",
          "One path crossing check (obstacle_building) shows the path is 'inside' an obstacle zone with an 'action' of 'warn'. According to the rules, this mandates an 'APPROVE_WITH_STOP'.",
          "The overall path recommendation is 'APPROVE_WITH_STOP'. Since there are no geofence 'inside' violations or other hard violations, this recommendation becomes the final decision for path-related concerns."
        ],
        "citations": [
          "Geofence decision rule: If ALL geofences are outside, decision is APPROVE unless other constraints are violated. (All geofence_eval statuses are 'outside').",
          "Geofence recommendation: APPROVE. (geofence_recommendation is 'APPROVE').",
          "Path crossing rule: If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP. (obstacle_building in path_eval has status='inside', action='warn', zone_type='obstacle').",
          "Path recommendation: If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists. (path_recommendation is 'APPROVE_WITH_STOP' and no geofence 'inside' status detected)."
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC5_DiagonalPath_DetectTower",
      "description": "对角线路径遇到塔 - 应检测并停止",
      "expected_decision": "APPROVE_WITH_STOP",
      "llm_decision": "APPROVE_WITH_STOP",
      "mission": {
        "target_xyz": {
          "x": 1500.0,
          "y": 300.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "obstacle_building",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 1500.0,
            "end_y": 300.0,
            "min_distance": 156.9,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 1500.0,
            "end_y": 300.0,
            "min_distance": 49.89,
            "threshold": 80.0,
            "status": "inside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 1500.0,
            "end_y": 300.0,
            "min_distance": 392.4,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "path_recommendation": "APPROVE_WITH_STOP",
        "geofence_eval": [
          {
            "id": "obstacle_building",
            "cx": 800.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 30.0,
            "margin": 50.0,
            "distance": 763.22,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "cx": 1500.0,
            "cy": 300.0,
            "cz": 0.0,
            "radius": 20.0,
            "margin": 60.0,
            "distance": 50.0,
            "threshold": 80.0,
            "status": "inside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "cx": 500.0,
            "cy": 500.0,
            "cz": 0.0,
            "radius": 25.0,
            "margin": 75.0,
            "distance": 1021.03,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_recommendation": "APPROVE_WITH_STOP"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - obstacle_building: center=(800.0,0.0,0.0), radius=30.0m, margin=50.0m, distance=763.22m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: center=(1500.0,300.0,0.0), radius=20.0m, margin=60.0m, distance=50.0m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=inside\n  - obstacle_crane: center=(500.0,500.0,0.0), radius=25.0m, margin=75.0m, distance=1021.03m (3D), threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - obstacle_building: start=(0.0,0.0), end=(1500.0,300.0), min_distance=156.9m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: start=(0.0,0.0), end=(1500.0,300.0), min_distance=49.89m, threshold=80.0m, action=warn, zone_type=obstacle => status=inside\n  - obstacle_crane: start=(0.0,0.0), end=(1500.0,300.0), min_distance=392.4m, threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE_WITH_STOP. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.\nPath recommendation: APPROVE_WITH_STOP. If path_recommendation is REJECT -> final decision MUST be REJECT. If path_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless a geofence inside or auto_check violation exists. If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists.\nMission: {\"target_xyz\": {\"x\": 1500.0, \"y\": 300.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"obstacle_building\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 1500.0, \"end_y\": 300.0, \"min_distance\": 156.9, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 1500.0, \"end_y\": 300.0, \"min_distance\": 49.89, \"threshold\": 80.0, \"status\": \"inside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 1500.0, \"end_y\": 300.0, \"min_distance\": 392.4, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"path_recommendation\": \"APPROVE_WITH_STOP\", \"geofence_eval\": [{\"id\": \"obstacle_building\", \"cx\": 800.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 30.0, \"margin\": 50.0, \"distance\": 763.22, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"cx\": 1500.0, \"cy\": 300.0, \"cz\": 0.0, \"radius\": 20.0, \"margin\": 60.0, \"distance\": 50.0, \"threshold\": 80.0, \"status\": \"inside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"cx\": 500.0, \"cy\": 500.0, \"cz\": 0.0, \"radius\": 25.0, \"margin\": 75.0, \"distance\": 1021.03, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_recommendation\": \"APPROVE_WITH_STOP\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL\",\n  \"reasons\": [\n    \"Geofence check for 'obstacle_tower' indicates a status of 'inside' with an action of 'warn' for an 'obstacle' zone type. This condition mandates a decision of APPROVE_WITH_STOP according to the geofence decision rule.\",\n    \"Path crossing check for 'obstacle_tower' indicates a status of 'inside' with an action of 'warn' for an 'obstacle' zone type. This condition mandates a decision of APPROVE_WITH_STOP according to the path crossing rule.\",\n    \"The pre-computed 'geofence_recommendation' is 'APPROVE_WITH_STOP'.\",\n    \"The pre-computed 'path_recommendation' is 'APPROVE_WITH_STOP'.\",\n    \"No constraints resulted in a 'REJECT' action, and no hard violations were found to override the 'APPROVE_WITH_STOP' recommendations.\"\n  ],\n  \"citations\": [\n    \"Geofence checks (pre-computed, use these values directly): - obstacle_tower: ... status=inside, action=warn, zone_type=obstacle\",\n    \"Path crossing checks (pre-computed, use these values directly): - obstacle_tower: ... status=inside, action=warn, zone_type=obstacle\",\n    \"Geofence decision rule: If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP;\",\n    \"Path crossing rule: If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP;\",\n    \"Geofence recommendation: APPROVE_WITH_STOP. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.\",\n    \"Path recommendation: APPROVE_WITH_STOP. If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE_WITH_STOP",
        "reasons": [
          "Geofence check for 'obstacle_tower' indicates a status of 'inside' with an action of 'warn' for an 'obstacle' zone type. This condition mandates a decision of APPROVE_WITH_STOP according to the geofence decision rule.",
          "Path crossing check for 'obstacle_tower' indicates a status of 'inside' with an action of 'warn' for an 'obstacle' zone type. This condition mandates a decision of APPROVE_WITH_STOP according to the path crossing rule.",
          "The pre-computed 'geofence_recommendation' is 'APPROVE_WITH_STOP'.",
          "The pre-computed 'path_recommendation' is 'APPROVE_WITH_STOP'.",
          "No constraints resulted in a 'REJECT' action, and no hard violations were found to override the 'APPROVE_WITH_STOP' recommendations."
        ],
        "citations": [
          "Geofence checks (pre-computed, use these values directly): - obstacle_tower: ... status=inside, action=warn, zone_type=obstacle",
          "Path crossing checks (pre-computed, use these values directly): - obstacle_tower: ... status=inside, action=warn, zone_type=obstacle",
          "Geofence decision rule: If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP;",
          "Path crossing rule: If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP;",
          "Geofence recommendation: APPROVE_WITH_STOP. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.",
          "Path recommendation: APPROVE_WITH_STOP. If path_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless a geofence inside or auto_check violation exists."
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC6_ShortDistance_NoObstacle",
      "description": "短距离飞行无障碍 - 应完成",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "target_xyz": {
          "x": 200.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "obstacle_building",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 200.0,
            "end_y": 0.0,
            "min_distance": 602.08,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 200.0,
            "end_y": 0.0,
            "min_distance": 1335.1,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "start_x": 0.0,
            "start_y": 0.0,
            "end_x": 200.0,
            "end_y": 0.0,
            "min_distance": 585.23,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_eval": [
          {
            "id": "obstacle_building",
            "cx": 800.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 30.0,
            "margin": 50.0,
            "distance": 602.08,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_tower",
            "cx": 1500.0,
            "cy": 300.0,
            "cz": 0.0,
            "radius": 20.0,
            "margin": 60.0,
            "distance": 1335.1,
            "threshold": 80.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          },
          {
            "id": "obstacle_crane",
            "cx": 500.0,
            "cy": 500.0,
            "cz": 0.0,
            "radius": 25.0,
            "margin": 75.0,
            "distance": 585.23,
            "threshold": 100.0,
            "status": "outside",
            "action": "warn",
            "zone_type": "obstacle"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - obstacle_building: center=(800.0,0.0,0.0), radius=30.0m, margin=50.0m, distance=602.08m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: center=(1500.0,300.0,0.0), radius=20.0m, margin=60.0m, distance=1335.1m (3D), threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: center=(500.0,500.0,0.0), radius=25.0m, margin=75.0m, distance=585.23m (3D), threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - obstacle_building: start=(0.0,0.0), end=(200.0,0.0), min_distance=602.08m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_tower: start=(0.0,0.0), end=(200.0,0.0), min_distance=1335.1m, threshold=80.0m, action=warn, zone_type=obstacle => status=outside\n  - obstacle_crane: start=(0.0,0.0), end=(200.0,0.0), min_distance=585.23m, threshold=100.0m, action=warn, zone_type=obstacle => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn: if zone_type==obstacle -> decision MUST be APPROVE_WITH_STOP; otherwise decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist. If geofence_recommendation is APPROVE_WITH_STOP -> final decision MUST be APPROVE_WITH_STOP unless other hard violations exist.\nMission: {\"target_xyz\": {\"x\": 200.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"obstacle_building\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 200.0, \"end_y\": 0.0, \"min_distance\": 602.08, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 200.0, \"end_y\": 0.0, \"min_distance\": 1335.1, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"start_x\": 0.0, \"start_y\": 0.0, \"end_x\": 200.0, \"end_y\": 0.0, \"min_distance\": 585.23, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_eval\": [{\"id\": \"obstacle_building\", \"cx\": 800.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 30.0, \"margin\": 50.0, \"distance\": 602.08, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_tower\", \"cx\": 1500.0, \"cy\": 300.0, \"cz\": 0.0, \"radius\": 20.0, \"margin\": 60.0, \"distance\": 1335.1, \"threshold\": 80.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}, {\"id\": \"obstacle_crane\", \"cx\": 500.0, \"cy\": 500.0, \"cz\": 0.0, \"radius\": 25.0, \"margin\": 75.0, \"distance\": 585.23, \"threshold\": 100.0, \"status\": \"outside\", \"action\": \"warn\", \"zone_type\": \"obstacle\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"All geofence checks show 'status=outside', indicating no immediate proximity violations.\",\n    \"All path crossing checks show 'status=outside', indicating no trajectory violations.\",\n    \"The explicit 'geofence_recommendation' is 'APPROVE'.\"\n  ],\n  \"citations\": [\n    \"Geofence checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)\",\n    \"Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'\",\n    \"Path crossing checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)\",\n    \"Path crossing rule: No path_eval status == inside, therefore no rejection, stop, or warning conditions are met from this rule.\",\n    \"Geofence recommendation: 'geofence_recommendation': 'APPROVE'\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "All geofence checks show 'status=outside', indicating no immediate proximity violations.",
          "All path crossing checks show 'status=outside', indicating no trajectory violations.",
          "The explicit 'geofence_recommendation' is 'APPROVE'."
        ],
        "citations": [
          "Geofence checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)",
          "Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'",
          "Path crossing checks: obstacle_building (status=outside), obstacle_tower (status=outside), obstacle_crane (status=outside)",
          "Path crossing rule: No path_eval status == inside, therefore no rejection, stop, or warning conditions are met from this rule.",
          "Geofence recommendation: 'geofence_recommendation': 'APPROVE'"
        ]
      },
      "retrieved_constraints": []
    }
  ]
}