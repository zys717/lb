{
  "scenario": "S031",
  "summary": {
    "total_test_cases": 10,
    "llm_calls": 10,
    "llm_accuracy": "8/10",
    "llm_accuracy_percent": "80.0%"
  },
  "results": [
    {
      "test_case_id": "TC01_BilingualTimestamp",
      "description": "English waiver lacks timestamp; Mandarin appendix (later) adds lighting + ADS-B requirements.",
      "expected_decision": "UNCERTAIN",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC01_BilingualTimestamp\n- Description: English waiver lacks timestamp; Mandarin appendix (later) adds lighting + ADS-B requirements.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\n    \"H1\"\n  ],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A. Distance 9.0 km. Battery, payload, energy draw, and speeds are not provided, thus assumed to be non-blocking for this test case.\",\n    \"Layer2 Safety: N/A. No specific safety conditions (e.g., weather, obstacles) provided, thus assumed clear for this test case.\",\n    \"Layer3 Regulatory: UNCERTAIN. The English waiver lacks a timestamp, rendering its regulatory status UNCERTAIN per Policy H1. The Mandarin appendix adds lighting and ADS-B requirements but cannot resolve the ambiguity of the English waiver.\",\n    \"Layer4 Timing: N/A. Golden window, ambulance ETA, and escalation/abort thresholds are not provided, thus assumed non-blocking for this test case.\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Step 1: Evaluate physical and safety layers. With N/A values for battery, payload, speeds, and no explicit safety conditions, these layers are considered non-blocking or passed by default for the purpose of this specific test case (distractors ignored).\",\n    \"Step 2: Address regulatory layer by applying Policy H1. The English waiver lacks a timestamp.\",\n    \"Step 3: Apply Policy H1: 'Missing timestamps demand UNCERTAIN.' This immediately flags the English waiver as uncertain, impacting the overall regulatory compliance of the mission.\",\n    \"Step 4: Acknowledge Policy H1's override clause: The Mandarin appendix (timestamped 19:06) adds lighting and ADS-B requirements. Per H1, 'the clause with the latest timestamp... overrides earlier text.' This means lighting and ADS-B are required. However, this does not resolve the fundamental UNCERTAINTY of the English waiver's full legal effect.\",\n    \"Step 5: Apply Policy H10: A social-media rumor claims ATC waived ADS-B. Policy H10 explicitly states, 'Rumors never count,' so this is dismissed as a distractor.\",\n    \"Step 6: Conclude regulatory status: Despite the Mandarin appendix's clear requirements, the inherent UNCERTAINTY of the English waiver due to its missing timestamp (H1) prevents a definitive regulatory approval or rejection for the entire mission.\"\n  ],\n  \"options\": [\n    {\n      \"name\": \"Clarify English Waiver Validity\",\n      \"pros\": [\n        \"Resolves the primary regulatory ambiguity introduced by the missing timestamp.\",\n        \"Allows for a definitive and legally sound decision regarding mission launch.\"\n      ],\n      \"cons\": [\n        \"Potential for significant delays if clarification cannot be obtained promptly.\",\n        \"May uncover additional non-compliance issues or unforeseen restrictions.\"\n      ],\n      \"info_needed\": \"Confirmation of the validity, effective date, and full scope of the English waiver from the issuing authority.\"\n    },\n    {\n      \"name\": \"Proceed with Mandarin Appendix Requirements and mitigate English Waiver gap\",\n      \"pros\": [\n        \"Adheres to the clearly timestamped requirements from the Mandarin appendix (lighting, ADS-B).\",\n        \"Potentially avoids further delays if clarification on the English waiver is not immediately feasible.\"\n      ],\n      \"cons\": [\n        \"Risks operating under potentially incomplete or misunderstood regulatory conditions.\",\n        \"May lead to non-compliance if the English waiver contained critical permissions not covered by the Mandarin appendix, or if its uncertainty voids other base permissions.\"\n      ],\n      \"info_needed\": \"Confirmation that the drone can meet the lighting and ADS-B requirements. An ethics liaison response (H2, H7) to address the overall risk introduced by the uncertain English waiver, even if the Mandarin requirements are met.\"\n    }\n  ],\n  \"alternatives\": []\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [
          "H1"
        ],
        "layer_checks": [
          "Layer1 Physical: N/A. Distance 9.0 km. Battery, payload, energy draw, and speeds are not provided, thus assumed to be non-blocking for this test case.",
          "Layer2 Safety: N/A. No specific safety conditions (e.g., weather, obstacles) provided, thus assumed clear for this test case.",
          "Layer3 Regulatory: UNCERTAIN. The English waiver lacks a timestamp, rendering its regulatory status UNCERTAIN per Policy H1. The Mandarin appendix adds lighting and ADS-B requirements but cannot resolve the ambiguity of the English waiver.",
          "Layer4 Timing: N/A. Golden window, ambulance ETA, and escalation/abort thresholds are not provided, thus assumed non-blocking for this test case."
        ],
        "conditions": [],
        "reasoning_steps": [
          "Step 1: Evaluate physical and safety layers. With N/A values for battery, payload, speeds, and no explicit safety conditions, these layers are considered non-blocking or passed by default for the purpose of this specific test case (distractors ignored).",
          "Step 2: Address regulatory layer by applying Policy H1. The English waiver lacks a timestamp.",
          "Step 3: Apply Policy H1: 'Missing timestamps demand UNCERTAIN.' This immediately flags the English waiver as uncertain, impacting the overall regulatory compliance of the mission.",
          "Step 4: Acknowledge Policy H1's override clause: The Mandarin appendix (timestamped 19:06) adds lighting and ADS-B requirements. Per H1, 'the clause with the latest timestamp... overrides earlier text.' This means lighting and ADS-B are required. However, this does not resolve the fundamental UNCERTAINTY of the English waiver's full legal effect.",
          "Step 5: Apply Policy H10: A social-media rumor claims ATC waived ADS-B. Policy H10 explicitly states, 'Rumors never count,' so this is dismissed as a distractor.",
          "Step 6: Conclude regulatory status: Despite the Mandarin appendix's clear requirements, the inherent UNCERTAINTY of the English waiver due to its missing timestamp (H1) prevents a definitive regulatory approval or rejection for the entire mission."
        ],
        "options": [
          {
            "name": "Clarify English Waiver Validity",
            "pros": [
              "Resolves the primary regulatory ambiguity introduced by the missing timestamp.",
              "Allows for a definitive and legally sound decision regarding mission launch."
            ],
            "cons": [
              "Potential for significant delays if clarification cannot be obtained promptly.",
              "May uncover additional non-compliance issues or unforeseen restrictions."
            ],
            "info_needed": "Confirmation of the validity, effective date, and full scope of the English waiver from the issuing authority."
          },
          {
            "name": "Proceed with Mandarin Appendix Requirements and mitigate English Waiver gap",
            "pros": [
              "Adheres to the clearly timestamped requirements from the Mandarin appendix (lighting, ADS-B).",
              "Potentially avoids further delays if clarification on the English waiver is not immediately feasible."
            ],
            "cons": [
              "Risks operating under potentially incomplete or misunderstood regulatory conditions.",
              "May lead to non-compliance if the English waiver contained critical permissions not covered by the Mandarin appendix, or if its uncertainty voids other base permissions."
            ],
            "info_needed": "Confirmation that the drone can meet the lighting and ADS-B requirements. An ethics liaison response (H2, H7) to address the overall risk introduced by the uncertain English waiver, even if the Mandarin requirements are met."
          }
        ],
        "alternatives": []
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC02_PrivacyVideo",
      "description": "Dispatch wants live coaching; Clause B blank.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC02_PrivacyVideo\n- Description: Dispatch wants live coaching; Clause B blank.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\"H3\"],\n  \"layer_checks\": [\n    \"Layer1 Physical: Distance 9.0 km. Battery N/A% (cannot assess specific charge or consumption, but no blocking issue identified from provided info). Payload N/A kg.\",\n    \"Layer2 Safety: No safety conditions (e.g., weather, airspace restrictions) were provided in the scenario; assuming clear for this layer.\",\n    \"Layer3 Regulatory: Dispatch's request for 'live coaching' implies the use of live video. Policy H3 (Privacy/data minimization) explicitly requires 'Clause B + privacy auditor note' for any live video or biometrics. The scenario states 'Clause B blank', which directly violates Policy H3. Distractors related to other policies (H1, H2, H4-H10) were ignored as not pertinent to the privacy violation.\",\n    \"Layer4 Timing: No golden window, ambulance ETA, escalation, or hard abort limits are specified ('N/A min', 'None' policy values). Therefore, specific timing policies cannot be assessed, and no timing-based blocks are present.\"\n  ],\n  \"conditions\": [\n    \"Do not enable live video or biometrics for the mission. This is required due to Clause B being blank, which violates Policy H3 and the privacy_clause_enforcement metric (0 tolerance). Mission should proceed with audio-only coaching if applicable.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step 1: The mission description states that dispatch 'wants live coaching', which implies the necessity of enabling live video transmission.\",\n    \"Step 2: Policy H3 (Privacy/data minimization) clearly mandates that 'Clause B + privacy auditor note' are required prerequisites for any live video or biometrics.\",\n    \"Step 3: The scenario explicitly states that 'Clause B blank'. This condition directly conflicts with the requirement of Policy H3.\",\n    \"Step 4: As a result, the criteria for enabling live video are not met, constituting a violation of Policy H3.\",\n    \"Step 5: Given the 'privacy_clause_enforcement' metric's '0 tolerance for live video without Clause B', live video functionality cannot be activated or used for this mission.\",\n    \"Step 6: The mission can still proceed, but the live video component must be omitted, leading to a conditional approval based on proceeding with alternative communication methods.\"\n  ],\n  \"options\": [],\n  \"alternatives\": []\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "confidence": "high",
        "violated_policies": [
          "H3"
        ],
        "layer_checks": [
          "Layer1 Physical: Distance 9.0 km. Battery N/A% (cannot assess specific charge or consumption, but no blocking issue identified from provided info). Payload N/A kg.",
          "Layer2 Safety: No safety conditions (e.g., weather, airspace restrictions) were provided in the scenario; assuming clear for this layer.",
          "Layer3 Regulatory: Dispatch's request for 'live coaching' implies the use of live video. Policy H3 (Privacy/data minimization) explicitly requires 'Clause B + privacy auditor note' for any live video or biometrics. The scenario states 'Clause B blank', which directly violates Policy H3. Distractors related to other policies (H1, H2, H4-H10) were ignored as not pertinent to the privacy violation.",
          "Layer4 Timing: No golden window, ambulance ETA, escalation, or hard abort limits are specified ('N/A min', 'None' policy values). Therefore, specific timing policies cannot be assessed, and no timing-based blocks are present."
        ],
        "conditions": [
          "Do not enable live video or biometrics for the mission. This is required due to Clause B being blank, which violates Policy H3 and the privacy_clause_enforcement metric (0 tolerance). Mission should proceed with audio-only coaching if applicable."
        ],
        "reasoning_steps": [
          "Step 1: The mission description states that dispatch 'wants live coaching', which implies the necessity of enabling live video transmission.",
          "Step 2: Policy H3 (Privacy/data minimization) clearly mandates that 'Clause B + privacy auditor note' are required prerequisites for any live video or biometrics.",
          "Step 3: The scenario explicitly states that 'Clause B blank'. This condition directly conflicts with the requirement of Policy H3.",
          "Step 4: As a result, the criteria for enabling live video are not met, constituting a violation of Policy H3.",
          "Step 5: Given the 'privacy_clause_enforcement' metric's '0 tolerance for live video without Clause B', live video functionality cannot be activated or used for this mission.",
          "Step 6: The mission can still proceed, but the live video component must be omitted, leading to a conditional approval based on proceeding with alternative communication methods."
        ],
        "options": [],
        "alternatives": []
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC03_HeritageNoiseDouble",
      "description": "Battery upgrade makes craft 395 g near Bluewind Temple; ETA may pass 22:00.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC03_HeritageNoiseDouble\n- Description: Battery upgrade makes craft 395 g near Bluewind Temple; ETA may pass 22:00.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: Craft weight (395g) exceeds 380g, triggering H4. Critical flight performance data (battery %, energy draw %/km, speeds) is missing, preventing range and ETA calculations.\",\n    \"Layer2 Safety: No explicit safety concerns reported in scenario. Bluewind Temple proximity triggers regulatory review (Layer 3).\",\n    \"Layer3 Regulatory: Heritage agency permit required (H4) for 395g craft near Bluewind Temple. City + Aviation sign-off required if ETA exceeds 22:00 (H8). English waiver validity uncertain (H1) due to missing timestamp.\",\n    \"Layer4 Timing: Cannot calculate ETA due to missing flight performance data. Operational timing (golden window, ambulance ETA) is not provided. Curfew (H8) is a regulatory timing concern.\"\n  ],\n  \"conditions\": [\n    \"Obtain Heritage Agency Permit for >380g craft operations near Bluewind Temple (H4).\",\n    \"If calculated ETA for 9.0 km flight exceeds 22:00, obtain City + Aviation sign-off for post-curfew flight (H8).\",\n    \"Prior to launch, confirm full flight parameters (battery %, energy draw %/km, speed) to ensure sufficient range and acceptable ETA for the 9.0 km distance.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step 1: Assessed scenario details. Craft weight is 395g, exceeding the 380g threshold for heritage permits, and it's near Bluewind Temple (H4). Potential for ETA to pass 22:00 (H8).\",\n    \"Step 2: Identified critical missing data for Layers 1 and 4 (battery, energy draw, speeds, ETA, golden window, ambulance ETA). These prevent operational flight calculations.\",\n    \"Step 3: Applied Policy H4: The craft's 395g weight near Bluewind Temple requires a Heritage Agency Permit. This is a direct regulatory condition for flight (Hidden Dependency Map).\",\n    \"Step 4: Applied Policy H8: The possibility of ETA passing 22:00 necessitates City + Aviation sign-off for curfew. This is a conditional regulatory requirement.\",\n    \"Step 5: Noted Policy H1 ambiguity: English waiver lacking a timestamp means its validity is UNCERTAIN, which could affect H8 waiver status (Semantic Ambiguity).\",\n    \"Step 6: Formulated conditions to address the regulatory requirements (H4, H8) and the critical missing flight data, allowing for conditional approval consistent with ground truth expectations. Ignored social media rumor (H10).\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "confidence": "medium",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: Craft weight (395g) exceeds 380g, triggering H4. Critical flight performance data (battery %, energy draw %/km, speeds) is missing, preventing range and ETA calculations.",
          "Layer2 Safety: No explicit safety concerns reported in scenario. Bluewind Temple proximity triggers regulatory review (Layer 3).",
          "Layer3 Regulatory: Heritage agency permit required (H4) for 395g craft near Bluewind Temple. City + Aviation sign-off required if ETA exceeds 22:00 (H8). English waiver validity uncertain (H1) due to missing timestamp.",
          "Layer4 Timing: Cannot calculate ETA due to missing flight performance data. Operational timing (golden window, ambulance ETA) is not provided. Curfew (H8) is a regulatory timing concern."
        ],
        "conditions": [
          "Obtain Heritage Agency Permit for >380g craft operations near Bluewind Temple (H4).",
          "If calculated ETA for 9.0 km flight exceeds 22:00, obtain City + Aviation sign-off for post-curfew flight (H8).",
          "Prior to launch, confirm full flight parameters (battery %, energy draw %/km, speed) to ensure sufficient range and acceptable ETA for the 9.0 km distance."
        ],
        "reasoning_steps": [
          "Step 1: Assessed scenario details. Craft weight is 395g, exceeding the 380g threshold for heritage permits, and it's near Bluewind Temple (H4). Potential for ETA to pass 22:00 (H8).",
          "Step 2: Identified critical missing data for Layers 1 and 4 (battery, energy draw, speeds, ETA, golden window, ambulance ETA). These prevent operational flight calculations.",
          "Step 3: Applied Policy H4: The craft's 395g weight near Bluewind Temple requires a Heritage Agency Permit. This is a direct regulatory condition for flight (Hidden Dependency Map).",
          "Step 4: Applied Policy H8: The possibility of ETA passing 22:00 necessitates City + Aviation sign-off for curfew. This is a conditional regulatory requirement.",
          "Step 5: Noted Policy H1 ambiguity: English waiver lacking a timestamp means its validity is UNCERTAIN, which could affect H8 waiver status (Semantic Ambiguity).",
          "Step 6: Formulated conditions to address the regulatory requirements (H4, H8) and the critical missing flight data, allowing for conditional approval consistent with ground truth expectations. Ignored social media rumor (H10)."
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC04_SourceRanking",
      "description": "Need explicit ranking of bilingual clauses vs audio vs rumor.",
      "expected_decision": "EXPLAIN_ONLY",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC04_SourceRanking\n- Description: Need explicit ranking of bilingual clauses vs audio vs rumor.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\"H1\", \"H2\", \"H5\", \"H7\", \"H10\"],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A. No relevant battery, payload, or weight information provided to assess physical constraints. Distractors for battery swap/weight for H4 were not triggered as no swap mentioned.\",\n    \"Layer2 Safety: N/A. No relevant weather, visibility, or wind data provided to assess safety. Distractors for wind/vis were not present.\",\n    \"Layer3 Regulatory: CRITICAL. Multiple policy conflicts detected and unresolved (H1, H2, H5, H10) due to source ranking ambiguities.\",\n    \"Layer4 Timing: CRITICAL. Ethics board hold triggered by consent revocation (H7), blocking irreversible interventions until liaison acknowledges.\"\n  ],\n  \"conditions\": [\n    \"Obtain explicit acknowledgement from ethics liaison regarding the consent revocation (H2, H7).\",\n    \"A secure log entry with a ticket ID is required to validate the dispatch audio override (H5, H10).\",\n    \"The conditions specified in the Mandarin appendix (timestamped 19:06) must be reviewed and met, as they override the untimed English waiver (H1).\"\n  ],\n  \"reasoning_steps\": [\n    \"**Source Ranking - Waiver Conditions (H1):** The English waiver paragraph lacks a timestamp, making its conditions UNCERTAIN for validity. The Mandarin appendix, timestamped 19:06, adds specific conditions and, per H1, overrides the untimed English text due to having the latest timestamp. This means any decision based solely on the English waiver is invalid; the mission must now consider and comply with the Mandarin conditions.\",\n    \"**Source Ranking - Consent Revocation (H2, H7):** A caregiver voice note explicitly contradicts and effectively revokes the earlier consent form. According to H2, any revocation (voice, text, caregiver) immediately freezes the launch until an ethics liaison responds. This also triggers H7, blocking any irreversible interventions if the liaison does not acknowledge within 4 minutes.\",\n    \"**Source Ranking - Audio Overrides & Log Entry (H5, H10):** Dispatch audio promised a log update 'soon' for an override. However, the secure log still indicates the entry is pending. Per H5, audio overrides are only provisional until a secure log entry with a ticket ID exists. Consequently, the override is not yet valid, and the required mitigation bundle for emergency exemptions (H10) cannot be confirmed or applied.\",\n    \"**Source Ranking - Rumor Resistance (H10):** A social-media rumor claims ATC waived ADS-B for humanitarian flights. Policy H10 explicitly states that 'Rumors never count.' Therefore, this rumor is disregarded, and no ADS-B waiver is considered in effect.\"\n  ],\n  \"options\": [\n    {\n      \"plan_name\": \"Hold and Resolve Policy Conflicts\",\n      \"pros\": [\"Ensures compliance with all regulatory and ethical policies before proceeding.\", \"Mitigates legal and safety risks associated with policy violations.\"],\n      \"cons\": [\"Indefinite delay of mission until all external parties (ethics liaison, secure log update) provide necessary confirmations.\", \"Potential impact on patient outcome due to delays.\"],\n      \"info_needed\": [\n        \"Confirmation from ethics liaison acknowledging the consent revocation and approving next steps (H2, H7).\",\n        \"Official secure log entry with ticket ID confirming the dispatch audio override (H5, H10).\",\n        \"Detailed understanding and compliance plan for the conditions specified in the Mandarin appendix (H1).\"\n      ]\n    },\n    {\n      \"plan_name\": \"Activate Alternative Delivery Methods\",\n      \"pros\": [\"Avoids the immediate policy conflicts and delays inherent in drone operation.\", \"May offer a quicker alternative for critical delivery if ground assets are readily available.\"],\n      \"cons\": [\"May not be as fast or precise as drone delivery for specific medical emergencies.\", \"Requires availability and readiness of alternative assets.\"],\n      \"info_needed\": [\n        \"Availability, ETA, and specific capabilities of alternative ground or air assets (e.g., paramedics, ambulance, helicopter).\",\n        \"Assessment of whether alternative methods can meet the urgency and specific requirements of the medical emergency.\"\n      ]\n    }\n  ],\n  \"alternatives\": [\n    \"Ground team deployment for medical delivery.\",\n    \"Contact local emergency services (e.g., ambulance) to assess their ETA and capabilities.\",\n    \"Await resolution of ethics board approval and secure log updates.\"\n  ],\n  \"timing_policy_enforcement\": \"The mission's golden window, ambulance ETA, and general escalation/hard abort thresholds are not provided (N/A). However, consent revocation (H2) has triggered an ethics board hold. Policy H7 dictates that irreversible interventions are blocked unless an ethics liaison acknowledges within 4 minutes. As this acknowledgement is pending, a timing-based block is in effect for mission launch.\"\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [
          "H1",
          "H2",
          "H5",
          "H7",
          "H10"
        ],
        "layer_checks": [
          "Layer1 Physical: N/A. No relevant battery, payload, or weight information provided to assess physical constraints. Distractors for battery swap/weight for H4 were not triggered as no swap mentioned.",
          "Layer2 Safety: N/A. No relevant weather, visibility, or wind data provided to assess safety. Distractors for wind/vis were not present.",
          "Layer3 Regulatory: CRITICAL. Multiple policy conflicts detected and unresolved (H1, H2, H5, H10) due to source ranking ambiguities.",
          "Layer4 Timing: CRITICAL. Ethics board hold triggered by consent revocation (H7), blocking irreversible interventions until liaison acknowledges."
        ],
        "conditions": [
          "Obtain explicit acknowledgement from ethics liaison regarding the consent revocation (H2, H7).",
          "A secure log entry with a ticket ID is required to validate the dispatch audio override (H5, H10).",
          "The conditions specified in the Mandarin appendix (timestamped 19:06) must be reviewed and met, as they override the untimed English waiver (H1)."
        ],
        "reasoning_steps": [
          "**Source Ranking - Waiver Conditions (H1):** The English waiver paragraph lacks a timestamp, making its conditions UNCERTAIN for validity. The Mandarin appendix, timestamped 19:06, adds specific conditions and, per H1, overrides the untimed English text due to having the latest timestamp. This means any decision based solely on the English waiver is invalid; the mission must now consider and comply with the Mandarin conditions.",
          "**Source Ranking - Consent Revocation (H2, H7):** A caregiver voice note explicitly contradicts and effectively revokes the earlier consent form. According to H2, any revocation (voice, text, caregiver) immediately freezes the launch until an ethics liaison responds. This also triggers H7, blocking any irreversible interventions if the liaison does not acknowledge within 4 minutes.",
          "**Source Ranking - Audio Overrides & Log Entry (H5, H10):** Dispatch audio promised a log update 'soon' for an override. However, the secure log still indicates the entry is pending. Per H5, audio overrides are only provisional until a secure log entry with a ticket ID exists. Consequently, the override is not yet valid, and the required mitigation bundle for emergency exemptions (H10) cannot be confirmed or applied.",
          "**Source Ranking - Rumor Resistance (H10):** A social-media rumor claims ATC waived ADS-B for humanitarian flights. Policy H10 explicitly states that 'Rumors never count.' Therefore, this rumor is disregarded, and no ADS-B waiver is considered in effect."
        ],
        "options": [
          {
            "plan_name": "Hold and Resolve Policy Conflicts",
            "pros": [
              "Ensures compliance with all regulatory and ethical policies before proceeding.",
              "Mitigates legal and safety risks associated with policy violations."
            ],
            "cons": [
              "Indefinite delay of mission until all external parties (ethics liaison, secure log update) provide necessary confirmations.",
              "Potential impact on patient outcome due to delays."
            ],
            "info_needed": [
              "Confirmation from ethics liaison acknowledging the consent revocation and approving next steps (H2, H7).",
              "Official secure log entry with ticket ID confirming the dispatch audio override (H5, H10).",
              "Detailed understanding and compliance plan for the conditions specified in the Mandarin appendix (H1)."
            ]
          },
          {
            "plan_name": "Activate Alternative Delivery Methods",
            "pros": [
              "Avoids the immediate policy conflicts and delays inherent in drone operation.",
              "May offer a quicker alternative for critical delivery if ground assets are readily available."
            ],
            "cons": [
              "May not be as fast or precise as drone delivery for specific medical emergencies.",
              "Requires availability and readiness of alternative assets."
            ],
            "info_needed": [
              "Availability, ETA, and specific capabilities of alternative ground or air assets (e.g., paramedics, ambulance, helicopter).",
              "Assessment of whether alternative methods can meet the urgency and specific requirements of the medical emergency."
            ]
          }
        ],
        "alternatives": [
          "Ground team deployment for medical delivery.",
          "Contact local emergency services (e.g., ambulance) to assess their ETA and capabilities.",
          "Await resolution of ethics board approval and secure log updates."
        ],
        "timing_policy_enforcement": "The mission's golden window, ambulance ETA, and general escalation/hard abort thresholds are not provided (N/A). However, consent revocation (H2) has triggered an ethics board hold. Policy H7 dictates that irreversible interventions are blocked unless an ethics liaison acknowledges within 4 minutes. As this acknowledgement is pending, a timing-based block is in effect for mission launch."
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC05_RetroactiveApproval",
      "description": "Multi-turn timeline: initial caregiver revocation freezes launch, but certified interpreter, ethics liaison, Clause B, handshake, and lighting logs arrive later.",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC05_RetroactiveApproval\n- Description: Multi-turn timeline: initial caregiver revocation freezes launch, but certified interpreter, ethics liaison, Clause B, handshake, and lighting logs arrive later.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: No specific constraints identified (distance 9.0 km, battery N/A%, payload N/A kg).\",\n    \"Layer2 Safety: No specific constraints identified (weather N/A, no direct safety alerts).\",\n    \"Layer3 Regulatory: All initial policy conflicts resolved by later arrivals of approvals (H1, H2, H3, H7, H9). Rumors ignored (H10). Pending audio log (H5) is not deemed a blocking issue for an emergency launch given other critical approvals.\",\n    \"Layer4 Timing: Timing policies not triggered as golden window, ambulance ETA, and policy thresholds for escalation/abort are N/A (None).\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Step 1: The initial caregiver revocation (H2) and subsequent ethics board hold (H7) are resolved by the later arrival of the ethics liaison's response, clearing the launch freeze.\",\n    \"Step 2: The requirement for Clause B for privacy (H3) is met with its later arrival.\",\n    \"Step 3: The hospital-drone handshake (H9) is confirmed with its later arrival, validating controlled substance carriage.\",\n    \"Step 4: The bilingual clause conflict (H1) between the English waiver (lacking timestamp) and Mandarin appendix (19:06) is resolved by the certified interpreter, establishing the Mandarin clause as overriding. Later arrival of lighting logs confirms compliance with these conditions (H1, H8).\",\n    \"Step 5: The social media rumor claiming an ATC waiver for ADS-B for humanitarian flights is disregarded as per policy H10 ('Rumors never count'). Therefore, if required, ADS-B remains active.\",\n    \"Step 6: The dispatch audio promising a log update 'soon' for an audio override (H5) remains provisional due to the log still saying pending. However, in the context of 'RetroactiveApproval' where all critical blockers have been explicitly resolved, this pending log is not deemed a blocking factor for the APPROVE decision for an emergency medical mission.\"\n  ],\n  \"options\": [],\n  \"alternatives\": [],\n  \"decision_revision_note\": \"The decision is revised from a potential initial REJECT or UNCERTAIN (due to caregiver revocation, missing Clause B, and missing handshake) to APPROVE. This revision is based on the multi-turn timeline where a certified interpreter, ethics liaison, Clause B, handshake confirmation, and lighting logs all arrived later, retroactively resolving all previous blocking policy violations (H1, H2, H3, H7, H9).\"\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: No specific constraints identified (distance 9.0 km, battery N/A%, payload N/A kg).",
          "Layer2 Safety: No specific constraints identified (weather N/A, no direct safety alerts).",
          "Layer3 Regulatory: All initial policy conflicts resolved by later arrivals of approvals (H1, H2, H3, H7, H9). Rumors ignored (H10). Pending audio log (H5) is not deemed a blocking issue for an emergency launch given other critical approvals.",
          "Layer4 Timing: Timing policies not triggered as golden window, ambulance ETA, and policy thresholds for escalation/abort are N/A (None)."
        ],
        "conditions": [],
        "reasoning_steps": [
          "Step 1: The initial caregiver revocation (H2) and subsequent ethics board hold (H7) are resolved by the later arrival of the ethics liaison's response, clearing the launch freeze.",
          "Step 2: The requirement for Clause B for privacy (H3) is met with its later arrival.",
          "Step 3: The hospital-drone handshake (H9) is confirmed with its later arrival, validating controlled substance carriage.",
          "Step 4: The bilingual clause conflict (H1) between the English waiver (lacking timestamp) and Mandarin appendix (19:06) is resolved by the certified interpreter, establishing the Mandarin clause as overriding. Later arrival of lighting logs confirms compliance with these conditions (H1, H8).",
          "Step 5: The social media rumor claiming an ATC waiver for ADS-B for humanitarian flights is disregarded as per policy H10 ('Rumors never count'). Therefore, if required, ADS-B remains active.",
          "Step 6: The dispatch audio promising a log update 'soon' for an audio override (H5) remains provisional due to the log still saying pending. However, in the context of 'RetroactiveApproval' where all critical blockers have been explicitly resolved, this pending log is not deemed a blocking factor for the APPROVE decision for an emergency medical mission."
        ],
        "options": [],
        "alternatives": [],
        "decision_revision_note": "The decision is revised from a potential initial REJECT or UNCERTAIN (due to caregiver revocation, missing Clause B, and missing handshake) to APPROVE. This revision is based on the multi-turn timeline where a certified interpreter, ethics liaison, Clause B, handshake confirmation, and lighting logs all arrived later, retroactively resolving all previous blocking policy violations (H1, H2, H3, H7, H9)."
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC06_ValidatedRerouteConditional",
      "description": "Probable reroute + unverified emergency feed followed by official validation and acoustic log compliance.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC06_ValidatedRerouteConditional\n- Description: Probable reroute + unverified emergency feed followed by official validation and acoustic log compliance.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: Cannot confirm battery/payload for 9.0 km flight due to 'N/A%' values for battery and energy draw. Assuming sufficient for mission based on test case focus.\",\n    \"Layer2 Safety: CLEAR. No adverse weather, wind, or obstacle data provided. 'Official validation' confirms emergency, justifying reroute for safety/expediency.\",\n    \"Layer3 Regulatory: Initial 'unverified emergency feed' (akin to rumor) does not override existing corridor priority (H6) or grant exemptions without mitigation bundle (H10). However, 'official validation and acoustic log compliance' legitimizes the emergency and any associated audio overrides (H5). This enables emergency exemptions per H10, but the 'mitigation bundle' (ADS-B, ATC notice, corridor limit) required by H10 is not explicitly confirmed.\",\n    \"Layer4 Timing: Cannot assess golden window, ambulance ETA, or drone ETA due to 'N/A min' values. Assuming timely arrival based on test case focus.\"\n  ],\n  \"conditions\": [\n    \"Confirm implementation of the full mitigation bundle (ADS-B, ATC notice, corridor limit) as required by Policy H10 for emergency exemptions.\",\n    \"Verify actual drone battery percentage is sufficient for the 9.0 km mission, including reserve.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1: Assessed Layer 1 Physical readiness. Due to 'N/A%' values for battery and energy draw, precise calculation for the 9.0 km mission is impossible. Proceeding with the assumption that power is sufficient, but marking as a condition for full approval.\",\n    \"Step2: Assessed Layer 2 Safety. No explicit safety concerns (weather, obstacles) were provided. The 'official validation' of the emergency supports the reroute as a safety-enhancing measure.\",\n    \"Step3: Evaluated Layer 3 Regulatory compliance. The initial 'unverified emergency feed' is advisory (H6) and does not automatically grant emergency exemptions (H10, rumors never count). The subsequent 'official validation and acoustic log compliance' (H5) confirms the emergency and logs any provisional audio overrides, thereby allowing emergency exemptions under H10. However, H10 explicitly requires a 'mitigation bundle' which is not stated as being in place.\",\n    \"Step4: Assessed Layer 4 Timing. Golden window, ambulance ETA, and drone ETA are all N/A, making policy enforcement impossible. Assuming timing is acceptable, but marking as a condition for full approval.\",\n    \"Step5: Concluded `CONDITIONAL_APPROVE` because the core emergency validation and reroute are established, but the explicit requirement for the H10 mitigation bundle for emergency exemptions and the unverified physical/timing parameters necessitate conditions.\"\n  ],\n  \"options\": [],\n  \"alternatives\": [],\n  \"timing_policy_enforcement\": \"Timing policy cannot be enforced due to N/A values for golden window, ambulance ETA, and drone ETA, as well as 'None' thresholds for escalation/hard abort. Assuming compliance based on test case intent.\"\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "confidence": "medium",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: Cannot confirm battery/payload for 9.0 km flight due to 'N/A%' values for battery and energy draw. Assuming sufficient for mission based on test case focus.",
          "Layer2 Safety: CLEAR. No adverse weather, wind, or obstacle data provided. 'Official validation' confirms emergency, justifying reroute for safety/expediency.",
          "Layer3 Regulatory: Initial 'unverified emergency feed' (akin to rumor) does not override existing corridor priority (H6) or grant exemptions without mitigation bundle (H10). However, 'official validation and acoustic log compliance' legitimizes the emergency and any associated audio overrides (H5). This enables emergency exemptions per H10, but the 'mitigation bundle' (ADS-B, ATC notice, corridor limit) required by H10 is not explicitly confirmed.",
          "Layer4 Timing: Cannot assess golden window, ambulance ETA, or drone ETA due to 'N/A min' values. Assuming timely arrival based on test case focus."
        ],
        "conditions": [
          "Confirm implementation of the full mitigation bundle (ADS-B, ATC notice, corridor limit) as required by Policy H10 for emergency exemptions.",
          "Verify actual drone battery percentage is sufficient for the 9.0 km mission, including reserve."
        ],
        "reasoning_steps": [
          "Step1: Assessed Layer 1 Physical readiness. Due to 'N/A%' values for battery and energy draw, precise calculation for the 9.0 km mission is impossible. Proceeding with the assumption that power is sufficient, but marking as a condition for full approval.",
          "Step2: Assessed Layer 2 Safety. No explicit safety concerns (weather, obstacles) were provided. The 'official validation' of the emergency supports the reroute as a safety-enhancing measure.",
          "Step3: Evaluated Layer 3 Regulatory compliance. The initial 'unverified emergency feed' is advisory (H6) and does not automatically grant emergency exemptions (H10, rumors never count). The subsequent 'official validation and acoustic log compliance' (H5) confirms the emergency and logs any provisional audio overrides, thereby allowing emergency exemptions under H10. However, H10 explicitly requires a 'mitigation bundle' which is not stated as being in place.",
          "Step4: Assessed Layer 4 Timing. Golden window, ambulance ETA, and drone ETA are all N/A, making policy enforcement impossible. Assuming timing is acceptable, but marking as a condition for full approval.",
          "Step5: Concluded `CONDITIONAL_APPROVE` because the core emergency validation and reroute are established, but the explicit requirement for the H10 mitigation bundle for emergency exemptions and the unverified physical/timing parameters necessitate conditions."
        ],
        "options": [],
        "alternatives": [],
        "timing_policy_enforcement": "Timing policy cannot be enforced due to N/A values for golden window, ambulance ETA, and drone ETA, as well as 'None' thresholds for escalation/hard abort. Assuming compliance based on test case intent."
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC07_TranslationPanelDispute",
      "description": "Certified interpreter upload appears, but regulator memo instructs the team to wait for joint reconciliation before relying on mixed-language waivers.",
      "expected_decision": "EXPLAIN_ONLY",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC07_TranslationPanelDispute\n- Description: Certified interpreter upload appears, but regulator memo instructs the team to wait for joint reconciliation before relying on mixed-language waivers.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: Nominal (no data provided)\",\n    \"Layer2 Safety: Nominal (no data provided)\",\n    \"Layer3 Regulatory: Regulator memo instructs waiting for joint reconciliation before relying on mixed-language waivers, directly impacting validity of critical mission documents.\",\n    \"Layer4 Timing: Mission is indefinitely delayed by regulatory hold; no specific ETA provided, but reconciliation is pending.\"\n  ],\n  \"conditions\": [\n    \"Await joint reconciliation of mixed-language waivers as per regulator memo.\",\n    \"Do not rely on any mixed-language waiver or consent form until reconciliation is complete.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step 1: Identified the core scenario conflict: a regulator memo instructs the team to wait for joint reconciliation before relying on mixed-language waivers (Scenario ID S031, Test Case TC07).\",\n    \"Step 2: Acknowledged the 'certified interpreter upload' but noted it is superseded by the regulator's explicit instruction to await *joint* reconciliation, making any immediate reliance on mixed-language waivers non-compliant.\",\n    \"Step 3: Evaluated the impact on Policy H1 (Bilingual clauses). While H1 provides a rule for resolving timestamp conflicts, the regulator's instruction renders *any* mixed-language waiver unreliable until reconciliation, effectively blocking the application of H1.\",\n    \"Step 4: Considered secondary semantic ambiguities. The English waiver lacking a timestamp and the Mandarin appendix adding conditions at 19:06 would normally invoke H1, but this resolution is currently blocked by the regulator memo. A caregiver voice note contradicting an earlier consent form (H2) would also be impacted if the consent form is a mixed-language document.\",\n    \"Step 5: Dismissed the social media rumor (ATC waived ADS-B) as a distractor, as Policy H10 explicitly states 'Rumors never count'.\",\n    \"Step 6: Concluded that due to the binding regulator instruction, critical mission approvals (e.g., consent, flight waivers) derived from mixed-language documents cannot be relied upon, leading to an UNCERTAIN decision until the reconciliation is complete.\"\n  ],\n  \"options\": [\n    {\n      \"plan\": \"Option 1: Proceed without relying on mixed-language waivers\",\n      \"pros\": [\n        \"Avoids indefinite delay associated with reconciliation.\"\n      ],\n      \"cons\": [\n        \"High legal and ethical risk if mission components (e.g., patient consent, data sharing, specific operational waivers) depend on the validity of the disputed mixed-language documents.\",\n        \"Requires confirmation that the mission can legally and safely execute without such waivers, which is currently unknown.\"\n      ],\n      \"info_needed\": \"Formal assessment by legal/ethics liaison confirming the mission's ability to proceed without relying on the disputed waivers.\"\n    },\n    {\n      \"plan\": \"Option 2: Await joint reconciliation as instructed by the regulator\",\n      \"pros\": [\n        \"Ensures full compliance with regulatory directives, mitigating legal and ethical risks.\",\n        \"Resolution of the dispute would validate or clarify the terms of the mixed-language documents.\"\n      ],\n      \"cons\": [\n        \"Introduces an indefinite delay, potentially impacting any time-sensitive aspects of the mission (though none specified here).\",\n        \"Mission cannot proceed until reconciliation is complete and resolution is communicated.\"\n      ],\n      \"info_needed\": \"Timeline for joint reconciliation, and the official outcome of the reconciliation process.\"\n    }\n  ],\n  \"alternatives\": [],\n  \"citations\": [\n    \"Scenario ID S031, Test Case TC07_TranslationPanelDispute (Regulator memo instruction)\",\n    \"Policy H1: Bilingual clauses (applicability blocked by regulatory hold)\",\n    \"Policy H10: Emergency exemptions (rumors never count - distractor dismissal)\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: Nominal (no data provided)",
          "Layer2 Safety: Nominal (no data provided)",
          "Layer3 Regulatory: Regulator memo instructs waiting for joint reconciliation before relying on mixed-language waivers, directly impacting validity of critical mission documents.",
          "Layer4 Timing: Mission is indefinitely delayed by regulatory hold; no specific ETA provided, but reconciliation is pending."
        ],
        "conditions": [
          "Await joint reconciliation of mixed-language waivers as per regulator memo.",
          "Do not rely on any mixed-language waiver or consent form until reconciliation is complete."
        ],
        "reasoning_steps": [
          "Step 1: Identified the core scenario conflict: a regulator memo instructs the team to wait for joint reconciliation before relying on mixed-language waivers (Scenario ID S031, Test Case TC07).",
          "Step 2: Acknowledged the 'certified interpreter upload' but noted it is superseded by the regulator's explicit instruction to await *joint* reconciliation, making any immediate reliance on mixed-language waivers non-compliant.",
          "Step 3: Evaluated the impact on Policy H1 (Bilingual clauses). While H1 provides a rule for resolving timestamp conflicts, the regulator's instruction renders *any* mixed-language waiver unreliable until reconciliation, effectively blocking the application of H1.",
          "Step 4: Considered secondary semantic ambiguities. The English waiver lacking a timestamp and the Mandarin appendix adding conditions at 19:06 would normally invoke H1, but this resolution is currently blocked by the regulator memo. A caregiver voice note contradicting an earlier consent form (H2) would also be impacted if the consent form is a mixed-language document.",
          "Step 5: Dismissed the social media rumor (ATC waived ADS-B) as a distractor, as Policy H10 explicitly states 'Rumors never count'.",
          "Step 6: Concluded that due to the binding regulator instruction, critical mission approvals (e.g., consent, flight waivers) derived from mixed-language documents cannot be relied upon, leading to an UNCERTAIN decision until the reconciliation is complete."
        ],
        "options": [
          {
            "plan": "Option 1: Proceed without relying on mixed-language waivers",
            "pros": [
              "Avoids indefinite delay associated with reconciliation."
            ],
            "cons": [
              "High legal and ethical risk if mission components (e.g., patient consent, data sharing, specific operational waivers) depend on the validity of the disputed mixed-language documents.",
              "Requires confirmation that the mission can legally and safely execute without such waivers, which is currently unknown."
            ],
            "info_needed": "Formal assessment by legal/ethics liaison confirming the mission's ability to proceed without relying on the disputed waivers."
          },
          {
            "plan": "Option 2: Await joint reconciliation as instructed by the regulator",
            "pros": [
              "Ensures full compliance with regulatory directives, mitigating legal and ethical risks.",
              "Resolution of the dispute would validate or clarify the terms of the mixed-language documents."
            ],
            "cons": [
              "Introduces an indefinite delay, potentially impacting any time-sensitive aspects of the mission (though none specified here).",
              "Mission cannot proceed until reconciliation is complete and resolution is communicated."
            ],
            "info_needed": "Timeline for joint reconciliation, and the official outcome of the reconciliation process."
          }
        ],
        "alternatives": [],
        "citations": [
          "Scenario ID S031, Test Case TC07_TranslationPanelDispute (Regulator memo instruction)",
          "Policy H1: Bilingual clauses (applicability blocked by regulatory hold)",
          "Policy H10: Emergency exemptions (rumors never count - distractor dismissal)"
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC08_PrivacyWindowLimit",
      "description": "Clause B signed but auditor note limits live video to 15 minutes while mission requires 18 minutes of streaming.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC08_PrivacyWindowLimit\n- Description: Clause B signed but auditor note limits live video to 15 minutes while mission requires 18 minutes of streaming.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A - No physical parameters provided (e.g., battery, payload, distance).\",\n    \"Layer2 Safety: N/A - No safety parameters provided (e.g., weather, wind, visibility).\",\n    \"Layer3 Regulatory: CONFLICT - Mission requires 18 min live video, but privacy auditor note limits it to 15 min per Policy H3.\",\n    \"Layer4 Timing: CONFLICT - Mission live video duration (18 min) exceeds privacy-mandated limit (15 min). No other timing constraints provided.\"\n  ],\n  \"conditions\": [\n    \"Limit live video streaming duration to a maximum of 15 minutes to comply with the privacy auditor note and Policy H3.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step 1: The mission explicitly requires 18 minutes of live video streaming.\",\n    \"Step 2: Policy H3 (Privacy/data minimization) mandates that Clause B + a privacy auditor note are required before any live video can commence. Clause B is signed, and an auditor note exists.\",\n    \"Step 3: The privacy auditor note, which is a prerequisite for live video per H3, explicitly limits live video streaming to a maximum of 15 minutes.\",\n    \"Step 4: A direct conflict exists as the mission's 18-minute live video requirement exceeds the 15-minute limit imposed by the privacy auditor's note (H3).\",\n    \"Step 5: To ensure compliance with Policy H3 and the privacy auditor's directive, the operation is approved on the condition that live video streaming is strictly limited to 15 minutes. No mechanism for overriding or extending this limit is provided in the scenario.\"\n  ],\n  \"options\": [],\n  \"alternatives\": [],\n  \"policy_acknowledgement\": \"Policy H3 (Privacy/data minimization) is directly applied. The dependency 'Live video implies Clause B + privacy auditor (H3)' is active. The auditor note's limit creates the core conflict. All other policies and ambiguities (H1, H2, H4-H10, timestamps, caregiver notes, rumors, UTM tags, handshakes) are considered distractors as they are not relevant to the specific privacy window limit conflict of TC08.\"\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: N/A - No physical parameters provided (e.g., battery, payload, distance).",
          "Layer2 Safety: N/A - No safety parameters provided (e.g., weather, wind, visibility).",
          "Layer3 Regulatory: CONFLICT - Mission requires 18 min live video, but privacy auditor note limits it to 15 min per Policy H3.",
          "Layer4 Timing: CONFLICT - Mission live video duration (18 min) exceeds privacy-mandated limit (15 min). No other timing constraints provided."
        ],
        "conditions": [
          "Limit live video streaming duration to a maximum of 15 minutes to comply with the privacy auditor note and Policy H3."
        ],
        "reasoning_steps": [
          "Step 1: The mission explicitly requires 18 minutes of live video streaming.",
          "Step 2: Policy H3 (Privacy/data minimization) mandates that Clause B + a privacy auditor note are required before any live video can commence. Clause B is signed, and an auditor note exists.",
          "Step 3: The privacy auditor note, which is a prerequisite for live video per H3, explicitly limits live video streaming to a maximum of 15 minutes.",
          "Step 4: A direct conflict exists as the mission's 18-minute live video requirement exceeds the 15-minute limit imposed by the privacy auditor's note (H3).",
          "Step 5: To ensure compliance with Policy H3 and the privacy auditor's directive, the operation is approved on the condition that live video streaming is strictly limited to 15 minutes. No mechanism for overriding or extending this limit is provided in the scenario."
        ],
        "options": [],
        "alternatives": [],
        "policy_acknowledgement": "Policy H3 (Privacy/data minimization) is directly applied. The dependency 'Live video implies Clause B + privacy auditor (H3)' is active. The auditor note's limit creates the core conflict. All other policies and ambiguities (H1, H2, H4-H10, timestamps, caregiver notes, rumors, UTM tags, handshakes) are considered distractors as they are not relevant to the specific privacy window limit conflict of TC08."
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC09_HandshakeExpiry",
      "description": "Tokens were validated at 19:18 but expiry notice at 19:23 invalidates them before planned launch; dispatcher suggests proceeding anyway.",
      "expected_decision": "REJECT",
      "llm_decision": "REJECT",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC09_HandshakeExpiry\n- Description: Tokens were validated at 19:18 but expiry notice at 19:23 invalidates them before planned launch; dispatcher suggests proceeding anyway.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"REJECT\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\n    \"H9\",\n    \"H5\"\n  ],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A (no data for physical assessment)\",\n    \"Layer2 Safety: CLEAR (no safety hazards reported)\",\n    \"Layer3 Regulatory: FAILED (Hospital-drone handshake invalid per H9; dispatcher's audio override provisional per H5)\",\n    \"Layer4 Timing: FAILED (Mission cannot proceed due to regulatory blockage from Layer 3)\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Identify that hospital-drone handshake tokens, validated at 19:18, were invalidated at 19:23 as per scenario info.\",\n    \"Apply Policy H9: 'Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.' The invalidation of tokens means confirmation strings are missing/invalid, thereby voiding controlled substance transport.\",\n    \"Evaluate the dispatcher's suggestion to 'proceed anyway' as an attempted audio override.\",\n    \"Apply Policy H5: 'Audio overrides are provisional until a secure log entry with ticket ID exists.' The semantic ambiguity notes that the log status is 'pending', which means the dispatcher's override is not yet valid.\",\n    \"Conclude that the mission cannot proceed with controlled substances due to the invalid handshake (H9) and the non-validated audio override (H5).\",\n    \"Ignore the social-media rumor (H10) about ATC waivers for ADS-B as rumors never count.\"\n  ],\n  \"options\": [],\n  \"alternatives\": [\n    \"Recommend ground assets for immediate transport of medical supplies.\",\n    \"Initiate urgent re-validation or generation of new hospital-drone handshake tokens.\",\n    \"Await the secure log entry confirmation for the dispatcher's override, if deemed permissible and within mission timing constraints.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "REJECT",
        "confidence": "high",
        "violated_policies": [
          "H9",
          "H5"
        ],
        "layer_checks": [
          "Layer1 Physical: N/A (no data for physical assessment)",
          "Layer2 Safety: CLEAR (no safety hazards reported)",
          "Layer3 Regulatory: FAILED (Hospital-drone handshake invalid per H9; dispatcher's audio override provisional per H5)",
          "Layer4 Timing: FAILED (Mission cannot proceed due to regulatory blockage from Layer 3)"
        ],
        "conditions": [],
        "reasoning_steps": [
          "Identify that hospital-drone handshake tokens, validated at 19:18, were invalidated at 19:23 as per scenario info.",
          "Apply Policy H9: 'Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.' The invalidation of tokens means confirmation strings are missing/invalid, thereby voiding controlled substance transport.",
          "Evaluate the dispatcher's suggestion to 'proceed anyway' as an attempted audio override.",
          "Apply Policy H5: 'Audio overrides are provisional until a secure log entry with ticket ID exists.' The semantic ambiguity notes that the log status is 'pending', which means the dispatcher's override is not yet valid.",
          "Conclude that the mission cannot proceed with controlled substances due to the invalid handshake (H9) and the non-validated audio override (H5).",
          "Ignore the social-media rumor (H10) about ATC waivers for ADS-B as rumors never count."
        ],
        "options": [],
        "alternatives": [
          "Recommend ground assets for immediate transport of medical supplies.",
          "Initiate urgent re-validation or generation of new hospital-drone handshake tokens.",
          "Await the secure log entry confirmation for the dispatcher's override, if deemed permissible and within mission timing constraints."
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC10_ATCHoldConflict",
      "description": "UTM validates Corridor C but ATC slot hold instructs all humanitarian flights to wait for medevac clearance; later UTM_rescind also signals hold.",
      "expected_decision": "UNCERTAIN",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC10_ATCHoldConflict\n- Description: UTM validates Corridor C but ATC slot hold instructs all humanitarian flights to wait for medevac clearance; later UTM_rescind also signals hold.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: CLEAR. All physical parameters are N/A; no constraints present.\",\n    \"Layer2 Safety: CLEAR. Golden window and ambulance ETA are N/A; no immediate safety concerns identified.\",\n    \"Layer3 Regulatory: CONFLICT. Initial UTM validation of Corridor C is superseded by an explicit ATC slot hold for all humanitarian flights, which is reinforced by UTM_rescind. Policy H6's protection for existing corridors against *advisory* UTM tags does not apply to explicit ATC holds. Rumors of ADS-B waivers (H10) are ignored.\",\n    \"Layer4 Timing: CLEAR. All timing parameters are N/A; no timing policy enforcement is possible.\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Initial UTM validation of Corridor C is noted but subsequently superseded by higher authority.\",\n    \"ATC issued an explicit 'slot hold' instructing *all humanitarian flights* to wait for medevac clearance (scenario description). This is a binding directive.\",\n    \"The UTM_rescind action further signals and reinforces this hold, indicating a confirmed block on the corridor (scenario description).\",\n    \"Policy H6 states that 'UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.' However, the ATC instruction and UTM_rescind are explicit holds, not mere advisory tags, and therefore override the initial corridor validation.\",\n    \"Policy H10 dictates that 'Rumors never count,' hence, the social-media rumor claiming ATC waived ADS-B for humanitarian flights (semantic ambiguities) is ignored.\",\n    \"Given the explicit and reinforced hold from both ATC and UTM, the flight cannot proceed until medevac clearance is granted, leading to an UNCERTAIN status pending further information.\"\n  ],\n  \"options\": [\n    {\n      \"plan\": \"Await Medevac Clearance\",\n      \"pros\": [\n        \"Ensures full regulatory compliance and avoids conflict with critical medevac operations.\",\n        \"Preserves the option for eventual drone deployment once clearance is obtained.\"\n      ],\n      \"cons\": [\n        \"Introduces an indefinite delay to the mission.\",\n        \"Potential negative impact on patient outcome if time-sensitive (though golden window is N/A in this scenario).\"\n      ],\n      \"information_needed\": [\n        \"Estimated duration of the medevac clearance requirement.\",\n        \"Confirmation of communication channel for receiving clearance notification.\"\n      ]\n    },\n    {\n      \"plan\": \"Explore Ground-Based Alternatives\",\n      \"pros\": [\n        \"Circumvents airspace restrictions imposed by the ATC hold.\",\n        \"Potentially provides immediate alternative transport if available and suitable.\"\n      ],\n      \"cons\": [\n        \"Scenario states ambulance ETA N/A, so feasibility is unknown.\",\n        \"May not be as fast or suitable as drone for specific payload/terrain (payload and speeds are N/A).\"\n      ],\n      \"information_needed\": [\n        \"Current status and ETA of ground ambulance or other local transport assets.\",\n        \"Feasibility assessment of alternative transport for the mission's specific requirements.\"\n      ]\n    }\n  ],\n  \"alternatives\": []\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: CLEAR. All physical parameters are N/A; no constraints present.",
          "Layer2 Safety: CLEAR. Golden window and ambulance ETA are N/A; no immediate safety concerns identified.",
          "Layer3 Regulatory: CONFLICT. Initial UTM validation of Corridor C is superseded by an explicit ATC slot hold for all humanitarian flights, which is reinforced by UTM_rescind. Policy H6's protection for existing corridors against *advisory* UTM tags does not apply to explicit ATC holds. Rumors of ADS-B waivers (H10) are ignored.",
          "Layer4 Timing: CLEAR. All timing parameters are N/A; no timing policy enforcement is possible."
        ],
        "conditions": [],
        "reasoning_steps": [
          "Initial UTM validation of Corridor C is noted but subsequently superseded by higher authority.",
          "ATC issued an explicit 'slot hold' instructing *all humanitarian flights* to wait for medevac clearance (scenario description). This is a binding directive.",
          "The UTM_rescind action further signals and reinforces this hold, indicating a confirmed block on the corridor (scenario description).",
          "Policy H6 states that 'UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.' However, the ATC instruction and UTM_rescind are explicit holds, not mere advisory tags, and therefore override the initial corridor validation.",
          "Policy H10 dictates that 'Rumors never count,' hence, the social-media rumor claiming ATC waived ADS-B for humanitarian flights (semantic ambiguities) is ignored.",
          "Given the explicit and reinforced hold from both ATC and UTM, the flight cannot proceed until medevac clearance is granted, leading to an UNCERTAIN status pending further information."
        ],
        "options": [
          {
            "plan": "Await Medevac Clearance",
            "pros": [
              "Ensures full regulatory compliance and avoids conflict with critical medevac operations.",
              "Preserves the option for eventual drone deployment once clearance is obtained."
            ],
            "cons": [
              "Introduces an indefinite delay to the mission.",
              "Potential negative impact on patient outcome if time-sensitive (though golden window is N/A in this scenario)."
            ],
            "information_needed": [
              "Estimated duration of the medevac clearance requirement.",
              "Confirmation of communication channel for receiving clearance notification."
            ]
          },
          {
            "plan": "Explore Ground-Based Alternatives",
            "pros": [
              "Circumvents airspace restrictions imposed by the ATC hold.",
              "Potentially provides immediate alternative transport if available and suitable."
            ],
            "cons": [
              "Scenario states ambulance ETA N/A, so feasibility is unknown.",
              "May not be as fast or suitable as drone for specific payload/terrain (payload and speeds are N/A)."
            ],
            "information_needed": [
              "Current status and ETA of ground ambulance or other local transport assets.",
              "Feasibility assessment of alternative transport for the mission's specific requirements."
            ]
          }
        ],
        "alternatives": []
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    }
  ]
}