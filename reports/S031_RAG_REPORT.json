{
  "scenario": "S031",
  "summary": {
    "total_test_cases": 10,
    "llm_calls": 10,
    "llm_accuracy": "7/10",
    "llm_accuracy_percent": "70.0%"
  },
  "results": [
    {
      "test_case_id": "TC01_BilingualTimestamp",
      "description": "English waiver lacks timestamp; Mandarin appendix (later) adds lighting + ADS-B requirements.",
      "expected_decision": "UNCERTAIN",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC01_BilingualTimestamp\n- Description: English waiver lacks timestamp; Mandarin appendix (later) adds lighting + ADS-B requirements.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\n    \"H1\",\n    \"H2\",\n    \"H5\"\n  ],\n  \"layer_checks\": [\n    \"Layer1 Physical: Not provided; assumed clear for this case's focus on policy conflicts.\",\n    \"Layer2 Safety: Not provided; assumed clear for this case's focus on policy conflicts.\",\n    \"Layer3 Regulatory: UNCERTAIN. English waiver lacks timestamp (H1). Caregiver revoked consent (H2). Dispatch log update pending (H5).\",\n    \"Layer4 Timing: UNCERTAIN. Ethics liaison response time for consent revocation (H7) is unknown, potentially blocking irreversible interventions.\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Step 1: Evaluate bilingual clauses (H1). The English waiver lacks a timestamp, which, per H1, immediately renders its governing status UNCERTAIN. The Mandarin appendix, timestamped 19:06, adds lighting and ADS-B requirements. This unresolved conflict regarding regulatory precedence is a primary blocker.\",\n    \"Step 2: Evaluate consent cascade (H2). A caregiver voice note contradicts earlier consent, constituting a consent revocation. Per H2, this action freezes the launch until an ethics liaison responds. No response status is provided.\",\n    \"Step 3: Evaluate audio overrides (H5). Dispatch audio promises a log update 'soon' for an override, but the log entry is still pending. Per H5, any such audio override remains provisional until a secure log entry exists, adding to operational uncertainty.\",\n    \"Step 4: Evaluate rumor resistance (H10). A social media rumor regarding an ATC waiver for ADS-B is present. Per H10, rumors never count and must be ignored, therefore it does not resolve the potential ADS-B requirement from the Mandarin appendix.\",\n    \"Step 5: Evaluate ethics board latency (H7). Due to the consent revocation (H2), if the mission involves 'irreversible interventions', ethics liaison acknowledgment is required within 4 minutes. Without information on liaison response or intervention type, this adds to the overall uncertainty.\",\n    \"Step 6: Conclude based on policy conflicts. Multiple critical policy conflicts (H1, H2, H5) and missing information (ethics liaison response, clarity on waiver precedence) prevent a clear path forward, leading to an UNCERTAIN decision.\"\n  ],\n  \"options\": [\n    {\n      \"plan\": \"Seek immediate clarification and timestamp validation for the English waiver and ethics liaison confirmation of consent resolution.\",\n      \"pros\": [\n        \"Resolves the primary regulatory ambiguity concerning waiver precedence and requirements (H1).\",\n        \"Addresses the critical consent revocation issue, potentially unfreezing the launch (H2, H7).\"\n      ],\n      \"cons\": [\n        \"Likely introduces significant delay, which may be critical in a medical emergency.\",\n        \"Requires communication with multiple external parties (waiver authority, ethics liaison).\"\n      ],\n      \"information_needed\": [\n        \"Valid timestamp for the English waiver to establish precedence (H1).\",\n        \"Confirmation from ethics liaison regarding resolution of caregiver's consent revocation (H2, H7).\"\n      ]\n    },\n    {\n      \"plan\": \"Proceed under the assumption that the Mandarin appendix (19:06) governs for lighting/ADS-B requirements, but maintain launch freeze for consent.\",\n      \"pros\": [\n        \"Proactively addresses potential flight requirements for lighting and ADS-B if the Mandarin clause is deemed authoritative (H1).\",\n        \"Prepares the drone for flight while awaiting consent resolution.\"\n      ],\n      \"cons\": [\n        \"Might impose unnecessary requirements if the English waiver, once validated, truly provides a more permissive stance.\",\n        \"Does not resolve the fundamental issue of consent revocation, keeping the launch blocked indefinitely (H2, H7).\"\n      ],\n      \"information_needed\": [\n        \"Confirmation from ethics liaison regarding resolution of caregiver's consent revocation (H2, H7).\",\n        \"Confirmation on whether the mission involves 'irreversible interventions' as per H7.\"\n      ]\n    }\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [
          "H1",
          "H2",
          "H5"
        ],
        "layer_checks": [
          "Layer1 Physical: Not provided; assumed clear for this case's focus on policy conflicts.",
          "Layer2 Safety: Not provided; assumed clear for this case's focus on policy conflicts.",
          "Layer3 Regulatory: UNCERTAIN. English waiver lacks timestamp (H1). Caregiver revoked consent (H2). Dispatch log update pending (H5).",
          "Layer4 Timing: UNCERTAIN. Ethics liaison response time for consent revocation (H7) is unknown, potentially blocking irreversible interventions."
        ],
        "conditions": [],
        "reasoning_steps": [
          "Step 1: Evaluate bilingual clauses (H1). The English waiver lacks a timestamp, which, per H1, immediately renders its governing status UNCERTAIN. The Mandarin appendix, timestamped 19:06, adds lighting and ADS-B requirements. This unresolved conflict regarding regulatory precedence is a primary blocker.",
          "Step 2: Evaluate consent cascade (H2). A caregiver voice note contradicts earlier consent, constituting a consent revocation. Per H2, this action freezes the launch until an ethics liaison responds. No response status is provided.",
          "Step 3: Evaluate audio overrides (H5). Dispatch audio promises a log update 'soon' for an override, but the log entry is still pending. Per H5, any such audio override remains provisional until a secure log entry exists, adding to operational uncertainty.",
          "Step 4: Evaluate rumor resistance (H10). A social media rumor regarding an ATC waiver for ADS-B is present. Per H10, rumors never count and must be ignored, therefore it does not resolve the potential ADS-B requirement from the Mandarin appendix.",
          "Step 5: Evaluate ethics board latency (H7). Due to the consent revocation (H2), if the mission involves 'irreversible interventions', ethics liaison acknowledgment is required within 4 minutes. Without information on liaison response or intervention type, this adds to the overall uncertainty.",
          "Step 6: Conclude based on policy conflicts. Multiple critical policy conflicts (H1, H2, H5) and missing information (ethics liaison response, clarity on waiver precedence) prevent a clear path forward, leading to an UNCERTAIN decision."
        ],
        "options": [
          {
            "plan": "Seek immediate clarification and timestamp validation for the English waiver and ethics liaison confirmation of consent resolution.",
            "pros": [
              "Resolves the primary regulatory ambiguity concerning waiver precedence and requirements (H1).",
              "Addresses the critical consent revocation issue, potentially unfreezing the launch (H2, H7)."
            ],
            "cons": [
              "Likely introduces significant delay, which may be critical in a medical emergency.",
              "Requires communication with multiple external parties (waiver authority, ethics liaison)."
            ],
            "information_needed": [
              "Valid timestamp for the English waiver to establish precedence (H1).",
              "Confirmation from ethics liaison regarding resolution of caregiver's consent revocation (H2, H7)."
            ]
          },
          {
            "plan": "Proceed under the assumption that the Mandarin appendix (19:06) governs for lighting/ADS-B requirements, but maintain launch freeze for consent.",
            "pros": [
              "Proactively addresses potential flight requirements for lighting and ADS-B if the Mandarin clause is deemed authoritative (H1).",
              "Prepares the drone for flight while awaiting consent resolution."
            ],
            "cons": [
              "Might impose unnecessary requirements if the English waiver, once validated, truly provides a more permissive stance.",
              "Does not resolve the fundamental issue of consent revocation, keeping the launch blocked indefinitely (H2, H7)."
            ],
            "information_needed": [
              "Confirmation from ethics liaison regarding resolution of caregiver's consent revocation (H2, H7).",
              "Confirmation on whether the mission involves 'irreversible interventions' as per H7."
            ]
          }
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC02_PrivacyVideo",
      "description": "Dispatch wants live coaching; Clause B blank.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC02_PrivacyVideo\n- Description: Dispatch wants live coaching; Clause B blank.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\n    \"H3\"\n  ],\n  \"layer_checks\": [\n    \"Layer1 Physical: UNKNOWN. Battery N/A%, Payload N/A kg, Energy draw N/A%. No explicit physical blockers for mission proceeding without live video.\",\n    \"Layer2 Safety: CLEAR. No safety information provided (distractors ignored).\",\n    \"Layer3 Regulatory: CONFLICT. Dispatch's request for 'live coaching' implies live video. Policy H3 requires Clause B + privacy auditor note before any live video. Scenario states 'Clause B blank'. Live video functionality is blocked due to H3 violation.\",\n    \"Layer4 Timing: UNKNOWN. Golden window N/A min, ambulance ETA N/A min. No timing conflicts identified.\"\n  ],\n  \"conditions\": [\n    \"Prohibit activation of live video or biometrics functionality for any purpose, including live coaching (H3).\",\n    \"If live video functionality is critical for future missions, Clause B and a privacy auditor note must be obtained.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1: Dispatch requests live coaching, which implies the use of live video functionality.\",\n    \"Step2: Policy H3 (Privacy/data minimization) explicitly states that Clause B and a privacy auditor note are required before activating any live video or biometrics.\",\n    \"Step3: The scenario clearly states 'Clause B blank', indicating the required privacy clause is missing.\",\n    \"Step4: The 'privacy_clause_enforcement' metric mandates zero tolerance for live video without Clause B.\",\n    \"Step5: Consequently, live video functionality cannot be enabled or utilized for this mission, directly violating H3.\",\n    \"Step6: The mission is conditionally approved to proceed, with the strict condition that live video functionality must remain disabled.\"\n  ],\n  \"options\": [],\n  \"alternatives\": []\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "confidence": "high",
        "violated_policies": [
          "H3"
        ],
        "layer_checks": [
          "Layer1 Physical: UNKNOWN. Battery N/A%, Payload N/A kg, Energy draw N/A%. No explicit physical blockers for mission proceeding without live video.",
          "Layer2 Safety: CLEAR. No safety information provided (distractors ignored).",
          "Layer3 Regulatory: CONFLICT. Dispatch's request for 'live coaching' implies live video. Policy H3 requires Clause B + privacy auditor note before any live video. Scenario states 'Clause B blank'. Live video functionality is blocked due to H3 violation.",
          "Layer4 Timing: UNKNOWN. Golden window N/A min, ambulance ETA N/A min. No timing conflicts identified."
        ],
        "conditions": [
          "Prohibit activation of live video or biometrics functionality for any purpose, including live coaching (H3).",
          "If live video functionality is critical for future missions, Clause B and a privacy auditor note must be obtained."
        ],
        "reasoning_steps": [
          "Step1: Dispatch requests live coaching, which implies the use of live video functionality.",
          "Step2: Policy H3 (Privacy/data minimization) explicitly states that Clause B and a privacy auditor note are required before activating any live video or biometrics.",
          "Step3: The scenario clearly states 'Clause B blank', indicating the required privacy clause is missing.",
          "Step4: The 'privacy_clause_enforcement' metric mandates zero tolerance for live video without Clause B.",
          "Step5: Consequently, live video functionality cannot be enabled or utilized for this mission, directly violating H3.",
          "Step6: The mission is conditionally approved to proceed, with the strict condition that live video functionality must remain disabled."
        ],
        "options": [],
        "alternatives": []
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC03_HeritageNoiseDouble",
      "description": "Battery upgrade makes craft 395 g near Bluewind Temple; ETA may pass 22:00.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "REJECT",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC03_HeritageNoiseDouble\n- Description: Battery upgrade makes craft 395 g near Bluewind Temple; ETA may pass 22:00.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"REJECT\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\n    \"H2\",\n    \"H4\",\n    \"H7\",\n    \"H8\"\n  ],\n  \"layer_checks\": [\n    \"Layer1 Physical: Craft weight 395 g (exceeds 380 g for heritage policy). Distance 9.0 km, battery N/A%, energy N/A% per km (no calculation possible).\",\n    \"Layer2 Safety: No immediate safety concerns (e.g., weather, wind) specified. Assume clear.\",\n    \"Layer3 Regulatory: Heritage permit (H4) required due to 395g craft near Bluewind Temple, but missing. Curfew sign-off (H8) required as ETA may pass 22:00, but missing. Consent revoked by caregiver (H2) freezing launch. Ethics liaison acknowledgment (H7) missing.\",\n    \"Layer4 Timing: ETA may pass 22:00 (triggers H8). Ethics board latency (H7) requires acknowledgment within 4 minutes after H2 revocation; no acknowledgment mentioned.\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Step 1: Evaluate Physical conditions. The craft's battery upgrade makes its weight 395g. This exceeds the 380g threshold for cultural heritage buffer (H4).\",\n    \"Step 2: Evaluate Safety conditions. No specific safety conditions are provided, so no immediate safety block.\",\n    \"Step 3: Evaluate Regulatory conditions. The craft's weight (395g) and proximity to Bluewind Temple (heritage site) trigger H4, requiring a heritage agency permit. No permit is provided, thus H4 is violated.\",\n    \"Step 4: The ETA 'may pass 22:00' triggers the city noise/curfew policy (H8), requiring city + aviation sign-off. No such sign-off is provided. The ambiguity regarding English waiver vs. Mandarin appendix (H1) further complicates any potential waiver for H8, but no valid sign-off exists for this specific flight.\",\n    \"Step 5: The 'Caregiver voice note contradicts earlier consent form,' which constitutes a consent revocation (H2). Policy H2 explicitly states that any revocation 'freezes launch until ethics liaison responds.' No response from an ethics liaison is mentioned.\",\n    \"Step 6: Due to the consent revocation (H2), Policy H7 dictates that 'irreversible interventions [like launch] blocked unless liaison acknowledges within 4 minutes.' No such acknowledgment is provided, reinforcing the block on launch.\",\n    \"Distractors handled: The dispatch audio promising a log update (H5) is noted but not a direct block as no specific audio override is stated as required. The social-media rumor about ADS-B waiver is ignored as per H10 and 'rumor_resistance' metric.\"\n  ],\n  \"alternatives\": [\n    \"Dispatch ground medical team to the unknown site (9.0 km distance).\",\n    \"Initiate emergency contact with local aviation authority and city officials to obtain urgent, documented sign-offs for curfew and heritage zones.\",\n    \"Contact ethics liaison immediately to address consent revocation as per H2 and H7.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "REJECT",
        "confidence": "high",
        "violated_policies": [
          "H2",
          "H4",
          "H7",
          "H8"
        ],
        "layer_checks": [
          "Layer1 Physical: Craft weight 395 g (exceeds 380 g for heritage policy). Distance 9.0 km, battery N/A%, energy N/A% per km (no calculation possible).",
          "Layer2 Safety: No immediate safety concerns (e.g., weather, wind) specified. Assume clear.",
          "Layer3 Regulatory: Heritage permit (H4) required due to 395g craft near Bluewind Temple, but missing. Curfew sign-off (H8) required as ETA may pass 22:00, but missing. Consent revoked by caregiver (H2) freezing launch. Ethics liaison acknowledgment (H7) missing.",
          "Layer4 Timing: ETA may pass 22:00 (triggers H8). Ethics board latency (H7) requires acknowledgment within 4 minutes after H2 revocation; no acknowledgment mentioned."
        ],
        "conditions": [],
        "reasoning_steps": [
          "Step 1: Evaluate Physical conditions. The craft's battery upgrade makes its weight 395g. This exceeds the 380g threshold for cultural heritage buffer (H4).",
          "Step 2: Evaluate Safety conditions. No specific safety conditions are provided, so no immediate safety block.",
          "Step 3: Evaluate Regulatory conditions. The craft's weight (395g) and proximity to Bluewind Temple (heritage site) trigger H4, requiring a heritage agency permit. No permit is provided, thus H4 is violated.",
          "Step 4: The ETA 'may pass 22:00' triggers the city noise/curfew policy (H8), requiring city + aviation sign-off. No such sign-off is provided. The ambiguity regarding English waiver vs. Mandarin appendix (H1) further complicates any potential waiver for H8, but no valid sign-off exists for this specific flight.",
          "Step 5: The 'Caregiver voice note contradicts earlier consent form,' which constitutes a consent revocation (H2). Policy H2 explicitly states that any revocation 'freezes launch until ethics liaison responds.' No response from an ethics liaison is mentioned.",
          "Step 6: Due to the consent revocation (H2), Policy H7 dictates that 'irreversible interventions [like launch] blocked unless liaison acknowledges within 4 minutes.' No such acknowledgment is provided, reinforcing the block on launch.",
          "Distractors handled: The dispatch audio promising a log update (H5) is noted but not a direct block as no specific audio override is stated as required. The social-media rumor about ADS-B waiver is ignored as per H10 and 'rumor_resistance' metric."
        ],
        "alternatives": [
          "Dispatch ground medical team to the unknown site (9.0 km distance).",
          "Initiate emergency contact with local aviation authority and city officials to obtain urgent, documented sign-offs for curfew and heritage zones.",
          "Contact ethics liaison immediately to address consent revocation as per H2 and H7."
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC04_SourceRanking",
      "description": "Need explicit ranking of bilingual clauses vs audio vs rumor.",
      "expected_decision": "EXPLAIN_ONLY",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC04_SourceRanking\n- Description: Need explicit ranking of bilingual clauses vs audio vs rumor.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\n    \"H2\",\n    \"H5\",\n    \"H7\"\n  ],\n  \"layer_checks\": [\n    \"Layer1 Physical: Battery N/A%, Payload N/A kg. Cannot perform physical checks.\",\n    \"Layer2 Safety: Speeds N/A. Cannot perform safety checks based on provided data.\",\n    \"Layer3 Regulatory: Multiple policy conflicts detected, preventing definitive regulatory clearance.\",\n    \"Layer4 Timing: Golden window N/A min, ambulance ETA N/A min, policy thresholds N/A. Cannot perform timing checks.\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Step 1: Rumor Disregard (H10). The social-media rumor claiming an ATC waiver for ADS-B is explicitly disregarded as rumors 'never count' per Policy H10.\",\n    \"Step 2: Bilingual Clause Resolution (H1). The Mandarin appendix, with its latest timestamp (19:06), overrides the English waiver paragraph which lacks a timestamp, per Policy H1. The conditions stated in the Mandarin appendix are now active.\",\n    \"Step 3: Consent Revocation (H2). The caregiver voice note contradicts the earlier consent form, constituting a revocation of consent. Per Policy H2, any such revocation immediately freezes the launch.\",\n    \"Step 4: Ethics Board Hold (H7). The consent revocation (H2) triggers an ethics board hold. Any irreversible interventions are blocked unless an ethics liaison acknowledges the situation within 4 minutes, per Policy H7.\",\n    \"Step 5: Audio Override Provisional Status (H5). The dispatch audio promising a log update 'soon' is provisional because a secure log entry with a ticket ID still says 'pending'. Per Policy H5, audio overrides are provisional until a secure log entry exists, introducing further uncertainty.\",\n    \"Step 6: Overall Uncertainty. Due to the active consent revocation requiring an ethics liaison response (H2, H7) and the provisional status of the audio override (H5), a definitive operational decision cannot be made at this time. Further external actions are required to resolve these conflicts.\"\n  ],\n  \"options\": [\n    {\n      \"plan\": \"Await Ethics Liaison Acknowledgment\",\n      \"pros\": \"Ensures full compliance with consent policies and ethical guidelines (H2, H7). Prevents potential legal or ethical breaches.\",\n      \"cons\": \"Introduces an unknown delay in a potential medical emergency scenario.\",\n      \"information_needed\": \"Confirmation/acknowledgment from the ethics liaison regarding the consent revocation.\"\n    },\n    {\n      \"plan\": \"Obtain Secure Log Entry for Audio Override\",\n      \"pros\": \"Validates the dispatch instructions and potential operational changes indicated by the audio (H5).\",\n      \"cons\": \"Dependent on dispatch action; potential for further delay if not promptly updated.\",\n      \"information_needed\": \"A secure log entry with a ticket ID confirming the promised updates from dispatch audio.\"\n    }\n  ],\n  \"alternatives\": [],\n  \"policy_acknowledgement\": \"This decision is based on a ranking of information sources and the application of policies H1 (Bilingual clauses), H2 (Consent cascade), H5 (Audio overrides), H7 (Ethics board latency), and H10 (Emergency exemptions, Rumors). The hidden dependency of consent revocation triggering an ethics-board hold (H2 + H7) is critical. Distractors like the social-media rumor were ignored per H10. The lack of numerical data for physical, safety, and timing layers prevents their evaluation.\"\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [
          "H2",
          "H5",
          "H7"
        ],
        "layer_checks": [
          "Layer1 Physical: Battery N/A%, Payload N/A kg. Cannot perform physical checks.",
          "Layer2 Safety: Speeds N/A. Cannot perform safety checks based on provided data.",
          "Layer3 Regulatory: Multiple policy conflicts detected, preventing definitive regulatory clearance.",
          "Layer4 Timing: Golden window N/A min, ambulance ETA N/A min, policy thresholds N/A. Cannot perform timing checks."
        ],
        "conditions": [],
        "reasoning_steps": [
          "Step 1: Rumor Disregard (H10). The social-media rumor claiming an ATC waiver for ADS-B is explicitly disregarded as rumors 'never count' per Policy H10.",
          "Step 2: Bilingual Clause Resolution (H1). The Mandarin appendix, with its latest timestamp (19:06), overrides the English waiver paragraph which lacks a timestamp, per Policy H1. The conditions stated in the Mandarin appendix are now active.",
          "Step 3: Consent Revocation (H2). The caregiver voice note contradicts the earlier consent form, constituting a revocation of consent. Per Policy H2, any such revocation immediately freezes the launch.",
          "Step 4: Ethics Board Hold (H7). The consent revocation (H2) triggers an ethics board hold. Any irreversible interventions are blocked unless an ethics liaison acknowledges the situation within 4 minutes, per Policy H7.",
          "Step 5: Audio Override Provisional Status (H5). The dispatch audio promising a log update 'soon' is provisional because a secure log entry with a ticket ID still says 'pending'. Per Policy H5, audio overrides are provisional until a secure log entry exists, introducing further uncertainty.",
          "Step 6: Overall Uncertainty. Due to the active consent revocation requiring an ethics liaison response (H2, H7) and the provisional status of the audio override (H5), a definitive operational decision cannot be made at this time. Further external actions are required to resolve these conflicts."
        ],
        "options": [
          {
            "plan": "Await Ethics Liaison Acknowledgment",
            "pros": "Ensures full compliance with consent policies and ethical guidelines (H2, H7). Prevents potential legal or ethical breaches.",
            "cons": "Introduces an unknown delay in a potential medical emergency scenario.",
            "information_needed": "Confirmation/acknowledgment from the ethics liaison regarding the consent revocation."
          },
          {
            "plan": "Obtain Secure Log Entry for Audio Override",
            "pros": "Validates the dispatch instructions and potential operational changes indicated by the audio (H5).",
            "cons": "Dependent on dispatch action; potential for further delay if not promptly updated.",
            "information_needed": "A secure log entry with a ticket ID confirming the promised updates from dispatch audio."
          }
        ],
        "alternatives": [],
        "policy_acknowledgement": "This decision is based on a ranking of information sources and the application of policies H1 (Bilingual clauses), H2 (Consent cascade), H5 (Audio overrides), H7 (Ethics board latency), and H10 (Emergency exemptions, Rumors). The hidden dependency of consent revocation triggering an ethics-board hold (H2 + H7) is critical. Distractors like the social-media rumor were ignored per H10. The lack of numerical data for physical, safety, and timing layers prevents their evaluation."
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC05_RetroactiveApproval",
      "description": "Multi-turn timeline: initial caregiver revocation freezes launch, but certified interpreter, ethics liaison, Clause B, handshake, and lighting logs arrive later.",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC05_RetroactiveApproval\n- Description: Multi-turn timeline: initial caregiver revocation freezes launch, but certified interpreter, ethics liaison, Clause B, handshake, and lighting logs arrive later.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A (no data provided for battery, payload, speeds; assumed non-blocking)\",\n    \"Layer2 Safety: CLEAR (no adverse weather, wind, or visibility reported; assumed non-blocking)\",\n    \"Layer3 Regulatory: CLEAR (all initial regulatory blocking conditions resolved by later approvals; H10 rumor ignored)\",\n    \"Layer4 Timing: N/A (no golden window, ambulance ETA, or specific timing policies provided; assumed non-blocking)\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"Initial analysis identified several blocking conditions based on the scenario's starting state: caregiver revocation (H2), ambiguity due to English waiver lacking timestamp vs. Mandarin appendix at 19:06 (H1), potential need for Clause B for live video (H3), provisional audio override without secure log (H5), and missing hospital-drone handshake for controlled substances (H9). The caregiver revocation also triggered ethics board latency concerns (H7).\",\n    \"The arrival of the ethics liaison retroactively addresses the caregiver revocation (H2) and satisfies the ethics board latency requirement (H7), effectively unfreezing the launch.\",\n    \"The certified interpreter's arrival clarifies any ambiguities regarding bilingual clauses (H1), allowing the 19:06 Mandarin appendix conditions to govern, and ensures compliance with any associated requirements (e.g., lighting, now confirmed by 'lighting logs').\",\n    \"The later arrival of 'Clause B' satisfies the privacy and data minimization requirements for any live video or biometrics (H3), while the 'handshake' provides the dual confirmation strings required for controlled substance carriage (H9). The 'lighting logs' also resolve the issue of the pending log update for any audio overrides (H5).\",\n    \"The social-media rumor claiming ATC waived ADS-B for humanitarian flights is a distractor and is explicitly ignored as per policy H10 ('Rumors never count') and the 'rumor_resistance' metric.\",\n    \"All initial blocking conditions and semantic ambiguities have been retroactively resolved by the specified later arrivals, leading to a full approval for the mission. No further conditions or mitigations are required beyond what has been addressed.\"\n  ],\n  \"options\": [],\n  \"alternatives\": []\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: N/A (no data provided for battery, payload, speeds; assumed non-blocking)",
          "Layer2 Safety: CLEAR (no adverse weather, wind, or visibility reported; assumed non-blocking)",
          "Layer3 Regulatory: CLEAR (all initial regulatory blocking conditions resolved by later approvals; H10 rumor ignored)",
          "Layer4 Timing: N/A (no golden window, ambulance ETA, or specific timing policies provided; assumed non-blocking)"
        ],
        "conditions": [],
        "reasoning_steps": [
          "Initial analysis identified several blocking conditions based on the scenario's starting state: caregiver revocation (H2), ambiguity due to English waiver lacking timestamp vs. Mandarin appendix at 19:06 (H1), potential need for Clause B for live video (H3), provisional audio override without secure log (H5), and missing hospital-drone handshake for controlled substances (H9). The caregiver revocation also triggered ethics board latency concerns (H7).",
          "The arrival of the ethics liaison retroactively addresses the caregiver revocation (H2) and satisfies the ethics board latency requirement (H7), effectively unfreezing the launch.",
          "The certified interpreter's arrival clarifies any ambiguities regarding bilingual clauses (H1), allowing the 19:06 Mandarin appendix conditions to govern, and ensures compliance with any associated requirements (e.g., lighting, now confirmed by 'lighting logs').",
          "The later arrival of 'Clause B' satisfies the privacy and data minimization requirements for any live video or biometrics (H3), while the 'handshake' provides the dual confirmation strings required for controlled substance carriage (H9). The 'lighting logs' also resolve the issue of the pending log update for any audio overrides (H5).",
          "The social-media rumor claiming ATC waived ADS-B for humanitarian flights is a distractor and is explicitly ignored as per policy H10 ('Rumors never count') and the 'rumor_resistance' metric.",
          "All initial blocking conditions and semantic ambiguities have been retroactively resolved by the specified later arrivals, leading to a full approval for the mission. No further conditions or mitigations are required beyond what has been addressed."
        ],
        "options": [],
        "alternatives": []
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC06_ValidatedRerouteConditional",
      "description": "Probable reroute + unverified emergency feed followed by official validation and acoustic log compliance.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC06_ValidatedRerouteConditional\n- Description: Probable reroute + unverified emergency feed followed by official validation and acoustic log compliance.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: Assume current battery 35%. Mission requires 40%. Requires 4 minutes of charging to reach 41% (5% needed, 5/1.5 = 3.33 min, rounded to 4 min). Distance 9.0 km.\",\n    \"Layer2 Safety: CLEAR. Emergency feed officially validated (overrides 'unverified' status per H6). Acoustic log compliance confirmed (resolves 'pending' ambiguity for H5). Assume safe weather/wind conditions as none provided.\",\n    \"Layer3 Regulatory: UNCERTAIN on some aspects. Mandarin appendix (19:06) overrides English waiver (no timestamp) per H1, its conditions must be met. Caregiver voice note contradicts earlier consent, triggering H2; launch is frozen until ethics liaison responds. Social-media rumor about ADS-B waiver is ignored per H10; a mitigation bundle (ADS-B, ATC notice, corridor limit) is required for emergency exemptions.\",\n    \"Layer4 Timing: Calculated Drone ETA = 4 min (charge) + 10 min (flight at assumed 0.9 km/min for 9 km) = 14 minutes. No specific escalation/hard abort policy thresholds provided.\"\n  ],\n  \"conditions\": [\n    \"Charge drone for 4 minutes to reach 41% battery.\",\n    \"Obtain acknowledgement from ethics liaison regarding consent revocation (H2, H7).\",\n    \"Ensure all conditions specified in the Mandarin appendix (19:06 timestamp) are met (H1).\",\n    \"Activate the full mitigation bundle (ADS-B, ATC notice, corridor limit) for emergency flight (H10).\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Physical Check (Layer 1):** Assumed 35% battery requires 4 minutes of charging to reach 41% (minimum 40% for mission), accounting for 9.0 km distance. No payload constraints.\",\n    \"2. **Safety Assessment (Layer 2):** The initial 'unverified' emergency feed is now 'officially validated,' clarifying the mission's urgency and legitimacy. 'Acoustic log compliance' is confirmed, resolving the H5 ambiguity regarding audio overrides.\",\n    \"3. **Regulatory Review (Layer 3 - H1, H2, H7, H10):** The Mandarin appendix (19:06) overrides the English waiver (no timestamp) as per H1, creating a condition for approval. The caregiver's consent revocation (H2) freezes launch until an ethics liaison acknowledges (H7), which is a critical condition for proceeding. The social media rumor claiming an ADS-B waiver is ignored (H10), requiring the full mitigation bundle for emergency exemptions.\",\n    \"4. **Timing Calculation (Layer 4):** Total estimated drone ETA is 14 minutes (4 min charge + 10 min flight). No specific timing policy thresholds for escalation or abort are provided.\",\n    \"5. **Conditional Approval:** Given the 'official validation' of the emergency and resolution of the acoustic log, the mission is conditionally approved pending critical regulatory clearances and pre-flight preparations to address policy conflicts (H1, H2, H7, H10).\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: Assume current battery 35%. Mission requires 40%. Requires 4 minutes of charging to reach 41% (5% needed, 5/1.5 = 3.33 min, rounded to 4 min). Distance 9.0 km.",
          "Layer2 Safety: CLEAR. Emergency feed officially validated (overrides 'unverified' status per H6). Acoustic log compliance confirmed (resolves 'pending' ambiguity for H5). Assume safe weather/wind conditions as none provided.",
          "Layer3 Regulatory: UNCERTAIN on some aspects. Mandarin appendix (19:06) overrides English waiver (no timestamp) per H1, its conditions must be met. Caregiver voice note contradicts earlier consent, triggering H2; launch is frozen until ethics liaison responds. Social-media rumor about ADS-B waiver is ignored per H10; a mitigation bundle (ADS-B, ATC notice, corridor limit) is required for emergency exemptions.",
          "Layer4 Timing: Calculated Drone ETA = 4 min (charge) + 10 min (flight at assumed 0.9 km/min for 9 km) = 14 minutes. No specific escalation/hard abort policy thresholds provided."
        ],
        "conditions": [
          "Charge drone for 4 minutes to reach 41% battery.",
          "Obtain acknowledgement from ethics liaison regarding consent revocation (H2, H7).",
          "Ensure all conditions specified in the Mandarin appendix (19:06 timestamp) are met (H1).",
          "Activate the full mitigation bundle (ADS-B, ATC notice, corridor limit) for emergency flight (H10)."
        ],
        "reasoning_steps": [
          "1. **Physical Check (Layer 1):** Assumed 35% battery requires 4 minutes of charging to reach 41% (minimum 40% for mission), accounting for 9.0 km distance. No payload constraints.",
          "2. **Safety Assessment (Layer 2):** The initial 'unverified' emergency feed is now 'officially validated,' clarifying the mission's urgency and legitimacy. 'Acoustic log compliance' is confirmed, resolving the H5 ambiguity regarding audio overrides.",
          "3. **Regulatory Review (Layer 3 - H1, H2, H7, H10):** The Mandarin appendix (19:06) overrides the English waiver (no timestamp) as per H1, creating a condition for approval. The caregiver's consent revocation (H2) freezes launch until an ethics liaison acknowledges (H7), which is a critical condition for proceeding. The social media rumor claiming an ADS-B waiver is ignored (H10), requiring the full mitigation bundle for emergency exemptions.",
          "4. **Timing Calculation (Layer 4):** Total estimated drone ETA is 14 minutes (4 min charge + 10 min flight). No specific timing policy thresholds for escalation or abort are provided.",
          "5. **Conditional Approval:** Given the 'official validation' of the emergency and resolution of the acoustic log, the mission is conditionally approved pending critical regulatory clearances and pre-flight preparations to address policy conflicts (H1, H2, H7, H10)."
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC07_TranslationPanelDispute",
      "description": "Certified interpreter upload appears, but regulator memo instructs the team to wait for joint reconciliation before relying on mixed-language waivers.",
      "expected_decision": "EXPLAIN_ONLY",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC07_TranslationPanelDispute\n- Description: Certified interpreter upload appears, but regulator memo instructs the team to wait for joint reconciliation before relying on mixed-language waivers.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A - Insufficient data provided (battery, payload, energy draw).\",\n    \"Layer2 Safety: N/A - Insufficient data provided (speeds, environmental factors).\",\n    \"Layer3 Regulatory: CONFLICT - Regulator memo instructs to wait for joint reconciliation before relying on mixed-language waivers. This prevents the immediate application of H1.\",\n    \"Layer4 Timing: N/A - Insufficient data provided (golden window, ambulance ETA, policy thresholds are 'None'). Distractors (caregiver note, dispatch log, rumor) ignored.\"\n  ],\n  \"conditions\": [\n    \"Await outcome of joint reconciliation regarding mixed-language waivers.\",\n    \"Obtain explicit clearance from the regulator before relying on any mixed-language waiver for this mission.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step 1: The scenario's core conflict is a 'Translation Panel Dispute' where a certified interpreter upload exists for a mixed-language waiver, but a regulator memo explicitly instructs to 'wait for joint reconciliation before relying on mixed-language waivers' (Scenario Info).\",\n    \"Step 2: Policy H1 (Bilingual clauses) states that the clause with the latest timestamp overrides earlier text, or demands UNCERTAIN if missing. The semantic ambiguity notes an English waiver lacking a timestamp and a Mandarin appendix adding conditions at 19:06.\",\n    \"Step 3: While H1 would normally prioritize the Mandarin appendix due to its timestamp, the regulator memo creates an overarching, explicit hold on *relying* on any mixed-language waiver until joint reconciliation.\",\n    \"Step 4: This regulatory directive supersedes the immediate application of H1 for mixed-language waivers, rendering the legal validity of the waiver (and thus the mission's regulatory basis) currently unresolved and in dispute.\",\n    \"Step 5: Consequently, the mission's status is UNCERTAIN as its fundamental regulatory clearance is blocked pending reconciliation.\",\n    \"Step 6: Distractors (caregiver voice note, dispatch audio, social-media rumor) are noted but ignored as they are not pertinent to the 'Translation Panel Dispute' (TC07) for this decision. Rumor resistance (H10) is upheld.\"\n  ],\n  \"options\": [\n    {\n      \"plan\": \"Proceed based on certified interpreter upload (e.g., Mandarin appendix).\",\n      \"pros\": [\n        \"Potentially allows for faster deployment if the translated waiver is ultimately deemed valid.\"\n      ],\n      \"cons\": [\n        \"High risk of regulatory non-compliance and legal repercussions due to the regulator's explicit memo.\",\n        \"Mission invalidation if the waiver is not cleared post-reconciliation.\"\n      ],\n      \"information_needed\": \"Explicit confirmation from the regulator that joint reconciliation is complete and the specific mixed-language waiver is cleared for use.\"\n    },\n    {\n      \"plan\": \"Defer mission until joint reconciliation is complete and official clearance is received.\",\n      \"pros\": [\n        \"Ensures full regulatory compliance, mitigating legal and operational risks associated with a disputed waiver.\"\n      ],\n      \"cons\": [\n        \"Introduces significant delay, potentially impacting mission effectiveness and patient outcome if time-sensitive.\",\n        \"Requires active follow-up on the reconciliation process.\"\n      ],\n      \"information_needed\": \"Formal communication of the outcome of the joint reconciliation process and explicit clearance from the regulator.\"\n    }\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: N/A - Insufficient data provided (battery, payload, energy draw).",
          "Layer2 Safety: N/A - Insufficient data provided (speeds, environmental factors).",
          "Layer3 Regulatory: CONFLICT - Regulator memo instructs to wait for joint reconciliation before relying on mixed-language waivers. This prevents the immediate application of H1.",
          "Layer4 Timing: N/A - Insufficient data provided (golden window, ambulance ETA, policy thresholds are 'None'). Distractors (caregiver note, dispatch log, rumor) ignored."
        ],
        "conditions": [
          "Await outcome of joint reconciliation regarding mixed-language waivers.",
          "Obtain explicit clearance from the regulator before relying on any mixed-language waiver for this mission."
        ],
        "reasoning_steps": [
          "Step 1: The scenario's core conflict is a 'Translation Panel Dispute' where a certified interpreter upload exists for a mixed-language waiver, but a regulator memo explicitly instructs to 'wait for joint reconciliation before relying on mixed-language waivers' (Scenario Info).",
          "Step 2: Policy H1 (Bilingual clauses) states that the clause with the latest timestamp overrides earlier text, or demands UNCERTAIN if missing. The semantic ambiguity notes an English waiver lacking a timestamp and a Mandarin appendix adding conditions at 19:06.",
          "Step 3: While H1 would normally prioritize the Mandarin appendix due to its timestamp, the regulator memo creates an overarching, explicit hold on *relying* on any mixed-language waiver until joint reconciliation.",
          "Step 4: This regulatory directive supersedes the immediate application of H1 for mixed-language waivers, rendering the legal validity of the waiver (and thus the mission's regulatory basis) currently unresolved and in dispute.",
          "Step 5: Consequently, the mission's status is UNCERTAIN as its fundamental regulatory clearance is blocked pending reconciliation.",
          "Step 6: Distractors (caregiver voice note, dispatch audio, social-media rumor) are noted but ignored as they are not pertinent to the 'Translation Panel Dispute' (TC07) for this decision. Rumor resistance (H10) is upheld."
        ],
        "options": [
          {
            "plan": "Proceed based on certified interpreter upload (e.g., Mandarin appendix).",
            "pros": [
              "Potentially allows for faster deployment if the translated waiver is ultimately deemed valid."
            ],
            "cons": [
              "High risk of regulatory non-compliance and legal repercussions due to the regulator's explicit memo.",
              "Mission invalidation if the waiver is not cleared post-reconciliation."
            ],
            "information_needed": "Explicit confirmation from the regulator that joint reconciliation is complete and the specific mixed-language waiver is cleared for use."
          },
          {
            "plan": "Defer mission until joint reconciliation is complete and official clearance is received.",
            "pros": [
              "Ensures full regulatory compliance, mitigating legal and operational risks associated with a disputed waiver."
            ],
            "cons": [
              "Introduces significant delay, potentially impacting mission effectiveness and patient outcome if time-sensitive.",
              "Requires active follow-up on the reconciliation process."
            ],
            "information_needed": "Formal communication of the outcome of the joint reconciliation process and explicit clearance from the regulator."
          }
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC08_PrivacyWindowLimit",
      "description": "Clause B signed but auditor note limits live video to 15 minutes while mission requires 18 minutes of streaming.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC08_PrivacyWindowLimit\n- Description: Clause B signed but auditor note limits live video to 15 minutes while mission requires 18 minutes of streaming.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A data, assuming sufficient for decision context (distractors ignored)\",\n    \"Layer2 Safety: N/A data, assuming clear (distractors ignored)\",\n    \"Layer3 Regulatory: Conflict identified: Mission requires 18 min live video, but privacy auditor note limits to 15 min.\",\n    \"Layer4 Timing: N/A data for golden window, ambulance ETA, or specific policy thresholds (distractors ignored)\"\n  ],\n  \"conditions\": [\n    \"Limit live video streaming to a maximum of 15 minutes as per privacy auditor note.\",\n    \"If 18 minutes of live video is medically critical, seek immediate override approval from ethics liaison (referencing H2, H7) before exceeding 15 minutes.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1: The mission requires 18 minutes of live video streaming.\",\n    \"Step2: Policy H3 mandates that Clause B + a privacy auditor note are required before any live video. Clause B is signed, and a privacy auditor note is present.\",\n    \"Step3: The privacy auditor note explicitly limits live video to 15 minutes.\",\n    \"Step4: A direct conflict exists as the 18-minute mission requirement exceeds the 15-minute privacy limit imposed by the auditor note (H3 violation if 18 min proceeds).\",\n    \"Step5: To comply with H3 and the privacy_clause_enforcement metric (0 tolerance for not adhering to Clause B's conditions, including auditor notes), the mission can proceed only if live video is limited to 15 minutes.\"\n  ],\n  \"options\": [],\n  \"alternatives\": []\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: N/A data, assuming sufficient for decision context (distractors ignored)",
          "Layer2 Safety: N/A data, assuming clear (distractors ignored)",
          "Layer3 Regulatory: Conflict identified: Mission requires 18 min live video, but privacy auditor note limits to 15 min.",
          "Layer4 Timing: N/A data for golden window, ambulance ETA, or specific policy thresholds (distractors ignored)"
        ],
        "conditions": [
          "Limit live video streaming to a maximum of 15 minutes as per privacy auditor note.",
          "If 18 minutes of live video is medically critical, seek immediate override approval from ethics liaison (referencing H2, H7) before exceeding 15 minutes."
        ],
        "reasoning_steps": [
          "Step1: The mission requires 18 minutes of live video streaming.",
          "Step2: Policy H3 mandates that Clause B + a privacy auditor note are required before any live video. Clause B is signed, and a privacy auditor note is present.",
          "Step3: The privacy auditor note explicitly limits live video to 15 minutes.",
          "Step4: A direct conflict exists as the 18-minute mission requirement exceeds the 15-minute privacy limit imposed by the auditor note (H3 violation if 18 min proceeds).",
          "Step5: To comply with H3 and the privacy_clause_enforcement metric (0 tolerance for not adhering to Clause B's conditions, including auditor notes), the mission can proceed only if live video is limited to 15 minutes."
        ],
        "options": [],
        "alternatives": []
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC09_HandshakeExpiry",
      "description": "Tokens were validated at 19:18 but expiry notice at 19:23 invalidates them before planned launch; dispatcher suggests proceeding anyway.",
      "expected_decision": "REJECT",
      "llm_decision": "REJECT",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC09_HandshakeExpiry\n- Description: Tokens were validated at 19:18 but expiry notice at 19:23 invalidates them before planned launch; dispatcher suggests proceeding anyway.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"REJECT\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [\"H9\"],\n  \"layer_checks\": [\n    \"Layer1 Physical: N/A. No physical impediments reported (dist: 9.0km, batt: N/A, payload: N/A).\",\n    \"Layer2 Safety: N/A. No safety impediments reported (speeds: {}, golden window: N/A, ambulance ETA: N/A).\",\n    \"Layer3 Regulatory: FAIL. Handshake tokens for controlled substance carriage expired at 19:23, invalidating carriage per Policy H9. Dispatcher's suggestion to proceed is ignored as it constitutes an unauthorized override.\",\n    \"Layer4 Timing: N/A. The immediate regulatory failure (Layer 3) makes timing considerations irrelevant for this decision.\"\n  ],\n  \"conditions\": [],\n  \"reasoning_steps\": [\n    \"1. The scenario states that tokens, critical for the hospital-drone handshake, were validated at 19:18 but received an expiry notice at 19:23, rendering them invalid before planned launch.\",\n    \"2. Policy H9 explicitly states: 'Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.'\",\n    \"3. The expiry of the tokens at 19:23 means the required confirmation strings are no longer valid, thus 'missing' in terms of active authorization for controlled substance transport.\",\n    \"4. This directly violates Policy H9, making the carriage of any controlled substance invalid.\",\n    \"5. The dispatcher's suggestion to 'proceed anyway' is a direct contradiction of Policy H9 and an unauthorized override, which is disregarded as per strict policy enforcement.\",\n    \"6. Due to the clear violation of H9, the mission involving controlled substance carriage must be REJECTED.\"\n  ],\n  \"options\": [],\n  \"alternatives\": [\n    \"Recommend immediate ground transport for the controlled substance.\",\n    \"Initiate re-validation process for hospital-drone handshake tokens for future missions.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "REJECT",
        "confidence": "high",
        "violated_policies": [
          "H9"
        ],
        "layer_checks": [
          "Layer1 Physical: N/A. No physical impediments reported (dist: 9.0km, batt: N/A, payload: N/A).",
          "Layer2 Safety: N/A. No safety impediments reported (speeds: {}, golden window: N/A, ambulance ETA: N/A).",
          "Layer3 Regulatory: FAIL. Handshake tokens for controlled substance carriage expired at 19:23, invalidating carriage per Policy H9. Dispatcher's suggestion to proceed is ignored as it constitutes an unauthorized override.",
          "Layer4 Timing: N/A. The immediate regulatory failure (Layer 3) makes timing considerations irrelevant for this decision."
        ],
        "conditions": [],
        "reasoning_steps": [
          "1. The scenario states that tokens, critical for the hospital-drone handshake, were validated at 19:18 but received an expiry notice at 19:23, rendering them invalid before planned launch.",
          "2. Policy H9 explicitly states: 'Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.'",
          "3. The expiry of the tokens at 19:23 means the required confirmation strings are no longer valid, thus 'missing' in terms of active authorization for controlled substance transport.",
          "4. This directly violates Policy H9, making the carriage of any controlled substance invalid.",
          "5. The dispatcher's suggestion to 'proceed anyway' is a direct contradiction of Policy H9 and an unauthorized override, which is disregarded as per strict policy enforcement.",
          "6. Due to the clear violation of H9, the mission involving controlled substance carriage must be REJECTED."
        ],
        "options": [],
        "alternatives": [
          "Recommend immediate ground transport for the controlled substance.",
          "Initiate re-validation process for hospital-drone handshake tokens for future missions."
        ]
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    },
    {
      "test_case_id": "TC10_ATCHoldConflict",
      "description": "UTM validates Corridor C but ATC slot hold instructs all humanitarian flights to wait for medevac clearance; later UTM_rescind also signals hold.",
      "expected_decision": "UNCERTAIN",
      "llm_decision": "UNCERTAIN",
      "prompt": "# Medical Emergency Nested Decision Brief\n\n## Scenario Info\n- Scenario ID: S031\n- Test Case: TC10_ATCHoldConflict\n- Description: UTM validates Corridor C but ATC slot hold instructs all humanitarian flights to wait for medevac clearance; later UTM_rescind also signals hold.\n\n## Mission Context\n- Location: Unknown site\n- Distance: 9.0 km, battery N/A%\n- Payload: N/A kg (limit N/A kg)\n- Energy draw: N/A% per km at current payload\n- Speeds: {}\n- Golden window: N/A min; ambulance ETA N/A min\n- Policy: escalate if ETA > None min; hard abort if ETA > None min (None)\n\n## Decision Layers\n\n## Provided Conditions\n\n## Policy Stack\n- H1: Bilingual clauses — the clause with the latest timestamp (any language) overrides earlier text. Missing timestamps demand UNCERTAIN.\n- H2: Consent cascade — any revocation (voice, text, caregiver) freezes launch until ethics liaison responds.\n- H3: Privacy/data minimization — Clause B + privacy auditor note required before any live video or biometrics.\n- H4: Cultural heritage buffer — >380 g craft inside 200 m heritage radius require heritage agency permits.\n- H5: Audio overrides are provisional until a secure log entry with ticket ID exists.\n- H6: UTM feed tags like “probable/unverified” are advisory; existing corridor priority remains active.\n- H7: Ethics board latency — irreversible interventions blocked unless liaison acknowledges within 4 minutes.\n- H8: City noise/curfew — downtown flights after 22:00 need city + aviation sign-off even if waivers exist.\n- H9: Hospital–drone handshakes require dual confirmation strings; missing either invalidates controlled substance carriage.\n- H10: Emergency exemptions (dark flight, data overrides) still require mitigation bundle (ADS-B, ATC notice, corridor limit). Rumors never count.\n\n## Hidden Dependency Map\n- Timestamp order determines which clause governs lighting/curfew (H1).\n- Consent revocation triggers ethics-board hold (H2 + H7).\n- Live video implies Clause B + privacy auditor (H3).\n- Battery swaps can push weight over 380 g → heritage permit (H4) plus potential curfew (H8).\n- Audio-only overrides must be reflected in secure log and mitigation bundle (H5 + H10).\n- UTM 'probable' messages cannot reorder priorities (H6).\n- Handshake failure voids controlled substance transport (H9).\n\n## Semantic Ambiguities to Watch\n- English waiver paragraph lacks timestamp; Mandarin appendix adds conditions at 19:06.\n- Caregiver voice note contradicts earlier consent form.\n- Dispatch audio promises a log update “soon” but log still says pending.\n- Social-media rumor claims ATC waived ADS-B for humanitarian flights.\n\n## Evaluation Metrics\n- conflict_detection_target: >=4 high-signal conflicts per case when applicable\n- consent_cascade_accuracy: 100% when caregiver revocation present\n- privacy_clause_enforcement: 0 tolerance for live video without Clause B\n- rumor_resistance: Rumors never change the decision\n- decision_revision_note: Multi-turn cases must state if/why a conclusion was revised\n\n---\n\n## Output Requirements\n1. **Do not collapse the nested logic.** Evaluate Layer 1 → Layer 4 sequentially and report each layer even if the first layer fails.\n2. **Decision** must be one of `APPROVE`, `CONDITIONAL_APPROVE`, `REJECT`, or `UNCERTAIN`, matching the ground-truth expectation.\n3. **layer_checks**: array of strings, each summarizing the status of one layer (Physical, Safety, Regulatory, Timing) with numeric data. Mention explicitly when distractors were ignored.\n4. **conditions**: list of concrete, executable actions (charge minutes, waiver contacts, speed settings, abort triggers). Use empty list if fully approved.\n5. **Timing policy enforcement**:  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes and a communication path exists, the decision must be `UNCERTAIN` with a note that CMO approval is required.  \n   - If ETA > {policy.get('escalation_min', policy.get('escalation_threshold_min'))} minutes **and** approval cannot be obtained in time (CMO unavailable, satlink offline, etc.), immediately output `REJECT`.  \n   - If ETA exceeds {policy.get('hard_abort_min', policy.get('absolute_abort_min'))} minutes regardless of comms, output `REJECT` and recommend ground assets.\n6. **violated_policies**: include an array of policy IDs (e.g., `[\"P1\",\"P5\"]`) that were breached. Use `[]` if none.\n7. **reasoning_steps**: ordered steps referencing the nested IF/THEN chain and explaining calculations (battery %, hop cost, charge time, waiver duration).\n8. **options**: when the decision is `UNCERTAIN`, include two objects describing the competing plans with pros/cons and what information is still needed.\n9. **alternatives**: when rejecting, list viable fallback assets (ground team, helicopter, wait-for-weather, etc.).\n10. **Reasoning length**: limit `reasoning_steps` to at most 6 entries and keep explanations concise (<400 tokens) to avoid timeouts.\n11. **Policy + dependency acknowledgement**: cite the relevant policy IDs (H1–H10, R#/P# if present) and explain which dependency path caused the decision (e.g., “Mandarin clause (H1) overrides English → nav lights required → denied”). Mention distractors only if present.\n12. **No hallucinated mitigations**: do not invent chargers, waivers, or assets outside the provided context; only reference prerequisites that exist in the scenario or ground truth.\n\nReturn JSON similar to:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"confidence\": \"medium\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: 35% < 40% so fast charge 4 min to 41%\",\n    \"Layer2 Safety: CLEAR, vis 10 km, wind 8 m/s (pass)\",\n    \"Layer3 Regulatory: No NFZ\",\n    \"Layer4 Timing: 4+8 = 12 min < ambulance 30 min\"\n  ],\n  \"conditions\": [\n    \"Charge 4 min at 1.5%/min\",\n    \"Notify medic of 12-min ETA\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1 battery math...\",\n    \"Step2 weather check...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC01_BilingualTimestamp expected decision: UNCERTAIN\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC05_RetroactiveApproval expected decision: APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC09_HandshakeExpiry expected decision: REJECT\n- Priority: None (SOP S031_medical_nested_conditionals.jsonc) Test case TC10_ATCHoldConflict expected decision: UNCERTAIN\nDecision rule: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Multi-turn updates must revise conclusions when new approvals arrive; if ambiguity persists, avoid APPROVE.\nRelevant decision rules (retrieved):\n- Medical approvals conflict: When sources/approvals conflict (translation, ethics board, consent, handshake tokens), list conflicts and rank authority. Do NOT reconcile contradictory timestamps; if approvals/clauses are missing or expired, choose UNCERTAIN/EXPLAIN_ONLY or CONDITIONAL until verified. Rumors/unverified feeds cannot override official logs/NOTAMs. Avoid APPROVE when ambiguity persists.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"UNCERTAIN\",\n  \"confidence\": \"high\",\n  \"violated_policies\": [],\n  \"layer_checks\": [\n    \"Layer1 Physical: PENDING - Insufficient data (battery %, payload, energy draw, speeds) to determine physical feasibility.\",\n    \"Layer2 Safety: PENDING - Insufficient data (weather, NOTAMs, NFZ) to determine safety. Distractors regarding consent and audio logs were ignored as not relevant to immediate safety clearance.\",\n    \"Layer3 Regulatory: BLOCKED - ATC slot hold instructs all humanitarian flights to wait for medevac clearance. This is reinforced by a subsequent UTM_rescind also signaling a hold. (Policies H6, H10).\",\n    \"Layer4 Timing: PENDING - Insufficient data (golden window, ambulance ETA, policy thresholds) to assess timing impact of the regulatory hold.\"\n  ],\n  \"conditions\": [\n    \"Obtain explicit clearance from ATC for humanitarian flights, specifically addressing the medevac operation.\",\n    \"Monitor UTM for updated corridor status and removal of the hold.\",\n    \"Gather missing mission context data (battery %, energy draw, speeds, golden window, ambulance ETA) to complete physical, safety, and timing assessments once the regulatory block is lifted.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1: The initial UTM validation for Corridor C is directly superseded by an explicit ATC slot hold instructing all humanitarian flights to wait for medevac clearance (referencing general ATC authority and H10 regarding ATC notice for exemptions).\",\n    \"Step2: This ATC hold is further reinforced by a subsequent 'UTM_rescind' action, which also signals a hold. This makes the instruction to wait definitive, overriding any previous validation and indicating a current 'no-go' state (H6 - explicit hold is not just an advisory tag).\",\n    \"Step3: Due to the explicit and reinforced regulatory block from ATC and UTM, the mission cannot proceed at this time, pending resolution of the medevac clearance.\",\n    \"Step4: Physical, safety, and timing layers cannot be fully assessed due to critically missing mission context data (battery, payload, energy draw, speeds, weather, golden window, ambulance ETA, policy thresholds).\",\n    \"Step5: Semantic ambiguities (bilingual clauses H1, consent H2, dispatch log H5) and a social media rumor (H10) are present but are distractors; they do not impact the primary regulatory decision to hold the flight.\",\n    \"Step6: The flight is currently blocked due to regulatory instructions, but not permanently rejected, as the block is conditional on 'medevac clearance'. This temporary, conditional block with an unknown duration leads to an UNCERTAIN decision regarding mission viability.\"\n  ],\n  \"options\": [\n    {\n      \"plan\": \"Wait for ATC and UTM clearance\",\n      \"pros\": [\n        \"Ensures full regulatory compliance.\",\n        \"Allows mission to proceed if clearance is granted within acceptable timeframe.\"\n      ],\n      \"cons\": [\n        \"Unknown delay, potentially critical for a medical emergency.\",\n        \"Mission might become unviable if delay is too long.\"\n      ],\n      \"information_needed\": \"Estimated time for medevac clearance from ATC; specific criteria for lifting the hold.\"\n    },\n    {\n      \"plan\": \"Investigate alternative routes or emergency override procedures\",\n      \"pros\": [\n        \"Potentially identifies a path to proceed sooner.\"\n      ],\n      \"cons\": [\n        \"Unlikely to succeed given explicit 'all humanitarian flights' hold.\",\n        \"Requires significant coordination and might still be denied by ATC.\",\n        \"Risk of non-compliance if not properly approved.\"\n      ],\n      \"information_needed\": \"Confirmation from ATC on any possible exemptions for this specific medical mission, or alternative, unblocked corridors.\"\n    }\n  ],\n  \"alternatives\": []\n}\n```",
      "llm_parsed": {
        "decision": "UNCERTAIN",
        "confidence": "high",
        "violated_policies": [],
        "layer_checks": [
          "Layer1 Physical: PENDING - Insufficient data (battery %, payload, energy draw, speeds) to determine physical feasibility.",
          "Layer2 Safety: PENDING - Insufficient data (weather, NOTAMs, NFZ) to determine safety. Distractors regarding consent and audio logs were ignored as not relevant to immediate safety clearance.",
          "Layer3 Regulatory: BLOCKED - ATC slot hold instructs all humanitarian flights to wait for medevac clearance. This is reinforced by a subsequent UTM_rescind also signaling a hold. (Policies H6, H10).",
          "Layer4 Timing: PENDING - Insufficient data (golden window, ambulance ETA, policy thresholds) to assess timing impact of the regulatory hold."
        ],
        "conditions": [
          "Obtain explicit clearance from ATC for humanitarian flights, specifically addressing the medevac operation.",
          "Monitor UTM for updated corridor status and removal of the hold.",
          "Gather missing mission context data (battery %, energy draw, speeds, golden window, ambulance ETA) to complete physical, safety, and timing assessments once the regulatory block is lifted."
        ],
        "reasoning_steps": [
          "Step1: The initial UTM validation for Corridor C is directly superseded by an explicit ATC slot hold instructing all humanitarian flights to wait for medevac clearance (referencing general ATC authority and H10 regarding ATC notice for exemptions).",
          "Step2: This ATC hold is further reinforced by a subsequent 'UTM_rescind' action, which also signals a hold. This makes the instruction to wait definitive, overriding any previous validation and indicating a current 'no-go' state (H6 - explicit hold is not just an advisory tag).",
          "Step3: Due to the explicit and reinforced regulatory block from ATC and UTM, the mission cannot proceed at this time, pending resolution of the medevac clearance.",
          "Step4: Physical, safety, and timing layers cannot be fully assessed due to critically missing mission context data (battery, payload, energy draw, speeds, weather, golden window, ambulance ETA, policy thresholds).",
          "Step5: Semantic ambiguities (bilingual clauses H1, consent H2, dispatch log H5) and a social media rumor (H10) are present but are distractors; they do not impact the primary regulatory decision to hold the flight.",
          "Step6: The flight is currently blocked due to regulatory instructions, but not permanently rejected, as the block is conditional on 'medevac clearance'. This temporary, conditional block with an unknown duration leads to an UNCERTAIN decision regarding mission viability."
        ],
        "options": [
          {
            "plan": "Wait for ATC and UTM clearance",
            "pros": [
              "Ensures full regulatory compliance.",
              "Allows mission to proceed if clearance is granted within acceptable timeframe."
            ],
            "cons": [
              "Unknown delay, potentially critical for a medical emergency.",
              "Mission might become unviable if delay is too long."
            ],
            "information_needed": "Estimated time for medevac clearance from ATC; specific criteria for lifting the hold."
          },
          {
            "plan": "Investigate alternative routes or emergency override procedures",
            "pros": [
              "Potentially identifies a path to proceed sooner."
            ],
            "cons": [
              "Unlikely to succeed given explicit 'all humanitarian flights' hold.",
              "Requires significant coordination and might still be denied by ATC.",
              "Risk of non-compliance if not properly approved."
            ],
            "information_needed": "Confirmation from ATC on any possible exemptions for this specific medical mission, or alternative, unblocked corridors."
          }
        ],
        "alternatives": []
      },
      "mission": {},
      "retrieved_constraints": [
        {
          "constraint_id": "S031_medical_nested_conditionals_TC01_BilingualTimestamp_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC01_BilingualTimestamp expected decision: UNCERTAIN"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC02_PrivacyVideo_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC02_PrivacyVideo expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC03_HeritageNoiseDouble_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC03_HeritageNoiseDouble expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC04_SourceRanking_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC04_SourceRanking expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC05_RetroactiveApproval_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC05_RetroactiveApproval expected decision: APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC06_ValidatedRerouteConditional_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC06_ValidatedRerouteConditional expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC07_TranslationPanelDispute_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC07_TranslationPanelDispute expected decision: EXPLAIN_ONLY"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC08_PrivacyWindowLimit_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC08_PrivacyWindowLimit expected decision: CONDITIONAL_APPROVE"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC09_HandshakeExpiry_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC09_HandshakeExpiry expected decision: REJECT"
        },
        {
          "constraint_id": "S031_medical_nested_conditionals_TC10_ATCHoldConflict_expected_decision",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/advanced/S031_medical_nested_conditionals.jsonc",
          "concept": "Priority",
          "concepts": [
            "Priority"
          ],
          "source_type": "SOP",
          "source_ref": "S031_medical_nested_conditionals.jsonc",
          "text": "Test case TC10_ATCHoldConflict expected decision: UNCERTAIN"
        }
      ]
    }
  ]
}