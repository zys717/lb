{
  "scenario": "S020",
  "summary": {
    "total_test_cases": 4,
    "llm_calls": 4,
    "llm_accuracy": "4/4",
    "llm_accuracy_percent": "100.0%"
  },
  "results": [
    {
      "test_case_id": "TC1_ApprovalTooLate",
      "description": "申请时间过晚：距离飞行仅6小时，未满足36小时要求",
      "expected_decision": "REJECT",
      "llm_decision": "REJECT",
      "mission": {
        "target_xyz": {
          "x": 1000.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "targets": [
          {
            "x": 1000.0,
            "y": 0.0,
            "z": 50.0
          }
        ],
        "current_time": "2024-10-20T10:00:00Z",
        "application_time": "2024-10-21T09:00:00Z",
        "planned_flight_time": "2024-10-21T15:00:00Z",
        "flight_type": "normal",
        "in_controlled_zone": true,
        "timeline_eval": [
          {
            "target": {
              "x": 1000.0,
              "y": 0.0,
              "z": 50.0
            },
            "in_controlled_zone": true,
            "altitude": 50.0,
            "requires_approval": true,
            "time_diff_hours": 6.0,
            "advance_hours_required": 36,
            "boundary_mode": "inclusive",
            "flight_type": "normal",
            "status": "VIOLATION",
            "reason": "insufficient_notice",
            "phase": null
          }
        ],
        "timeline_recommendation": "REJECT",
        "altitude_eval": {
          "mission_altitude": 50.0,
          "limit": 50.0,
          "status": "OK"
        }
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\nApproval timeline checks (pre-computed):\n  - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=6.0 advance_required=36 flight_type=normal => status=VIOLATION reason=insufficient_notice\nApproval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT. Emergency exemption and uncontrolled airspace exemption already applied. Boundary_mode 'inclusive' means time_diff_hours >= required is OK.\nHard rules: if any auto_check status is VIOLATION, decision MUST be REJECT. Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.\nAuto checks:\n- Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.\nNo geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.\nMission: {\"target_xyz\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"targets\": [{\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}], \"current_time\": \"2024-10-20T10:00:00Z\", \"application_time\": \"2024-10-21T09:00:00Z\", \"planned_flight_time\": \"2024-10-21T15:00:00Z\", \"flight_type\": \"normal\", \"in_controlled_zone\": true, \"timeline_eval\": [{\"target\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"in_controlled_zone\": true, \"altitude\": 50.0, \"requires_approval\": true, \"time_diff_hours\": 6.0, \"advance_hours_required\": 36, \"boundary_mode\": \"inclusive\", \"flight_type\": \"normal\", \"status\": \"VIOLATION\", \"reason\": \"insufficient_notice\", \"phase\": null}], \"timeline_recommendation\": \"REJECT\", \"altitude_eval\": {\"mission_altitude\": 50.0, \"limit\": 50.0, \"status\": \"OK\"}}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"REJECT\",\n  \"reasons\": [\n    \"The mission violates the approval timeline requirement: 6 hours notice was provided for a flight requiring 36 hours advance notice in a controlled zone.\",\n    \"The 'Approval timeline rule' dictates that if any timeline_eval status is 'VIOLATION' (approval required but notice < threshold), the decision MUST be REJECT.\"\n  ],\n  \"citations\": [\n    \"Approval timeline checks (pre-computed)\",\n    \"Approval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT.\",\n    \"Mission: timeline_eval[0].status == 'VIOLATION' and timeline_eval[0].reason == 'insufficient_notice'\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "REJECT",
        "reasons": [
          "The mission violates the approval timeline requirement: 6 hours notice was provided for a flight requiring 36 hours advance notice in a controlled zone.",
          "The 'Approval timeline rule' dictates that if any timeline_eval status is 'VIOLATION' (approval required but notice < threshold), the decision MUST be REJECT."
        ],
        "citations": [
          "Approval timeline checks (pre-computed)",
          "Approval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT.",
          "Mission: timeline_eval[0].status == 'VIOLATION' and timeline_eval[0].reason == 'insufficient_notice'"
        ]
      },
      "retrieved_constraints": [
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_altitude"
        }
      ]
    },
    {
      "test_case_id": "TC2_ApprovalOnTime",
      "description": "按时提前申请：提前52小时申请，满足要求；边界测试：恰好36小时",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "target_xyz": {
          "x": 1000.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "targets": [
          {
            "x": 1000.0,
            "y": 0.0,
            "z": 50.0
          }
        ],
        "flight_type": "normal",
        "in_controlled_zone": true,
        "test_phases": [
          {
            "phase": "sufficient_advance",
            "current_time": "2024-10-20T10:00:00Z",
            "application_time": "2024-10-20T10:00:00Z",
            "planned_flight_time": "2024-10-22T14:00:00Z",
            "time_diff_hours": 52,
            "should_approve": true
          },
          {
            "phase": "boundary_36hours",
            "current_time": "2024-10-20T10:00:00Z",
            "application_time": "2024-10-20T10:00:00Z",
            "planned_flight_time": "2024-10-21T22:00:00Z",
            "time_diff_hours": 36,
            "should_approve": true
          }
        ],
        "timeline_eval": [
          {
            "target": {
              "x": 1000.0,
              "y": 0.0,
              "z": 50.0
            },
            "in_controlled_zone": true,
            "altitude": 50.0,
            "requires_approval": true,
            "time_diff_hours": 52.0,
            "advance_hours_required": 36,
            "boundary_mode": "inclusive",
            "flight_type": "normal",
            "status": "OK",
            "reason": "approval_required",
            "phase": "sufficient_advance"
          },
          {
            "target": {
              "x": 1000.0,
              "y": 0.0,
              "z": 50.0
            },
            "in_controlled_zone": true,
            "altitude": 50.0,
            "requires_approval": true,
            "time_diff_hours": 36.0,
            "advance_hours_required": 36,
            "boundary_mode": "inclusive",
            "flight_type": "normal",
            "status": "OK",
            "reason": "approval_required",
            "phase": "boundary_36hours"
          }
        ],
        "timeline_recommendation": "APPROVE",
        "altitude_eval": {
          "mission_altitude": 50.0,
          "limit": 50.0,
          "status": "OK"
        }
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\nApproval timeline checks (pre-computed):\n  - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=52.0 advance_required=36 flight_type=normal => status=OK reason=approval_required\n  - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=36.0 advance_required=36 flight_type=normal => status=OK reason=approval_required\nApproval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT. Emergency exemption and uncontrolled airspace exemption already applied. Boundary_mode 'inclusive' means time_diff_hours >= required is OK.\nHard rules: if any auto_check status is VIOLATION, decision MUST be REJECT. Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.\nAuto checks:\n- Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.\nNo geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.\nMission: {\"target_xyz\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"targets\": [{\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}], \"flight_type\": \"normal\", \"in_controlled_zone\": true, \"test_phases\": [{\"phase\": \"sufficient_advance\", \"current_time\": \"2024-10-20T10:00:00Z\", \"application_time\": \"2024-10-20T10:00:00Z\", \"planned_flight_time\": \"2024-10-22T14:00:00Z\", \"time_diff_hours\": 52, \"should_approve\": true}, {\"phase\": \"boundary_36hours\", \"current_time\": \"2024-10-20T10:00:00Z\", \"application_time\": \"2024-10-20T10:00:00Z\", \"planned_flight_time\": \"2024-10-21T22:00:00Z\", \"time_diff_hours\": 36, \"should_approve\": true}], \"timeline_eval\": [{\"target\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"in_controlled_zone\": true, \"altitude\": 50.0, \"requires_approval\": true, \"time_diff_hours\": 52.0, \"advance_hours_required\": 36, \"boundary_mode\": \"inclusive\", \"flight_type\": \"normal\", \"status\": \"OK\", \"reason\": \"approval_required\", \"phase\": \"sufficient_advance\"}, {\"target\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"in_controlled_zone\": true, \"altitude\": 50.0, \"requires_approval\": true, \"time_diff_hours\": 36.0, \"advance_hours_required\": 36, \"boundary_mode\": \"inclusive\", \"flight_type\": \"normal\", \"status\": \"OK\", \"reason\": \"approval_required\", \"phase\": \"boundary_36hours\"}], \"timeline_recommendation\": \"APPROVE\", \"altitude_eval\": {\"mission_altitude\": 50.0, \"limit\": 50.0, \"status\": \"OK\"}}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"All approval timeline checks are satisfied. Both flight scenarios (52 hours and 36 hours advance notice) meet the 36-hour advance requirement for flights in a controlled zone with approval needed, as indicated by 'status=OK' for both entries in 'timeline_eval' (boundary_mode 'inclusive').\",\n    \"The altitude check is satisfied. The mission altitude of 50.0m is within the specified limit of 50.0m, resulting in an 'OK' status.\",\n    \"No geofence constraints were provided, therefore no geofence violations exist, and this cannot be a reason for rejection.\"\n  ],\n  \"citations\": [\n    \"Approval timeline checks (pre-computed): - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=52.0 advance_required=36 flight_type=normal => status=OK reason=approval_required\",\n    \"Approval timeline checks (pre-computed): - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=36.0 advance_required=36 flight_type=normal => status=OK reason=approval_required\",\n    \"Approval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT. Emergency exemption and uncontrolled airspace exemption already applied. Boundary_mode 'inclusive' means time_diff_hours >= required is OK.\",\n    \"Auto checks: - Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.\",\n    \"Retrieved constraints: - Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\",\n    \"Hard rules: if any auto_check status is VIOLATION, decision MUST be REJECT. Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.\",\n    \"No geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "All approval timeline checks are satisfied. Both flight scenarios (52 hours and 36 hours advance notice) meet the 36-hour advance requirement for flights in a controlled zone with approval needed, as indicated by 'status=OK' for both entries in 'timeline_eval' (boundary_mode 'inclusive').",
          "The altitude check is satisfied. The mission altitude of 50.0m is within the specified limit of 50.0m, resulting in an 'OK' status.",
          "No geofence constraints were provided, therefore no geofence violations exist, and this cannot be a reason for rejection."
        ],
        "citations": [
          "Approval timeline checks (pre-computed): - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=52.0 advance_required=36 flight_type=normal => status=OK reason=approval_required",
          "Approval timeline checks (pre-computed): - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=36.0 advance_required=36 flight_type=normal => status=OK reason=approval_required",
          "Approval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT. Emergency exemption and uncontrolled airspace exemption already applied. Boundary_mode 'inclusive' means time_diff_hours >= required is OK.",
          "Auto checks: - Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.",
          "Retrieved constraints: - Altitude: 50.0m (SOP S020_approval_timeline.jsonc)",
          "Hard rules: if any auto_check status is VIOLATION, decision MUST be REJECT. Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.",
          "No geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject."
        ]
      },
      "retrieved_constraints": [
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_altitude"
        }
      ]
    },
    {
      "test_case_id": "TC3_EmergencyExemption",
      "description": "紧急任务豁免：30分钟后起飞的紧急救援任务",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "target_xyz": {
          "x": 1000.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "targets": [
          {
            "x": 1000.0,
            "y": 0.0,
            "z": 50.0
          }
        ],
        "current_time": "2024-10-20T10:00:00Z",
        "application_time": "2024-10-20T10:00:00Z",
        "planned_flight_time": "2024-10-20T10:30:00Z",
        "flight_type": "emergency",
        "in_controlled_zone": true,
        "timeline_eval": [
          {
            "target": {
              "x": 1000.0,
              "y": 0.0,
              "z": 50.0
            },
            "in_controlled_zone": true,
            "altitude": 50.0,
            "requires_approval": true,
            "time_diff_hours": 0.5,
            "advance_hours_required": 36,
            "boundary_mode": "inclusive",
            "flight_type": "emergency",
            "status": "OK",
            "reason": "emergency_exemption",
            "phase": null
          }
        ],
        "timeline_recommendation": "APPROVE",
        "altitude_eval": {
          "mission_altitude": 50.0,
          "limit": 50.0,
          "status": "OK"
        }
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\nApproval timeline checks (pre-computed):\n  - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=0.5 advance_required=36 flight_type=emergency => status=OK reason=emergency_exemption\nApproval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT. Emergency exemption and uncontrolled airspace exemption already applied. Boundary_mode 'inclusive' means time_diff_hours >= required is OK.\nHard rules: if any auto_check status is VIOLATION, decision MUST be REJECT. Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.\nAuto checks:\n- Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.\nNo geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.\nMission: {\"target_xyz\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"targets\": [{\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}], \"current_time\": \"2024-10-20T10:00:00Z\", \"application_time\": \"2024-10-20T10:00:00Z\", \"planned_flight_time\": \"2024-10-20T10:30:00Z\", \"flight_type\": \"emergency\", \"in_controlled_zone\": true, \"timeline_eval\": [{\"target\": {\"x\": 1000.0, \"y\": 0.0, \"z\": 50.0}, \"in_controlled_zone\": true, \"altitude\": 50.0, \"requires_approval\": true, \"time_diff_hours\": 0.5, \"advance_hours_required\": 36, \"boundary_mode\": \"inclusive\", \"flight_type\": \"emergency\", \"status\": \"OK\", \"reason\": \"emergency_exemption\", \"phase\": null}], \"timeline_recommendation\": \"APPROVE\", \"altitude_eval\": {\"mission_altitude\": 50.0, \"limit\": 50.0, \"status\": \"OK\"}}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"All auto checks passed, specifically the altitude check (mission altitude 50.0m vs. limit 50.0m).\",\n    \"The approval timeline check resulted in an 'OK' status due to an emergency exemption, despite being in a controlled zone with less than the required advance notice.\",\n    \"No geofence constraints were provided, therefore no geofence violation occurred, and geofence cannot be a basis for rejection.\"\n  ],\n  \"citations\": [\n    \"Retrieved constraints: - Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\",\n    \"Auto checks: - Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.\",\n    \"Approval timeline checks (pre-computed): - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=0.5 advance_required=36 flight_type=emergency => status=OK reason=emergency_exemption\",\n    \"Approval timeline rule: Emergency exemption and uncontrolled airspace exemption already applied.\",\n    \"Hard rules: Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.\",\n    \"No geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "All auto checks passed, specifically the altitude check (mission altitude 50.0m vs. limit 50.0m).",
          "The approval timeline check resulted in an 'OK' status due to an emergency exemption, despite being in a controlled zone with less than the required advance notice.",
          "No geofence constraints were provided, therefore no geofence violation occurred, and geofence cannot be a basis for rejection."
        ],
        "citations": [
          "Retrieved constraints: - Altitude: 50.0m (SOP S020_approval_timeline.jsonc)",
          "Auto checks: - Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.",
          "Approval timeline checks (pre-computed): - target={'x': 1000.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=True altitude=50.0m requires_approval=True time_diff_hours=0.5 advance_required=36 flight_type=emergency => status=OK reason=emergency_exemption",
          "Approval timeline rule: Emergency exemption and uncontrolled airspace exemption already applied.",
          "Hard rules: Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.",
          "No geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject."
        ]
      },
      "retrieved_constraints": [
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_altitude"
        }
      ]
    },
    {
      "test_case_id": "TC4_UncontrolledAirspaceExempt",
      "description": "适飞空域免申请：低空（<120m）非管制区域，无需提前申请",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "target_xyz": {
          "x": 300.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "targets": [
          {
            "x": 300.0,
            "y": 0.0,
            "z": 50.0
          }
        ],
        "current_time": "2024-10-20T10:00:00Z",
        "application_time": null,
        "planned_flight_time": "2024-10-20T10:30:00Z",
        "flight_type": "normal",
        "in_controlled_zone": false,
        "timeline_eval": [
          {
            "target": {
              "x": 300.0,
              "y": 0.0,
              "z": 50.0
            },
            "in_controlled_zone": false,
            "altitude": 50.0,
            "requires_approval": false,
            "time_diff_hours": null,
            "advance_hours_required": 36,
            "boundary_mode": "inclusive",
            "flight_type": "normal",
            "status": "OK",
            "reason": "exempt_uncontrolled",
            "phase": null
          }
        ],
        "timeline_recommendation": "APPROVE",
        "altitude_eval": {
          "mission_altitude": 50.0,
          "limit": 50.0,
          "status": "OK"
        }
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\n- Altitude: 50.0m (SOP S020_approval_timeline.jsonc)\nApproval timeline checks (pre-computed):\n  - target={'x': 300.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=False altitude=50.0m requires_approval=False time_diff_hours=None advance_required=36 flight_type=normal => status=OK reason=exempt_uncontrolled\nApproval timeline rule: if any timeline_eval status == VIOLATION (approval required but notice < threshold or missing application time), decision MUST be REJECT. Emergency exemption and uncontrolled airspace exemption already applied. Boundary_mode 'inclusive' means time_diff_hours >= required is OK.\nHard rules: if any auto_check status is VIOLATION, decision MUST be REJECT. Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.\nAuto checks:\n- Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.\nNo geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.\nMission: {\"target_xyz\": {\"x\": 300.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"targets\": [{\"x\": 300.0, \"y\": 0.0, \"z\": 50.0}], \"current_time\": \"2024-10-20T10:00:00Z\", \"application_time\": null, \"planned_flight_time\": \"2024-10-20T10:30:00Z\", \"flight_type\": \"normal\", \"in_controlled_zone\": false, \"timeline_eval\": [{\"target\": {\"x\": 300.0, \"y\": 0.0, \"z\": 50.0}, \"in_controlled_zone\": false, \"altitude\": 50.0, \"requires_approval\": false, \"time_diff_hours\": null, \"advance_hours_required\": 36, \"boundary_mode\": \"inclusive\", \"flight_type\": \"normal\", \"status\": \"OK\", \"reason\": \"exempt_uncontrolled\", \"phase\": null}], \"timeline_recommendation\": \"APPROVE\", \"altitude_eval\": {\"mission_altitude\": 50.0, \"limit\": 50.0, \"status\": \"OK\"}}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"All auto-checks passed, specifically the altitude check.\",\n    \"The mission is exempt from the approval timeline requirement as it is in uncontrolled airspace.\",\n    \"No geofence constraints were provided, therefore no geofence violations occurred.\"\n  ],\n  \"citations\": [\n    \"Approval timeline checks (pre-computed): target={'x': 300.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=False altitude=50.0m requires_approval=False time_diff_hours=None advance_required=36 flight_type=normal => status=OK reason=exempt_uncontrolled\",\n    \"Auto checks: Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.\",\n    \"No geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.\",\n    \"Hard rules: Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "All auto-checks passed, specifically the altitude check.",
          "The mission is exempt from the approval timeline requirement as it is in uncontrolled airspace.",
          "No geofence constraints were provided, therefore no geofence violations occurred."
        ],
        "citations": [
          "Approval timeline checks (pre-computed): target={'x': 300.0, 'y': 0.0, 'z': 50.0} in_controlled_zone=False altitude=50.0m requires_approval=False time_diff_hours=None advance_required=36 flight_type=normal => status=OK reason=exempt_uncontrolled",
          "Auto checks: Altitude check: mission_altitude=50.0 m vs limit=50.0 m -> OK.",
          "No geofence constraints provided; there is NO geofence violation and geofence must NOT be used to reject.",
          "Hard rules: Only if all auto_check statuses are OK and geofence checks are outside may you APPROVE."
        ]
      },
      "retrieved_constraints": [
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_target_altitude"
        },
        {
          "concept": "Altitude",
          "source_type": "SOP",
          "source_ref": "S020_approval_timeline.jsonc",
          "raw_value": "50.0",
          "raw_unit": "m",
          "canonical_value": "50.0",
          "canonical_unit": "m",
          "file": "/Users/zhangyunshi/Desktop/实习/airsim/LAE-GPT/scenarios/basic/S020_approval_timeline.jsonc",
          "constraint_id": "S020_approval_timeline_test_cases_altitude"
        }
      ]
    }
  ]
}