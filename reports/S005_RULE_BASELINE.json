{
  "scenario": "S005",
  "summary": {
    "total_test_cases": 5,
    "llm_calls": 5,
    "llm_accuracy": "5/5",
    "llm_accuracy_percent": "100.0%"
  },
  "results": [
    {
      "test_case_id": "TC1",
      "description": "Flight before TFR activation - should be approved",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "simulated_time": "2024-01-15T13:00:00Z",
        "target_xyz": {
          "x": 0.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "tfr_major_event",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 0.0,
            "end_y": 0.0,
            "min_distance": 49.97,
            "threshold": 2500.0,
            "status": "inactive",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 0.0,
            "end_y": 0.0,
            "min_distance": 2000.62,
            "threshold": 1500.0,
            "status": "inactive",
            "action": "reject"
          }
        ],
        "geofence_eval": [
          {
            "id": "tfr_major_event",
            "cx": 0.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 2000.0,
            "margin": 500.0,
            "distance": 50.0,
            "threshold": 2500.0,
            "status": "inactive",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "cx": 5000.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 1000.0,
            "margin": 500.0,
            "distance": 5000.25,
            "threshold": 1500.0,
            "status": "inactive",
            "action": "reject"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - tfr_major_event: center=(0.0,0.0,0.0), radius=2000.0m, margin=500.0m, distance=50.0m (3D), threshold=2500.0m, action=reject => status=inactive\n  - tfr_emergency: center=(5000.0,0.0,0.0), radius=1000.0m, margin=500.0m, distance=5000.25m (3D), threshold=1500.0m, action=reject => status=inactive\nPath crossing checks (pre-computed, use these values directly):\n  - tfr_major_event: start=(3000.0,0.0), end=(0.0,0.0), min_distance=49.97m, threshold=2500.0m, action=reject => status=inactive\n  - tfr_emergency: start=(3000.0,0.0), end=(0.0,0.0), min_distance=2000.62m, threshold=1500.0m, action=reject => status=inactive\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist.\nMission: {\"simulated_time\": \"2024-01-15T13:00:00Z\", \"target_xyz\": {\"x\": 0.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"tfr_major_event\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 0.0, \"end_y\": 0.0, \"min_distance\": 49.97, \"threshold\": 2500.0, \"status\": \"inactive\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 0.0, \"end_y\": 0.0, \"min_distance\": 2000.62, \"threshold\": 1500.0, \"status\": \"inactive\", \"action\": \"reject\"}], \"geofence_eval\": [{\"id\": \"tfr_major_event\", \"cx\": 0.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 2000.0, \"margin\": 500.0, \"distance\": 50.0, \"threshold\": 2500.0, \"status\": \"inactive\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"cx\": 5000.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 1000.0, \"margin\": 500.0, \"distance\": 5000.25, \"threshold\": 1500.0, \"status\": \"inactive\", \"action\": \"reject\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"No active geofence constraints (tfr_major_event, tfr_emergency) were violated, as their status was 'inactive'.\",\n    \"No active path crossing constraints (tfr_major_event, tfr_emergency) were violated, as their status was 'inactive'.\",\n    \"The geofence recommendation for the mission is 'APPROVE', which does not trigger a rejection or warning.\"\n  ],\n  \"citations\": [\n    \"Geofence checks: tfr_major_event (status=inactive), tfr_emergency (status=inactive) - no 'inside' status found to trigger reject/warn rule.\",\n    \"Path crossing checks: tfr_major_event (status=inactive), tfr_emergency (status=inactive) - no 'inside' status found to trigger reject/warn rule.\",\n    \"Geofence decision rule: All geofences are not 'inside', so no REJECT or APPROVE_WITH_WARNING condition is met. The default is APPROVE unless other constraints are violated.\",\n    \"Path crossing rule: No path crossing 'inside' statuses with 'reject' or 'warn' actions were found.\",\n    \"Geofence recommendation: APPROVE (does not trigger a REJECT or APPROVE_WITH_WARNING overriding decision).\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "No active geofence constraints (tfr_major_event, tfr_emergency) were violated, as their status was 'inactive'.",
          "No active path crossing constraints (tfr_major_event, tfr_emergency) were violated, as their status was 'inactive'.",
          "The geofence recommendation for the mission is 'APPROVE', which does not trigger a rejection or warning."
        ],
        "citations": [
          "Geofence checks: tfr_major_event (status=inactive), tfr_emergency (status=inactive) - no 'inside' status found to trigger reject/warn rule.",
          "Path crossing checks: tfr_major_event (status=inactive), tfr_emergency (status=inactive) - no 'inside' status found to trigger reject/warn rule.",
          "Geofence decision rule: All geofences are not 'inside', so no REJECT or APPROVE_WITH_WARNING condition is met. The default is APPROVE unless other constraints are violated.",
          "Path crossing rule: No path crossing 'inside' statuses with 'reject' or 'warn' actions were found.",
          "Geofence recommendation: APPROVE (does not trigger a REJECT or APPROVE_WITH_WARNING overriding decision)."
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC2",
      "description": "Flight during TFR active period - should be rejected",
      "expected_decision": "REJECT",
      "llm_decision": "REJECT",
      "mission": {
        "simulated_time": "2024-01-15T15:00:00Z",
        "target_xyz": {
          "x": 0.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "tfr_major_event",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 0.0,
            "end_y": 0.0,
            "min_distance": 49.97,
            "threshold": 2500.0,
            "status": "inside",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 0.0,
            "end_y": 0.0,
            "min_distance": 2000.62,
            "threshold": 1500.0,
            "status": "inactive",
            "action": "reject"
          }
        ],
        "path_recommendation": "REJECT",
        "geofence_eval": [
          {
            "id": "tfr_major_event",
            "cx": 0.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 2000.0,
            "margin": 500.0,
            "distance": 50.0,
            "threshold": 2500.0,
            "status": "inside",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "cx": 5000.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 1000.0,
            "margin": 500.0,
            "distance": 5000.25,
            "threshold": 1500.0,
            "status": "inactive",
            "action": "reject"
          }
        ],
        "geofence_recommendation": "REJECT"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - tfr_major_event: center=(0.0,0.0,0.0), radius=2000.0m, margin=500.0m, distance=50.0m (3D), threshold=2500.0m, action=reject => status=inside\n  - tfr_emergency: center=(5000.0,0.0,0.0), radius=1000.0m, margin=500.0m, distance=5000.25m (3D), threshold=1500.0m, action=reject => status=inactive\nPath crossing checks (pre-computed, use these values directly):\n  - tfr_major_event: start=(3000.0,0.0), end=(0.0,0.0), min_distance=49.97m, threshold=2500.0m, action=reject => status=inside\n  - tfr_emergency: start=(3000.0,0.0), end=(0.0,0.0), min_distance=2000.62m, threshold=1500.0m, action=reject => status=inactive\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: REJECT. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist.\nPath recommendation: REJECT. If path_recommendation is REJECT -> final decision MUST be REJECT. If path_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless a geofence inside or auto_check violation exists.\nMission: {\"simulated_time\": \"2024-01-15T15:00:00Z\", \"target_xyz\": {\"x\": 0.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"tfr_major_event\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 0.0, \"end_y\": 0.0, \"min_distance\": 49.97, \"threshold\": 2500.0, \"status\": \"inside\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 0.0, \"end_y\": 0.0, \"min_distance\": 2000.62, \"threshold\": 1500.0, \"status\": \"inactive\", \"action\": \"reject\"}], \"path_recommendation\": \"REJECT\", \"geofence_eval\": [{\"id\": \"tfr_major_event\", \"cx\": 0.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 2000.0, \"margin\": 500.0, \"distance\": 50.0, \"threshold\": 2500.0, \"status\": \"inside\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"cx\": 5000.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 1000.0, \"margin\": 500.0, \"distance\": 5000.25, \"threshold\": 1500.0, \"status\": \"inactive\", \"action\": \"reject\"}], \"geofence_recommendation\": \"REJECT\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"REJECT\",\n  \"reasons\": [\n    \"The mission path is inside a 'tfr_major_event' geofence which has an 'action' of 'reject'.\",\n    \"The geofence recommendation for the mission is 'REJECT'.\",\n    \"The mission path crosses a 'tfr_major_event' path constraint which has an 'action' of 'reject'.\",\n    \"The path recommendation for the mission is 'REJECT'.\"\n  ],\n  \"citations\": [\n    \"Geofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. (tfr_major_event: status=inside, action=reject)\",\n    \"Geofence recommendation: REJECT. If geofence_recommendation is REJECT -> final decision MUST be REJECT.\",\n    \"Path crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. (tfr_major_event: status=inside, action=reject)\",\n    \"Path recommendation: REJECT. If path_recommendation is REJECT -> final decision MUST be REJECT.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "REJECT",
        "reasons": [
          "The mission path is inside a 'tfr_major_event' geofence which has an 'action' of 'reject'.",
          "The geofence recommendation for the mission is 'REJECT'.",
          "The mission path crosses a 'tfr_major_event' path constraint which has an 'action' of 'reject'.",
          "The path recommendation for the mission is 'REJECT'."
        ],
        "citations": [
          "Geofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. (tfr_major_event: status=inside, action=reject)",
          "Geofence recommendation: REJECT. If geofence_recommendation is REJECT -> final decision MUST be REJECT.",
          "Path crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. (tfr_major_event: status=inside, action=reject)",
          "Path recommendation: REJECT. If path_recommendation is REJECT -> final decision MUST be REJECT."
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC3",
      "description": "Flight after TFR expiration - should be approved",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "simulated_time": "2024-01-15T19:00:00Z",
        "target_xyz": {
          "x": 0.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "tfr_major_event",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 0.0,
            "end_y": 0.0,
            "min_distance": 49.97,
            "threshold": 2500.0,
            "status": "inactive",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 0.0,
            "end_y": 0.0,
            "min_distance": 2000.62,
            "threshold": 1500.0,
            "status": "outside",
            "action": "reject"
          }
        ],
        "geofence_eval": [
          {
            "id": "tfr_major_event",
            "cx": 0.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 2000.0,
            "margin": 500.0,
            "distance": 50.0,
            "threshold": 2500.0,
            "status": "inactive",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "cx": 5000.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 1000.0,
            "margin": 500.0,
            "distance": 5000.25,
            "threshold": 1500.0,
            "status": "outside",
            "action": "reject"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - tfr_major_event: center=(0.0,0.0,0.0), radius=2000.0m, margin=500.0m, distance=50.0m (3D), threshold=2500.0m, action=reject => status=inactive\n  - tfr_emergency: center=(5000.0,0.0,0.0), radius=1000.0m, margin=500.0m, distance=5000.25m (3D), threshold=1500.0m, action=reject => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - tfr_major_event: start=(3000.0,0.0), end=(0.0,0.0), min_distance=49.97m, threshold=2500.0m, action=reject => status=inactive\n  - tfr_emergency: start=(3000.0,0.0), end=(0.0,0.0), min_distance=2000.62m, threshold=1500.0m, action=reject => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist.\nMission: {\"simulated_time\": \"2024-01-15T19:00:00Z\", \"target_xyz\": {\"x\": 0.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"tfr_major_event\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 0.0, \"end_y\": 0.0, \"min_distance\": 49.97, \"threshold\": 2500.0, \"status\": \"inactive\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 0.0, \"end_y\": 0.0, \"min_distance\": 2000.62, \"threshold\": 1500.0, \"status\": \"outside\", \"action\": \"reject\"}], \"geofence_eval\": [{\"id\": \"tfr_major_event\", \"cx\": 0.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 2000.0, \"margin\": 500.0, \"distance\": 50.0, \"threshold\": 2500.0, \"status\": \"inactive\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"cx\": 5000.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 1000.0, \"margin\": 500.0, \"distance\": 5000.25, \"threshold\": 1500.0, \"status\": \"outside\", \"action\": \"reject\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"No geofence check resulted in 'inside' status with a 'reject' action.\",\n    \"No path crossing check resulted in 'inside' status with a 'reject' action.\",\n    \"The geofence recommendation is 'APPROVE', aligning with the lack of direct rejections.\"\n  ],\n  \"citations\": [\n    \"Geofence checks: tfr_major_event (status=inactive, action=reject)\",\n    \"Geofence checks: tfr_emergency (status=outside, action=reject)\",\n    \"Geofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT (not violated).\",\n    \"Path crossing checks: tfr_major_event (status=inactive, action=reject)\",\n    \"Path crossing checks: tfr_emergency (status=outside, action=reject)\",\n    \"Path crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT (not violated).\",\n    \"Geofence recommendation: APPROVE\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "No geofence check resulted in 'inside' status with a 'reject' action.",
          "No path crossing check resulted in 'inside' status with a 'reject' action.",
          "The geofence recommendation is 'APPROVE', aligning with the lack of direct rejections."
        ],
        "citations": [
          "Geofence checks: tfr_major_event (status=inactive, action=reject)",
          "Geofence checks: tfr_emergency (status=outside, action=reject)",
          "Geofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT (not violated).",
          "Path crossing checks: tfr_major_event (status=inactive, action=reject)",
          "Path crossing checks: tfr_emergency (status=outside, action=reject)",
          "Path crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT (not violated).",
          "Geofence recommendation: APPROVE"
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC4",
      "description": "Flight toward emergency TFR with short notice",
      "expected_decision": "REJECT",
      "llm_decision": "REJECT",
      "mission": {
        "simulated_time": "2024-01-15T16:00:00Z",
        "target_xyz": {
          "x": 5000.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "tfr_major_event",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 5000.0,
            "end_y": 0.0,
            "min_distance": 3000.42,
            "threshold": 2500.0,
            "status": "outside",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 5000.0,
            "end_y": 0.0,
            "min_distance": 49.94,
            "threshold": 1500.0,
            "status": "inside",
            "action": "reject"
          }
        ],
        "path_recommendation": "REJECT",
        "geofence_eval": [
          {
            "id": "tfr_major_event",
            "cx": 0.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 2000.0,
            "margin": 500.0,
            "distance": 5000.25,
            "threshold": 2500.0,
            "status": "outside",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "cx": 5000.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 1000.0,
            "margin": 500.0,
            "distance": 50.0,
            "threshold": 1500.0,
            "status": "inside",
            "action": "reject"
          }
        ],
        "geofence_recommendation": "REJECT"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - tfr_major_event: center=(0.0,0.0,0.0), radius=2000.0m, margin=500.0m, distance=5000.25m (3D), threshold=2500.0m, action=reject => status=outside\n  - tfr_emergency: center=(5000.0,0.0,0.0), radius=1000.0m, margin=500.0m, distance=50.0m (3D), threshold=1500.0m, action=reject => status=inside\nPath crossing checks (pre-computed, use these values directly):\n  - tfr_major_event: start=(3000.0,0.0), end=(5000.0,0.0), min_distance=3000.42m, threshold=2500.0m, action=reject => status=outside\n  - tfr_emergency: start=(3000.0,0.0), end=(5000.0,0.0), min_distance=49.94m, threshold=1500.0m, action=reject => status=inside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: REJECT. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist.\nPath recommendation: REJECT. If path_recommendation is REJECT -> final decision MUST be REJECT. If path_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless a geofence inside or auto_check violation exists.\nMission: {\"simulated_time\": \"2024-01-15T16:00:00Z\", \"target_xyz\": {\"x\": 5000.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"tfr_major_event\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 5000.0, \"end_y\": 0.0, \"min_distance\": 3000.42, \"threshold\": 2500.0, \"status\": \"outside\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 5000.0, \"end_y\": 0.0, \"min_distance\": 49.94, \"threshold\": 1500.0, \"status\": \"inside\", \"action\": \"reject\"}], \"path_recommendation\": \"REJECT\", \"geofence_eval\": [{\"id\": \"tfr_major_event\", \"cx\": 0.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 2000.0, \"margin\": 500.0, \"distance\": 5000.25, \"threshold\": 2500.0, \"status\": \"outside\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"cx\": 5000.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 1000.0, \"margin\": 500.0, \"distance\": 50.0, \"threshold\": 1500.0, \"status\": \"inside\", \"action\": \"reject\"}], \"geofence_recommendation\": \"REJECT\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"REJECT\",\n  \"reasons\": [\n    \"Mission path intersects with an emergency Temporary Flight Restriction (tfr_emergency) which has a 'reject' action.\",\n    \"Mission is located inside an emergency Temporary Flight Restriction (tfr_emergency) geofence which has a 'reject' action.\",\n    \"The geofence recommendation for this mission is REJECT.\",\n    \"The path recommendation for this mission is REJECT.\"\n  ],\n  \"citations\": [\n    \"Geofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. (tfr_emergency: status=inside, action=reject)\",\n    \"Path crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. (tfr_emergency: status=inside, action=reject)\",\n    \"Geofence recommendation: REJECT. If geofence_recommendation is REJECT -> final decision MUST be REJECT.\",\n    \"Path recommendation: REJECT. If path_recommendation is REJECT -> final decision MUST be REJECT.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "REJECT",
        "reasons": [
          "Mission path intersects with an emergency Temporary Flight Restriction (tfr_emergency) which has a 'reject' action.",
          "Mission is located inside an emergency Temporary Flight Restriction (tfr_emergency) geofence which has a 'reject' action.",
          "The geofence recommendation for this mission is REJECT.",
          "The path recommendation for this mission is REJECT."
        ],
        "citations": [
          "Geofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. (tfr_emergency: status=inside, action=reject)",
          "Path crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. (tfr_emergency: status=inside, action=reject)",
          "Geofence recommendation: REJECT. If geofence_recommendation is REJECT -> final decision MUST be REJECT.",
          "Path recommendation: REJECT. If path_recommendation is REJECT -> final decision MUST be REJECT."
        ]
      },
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC5",
      "description": "Flight when both TFRs active (edge case)",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "mission": {
        "simulated_time": "2024-01-15T16:30:00Z",
        "target_xyz": {
          "x": 2500.0,
          "y": 0.0,
          "z": 50.0
        },
        "altitude_m": 50.0,
        "path_eval": [
          {
            "id": "tfr_major_event",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 2500.0,
            "end_y": 0.0,
            "min_distance": 2500.5,
            "threshold": 2500.0,
            "status": "outside",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "start_x": 3000.0,
            "start_y": 0.0,
            "end_x": 2500.0,
            "end_y": 0.0,
            "min_distance": 2000.62,
            "threshold": 1500.0,
            "status": "outside",
            "action": "reject"
          }
        ],
        "geofence_eval": [
          {
            "id": "tfr_major_event",
            "cx": 0.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 2000.0,
            "margin": 500.0,
            "distance": 2500.5,
            "threshold": 2500.0,
            "status": "outside",
            "action": "reject"
          },
          {
            "id": "tfr_emergency",
            "cx": 5000.0,
            "cy": 0.0,
            "cz": 0.0,
            "radius": 1000.0,
            "margin": 500.0,
            "distance": 2500.5,
            "threshold": 1500.0,
            "status": "outside",
            "action": "reject"
          }
        ],
        "geofence_recommendation": "APPROVE"
      },
      "prompt": "You are a dispatch AI. Decide APPROVE or REJECT with cited constraints.\nRetrieved constraints:\nGeofence checks (pre-computed, use these values directly):\n  - tfr_major_event: center=(0.0,0.0,0.0), radius=2000.0m, margin=500.0m, distance=2500.5m (3D), threshold=2500.0m, action=reject => status=outside\n  - tfr_emergency: center=(5000.0,0.0,0.0), radius=1000.0m, margin=500.0m, distance=2500.5m (3D), threshold=1500.0m, action=reject => status=outside\nPath crossing checks (pre-computed, use these values directly):\n  - tfr_major_event: start=(3000.0,0.0), end=(2500.0,0.0), min_distance=2500.5m, threshold=2500.0m, action=reject => status=outside\n  - tfr_emergency: start=(3000.0,0.0), end=(2500.0,0.0), min_distance=2000.62m, threshold=1500.0m, action=reject => status=outside\nGeofence decision rule: if ANY geofence status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. If ALL geofences are outside, decision is APPROVE unless other constraints are violated. Do NOT answer UNCERTAIN when geofence_eval is present.\nPath crossing rule: if ANY path_eval status == inside and action=reject, decision MUST be REJECT. If status==inside and action=warn (obstacle avoidance), decision MUST be APPROVE_WITH_WARNING. Do NOT answer UNCERTAIN when path_eval is present.\nGeofence recommendation: APPROVE. If geofence_recommendation is REJECT -> final decision MUST be REJECT. If geofence_recommendation is APPROVE_WITH_WARNING -> final decision MUST be APPROVE_WITH_WARNING unless other hard violations exist.\nMission: {\"simulated_time\": \"2024-01-15T16:30:00Z\", \"target_xyz\": {\"x\": 2500.0, \"y\": 0.0, \"z\": 50.0}, \"altitude_m\": 50.0, \"path_eval\": [{\"id\": \"tfr_major_event\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 2500.0, \"end_y\": 0.0, \"min_distance\": 2500.5, \"threshold\": 2500.0, \"status\": \"outside\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"start_x\": 3000.0, \"start_y\": 0.0, \"end_x\": 2500.0, \"end_y\": 0.0, \"min_distance\": 2000.62, \"threshold\": 1500.0, \"status\": \"outside\", \"action\": \"reject\"}], \"geofence_eval\": [{\"id\": \"tfr_major_event\", \"cx\": 0.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 2000.0, \"margin\": 500.0, \"distance\": 2500.5, \"threshold\": 2500.0, \"status\": \"outside\", \"action\": \"reject\"}, {\"id\": \"tfr_emergency\", \"cx\": 5000.0, \"cy\": 0.0, \"cz\": 0.0, \"radius\": 1000.0, \"margin\": 500.0, \"distance\": 2500.5, \"threshold\": 1500.0, \"status\": \"outside\", \"action\": \"reject\"}], \"geofence_recommendation\": \"APPROVE\"}\nDecide and cite which constraints are satisfied/violated. Respond with JSON:\n{ \"decision\": \"APPROVE|REJECT|CONDITIONAL|UNCERTAIN\", \"reasons\": [...], \"citations\": [...] }",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"reasons\": [\n    \"All pre-computed geofence checks indicate 'outside' status, with no 'inside' status for 'reject' or 'warn' actions.\",\n    \"All pre-computed path crossing checks indicate 'outside' status, with no 'inside' status for 'reject' or 'warn' actions.\",\n    \"The geofence decision rule allows for APPROVE when all geofences are outside and no other constraints are violated.\",\n    \"The explicit 'geofence_recommendation' is 'APPROVE', which aligns with the overall assessment.\"\n  ],\n  \"citations\": [\n    \"Geofence checks: tfr_major_event (status=outside, action=reject)\",\n    \"Geofence checks: tfr_emergency (status=outside, action=reject)\",\n    \"Path crossing checks: tfr_major_event (status=outside, action=reject)\",\n    \"Path crossing checks: tfr_emergency (status=outside, action=reject)\",\n    \"Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'\",\n    \"Geofence recommendation: 'APPROVE'\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "reasons": [
          "All pre-computed geofence checks indicate 'outside' status, with no 'inside' status for 'reject' or 'warn' actions.",
          "All pre-computed path crossing checks indicate 'outside' status, with no 'inside' status for 'reject' or 'warn' actions.",
          "The geofence decision rule allows for APPROVE when all geofences are outside and no other constraints are violated.",
          "The explicit 'geofence_recommendation' is 'APPROVE', which aligns with the overall assessment."
        ],
        "citations": [
          "Geofence checks: tfr_major_event (status=outside, action=reject)",
          "Geofence checks: tfr_emergency (status=outside, action=reject)",
          "Path crossing checks: tfr_major_event (status=outside, action=reject)",
          "Path crossing checks: tfr_emergency (status=outside, action=reject)",
          "Geofence decision rule: 'If ALL geofences are outside, decision is APPROVE unless other constraints are violated.'",
          "Geofence recommendation: 'APPROVE'"
        ]
      },
      "retrieved_constraints": []
    }
  ]
}