{
  "scenario": "S030",
  "summary": {
    "total_test_cases": 8,
    "llm_calls": 8,
    "llm_accuracy": "7/8",
    "llm_accuracy_percent": "87.5%"
  },
  "results": [
    {
      "test_case_id": "TC1_BaselineScheduling",
      "description": "Simple prioritization with no dynamic changes.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC1_BaselineScheduling\n- Description: Simple prioritization with no dynamic changes.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- All drones have >60% battery\n- No weather issues\n- No temporary NFZ\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 10}\n  ],\n  \"conditions\": [\n    \"Monitor wind speed for Drone B to ensure it remains below 12 m/s throughout its mission.\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Establish Priority (R1):** Based on Rule R1 (medical > commercial > inspection), the priority order is Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection).\",\n    \"2. **Estimate Flight Times:** Assuming a standard operational speed of 10 m/s (0.6 km/min):\",\n    \"   - Drone A (5 km): 5 km / 0.6 km/min = 8.33 minutes.\",\n    \"   - Drone B (3 km): 3 km / 0.6 km/min = 5 minutes.\",\n    \"   - Drone C (2 km): 2 km / 0.6 km/min = 3.33 minutes.\",\n    \"3. **Schedule Drone A (Highest Priority):**\",\n    \"   - Drone A is a medical emergency and has the highest priority. It is scheduled for `launch_now` (t=0).\",\n    \"   - Estimated arrival time: 0 + 8.33 = 8.33 minutes. This is well within its 30-minute deadline.\",\n    \"   - Current conditions (battery >60%, no weather issues, no NFZ) meet all its requirements and R4 (battery reserve).\",\n    \"4. **Schedule Drone B (Second Priority):**\",\n    \"   - To comply with Rule R2 (single drone per corridor, 500m spacing), Drone B must launch after Drone A has safely cleared the initial corridor segment. A standard safe separation interval of 5 minutes between consecutive launches is applied.\",\n    \"   - Drone B is scheduled to `launch_after` a `delay_min` of 5 minutes (i.e., at t=5 minutes).\",\n    \"   - Estimated arrival time: 5 (launch) + 5 (flight) = 10 minutes. This is well within its 45-minute deadline.\",\n    \"   - Current conditions state 'No weather issues', so Drone B's wind limit (R3: 12 m/s) is currently met. However, continuous monitoring is required as a condition.\",\n    \"   - Battery >60% meets R4.\",\n    \"5. **Schedule Drone C (Lowest Priority):**\",\n    \"   - Following the same logic for Rule R2, Drone C must launch after Drone B has safely cleared the initial corridor segment. Another 5-minute separation interval is applied.\",\n    \"   - Drone C is scheduled for a `delay_min` of 10 minutes (i.e., at t=10 minutes, 5 minutes after Drone B's launch).\",\n    \"   - Estimated arrival time: 10 (launch) + 3.33 (flight) = 13.33 minutes. Drone C has no deadline, so this timing is acceptable.\",\n    \"   - Battery >60% meets R4.\",\n    \"6. **Overall Compliance:** All drones can be launched sequentially, adhering to priority R1, corridor spacing R2, wind limits R3 (with monitoring), battery reserve R4, and all specified deadlines under current conditions. Therefore, a conditional approval is recommended primarily due to the need to monitor wind for Drone B.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "allocations": [
          {
            "drone": "A",
            "action": "launch_now"
          },
          {
            "drone": "B",
            "action": "launch_after",
            "delay_min": 5
          },
          {
            "drone": "C",
            "action": "delay",
            "delay_min": 10
          }
        ],
        "conditions": [
          "Monitor wind speed for Drone B to ensure it remains below 12 m/s throughout its mission."
        ],
        "reasoning_steps": [
          "1. **Establish Priority (R1):** Based on Rule R1 (medical > commercial > inspection), the priority order is Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection).",
          "2. **Estimate Flight Times:** Assuming a standard operational speed of 10 m/s (0.6 km/min):",
          "   - Drone A (5 km): 5 km / 0.6 km/min = 8.33 minutes.",
          "   - Drone B (3 km): 3 km / 0.6 km/min = 5 minutes.",
          "   - Drone C (2 km): 2 km / 0.6 km/min = 3.33 minutes.",
          "3. **Schedule Drone A (Highest Priority):**",
          "   - Drone A is a medical emergency and has the highest priority. It is scheduled for `launch_now` (t=0).",
          "   - Estimated arrival time: 0 + 8.33 = 8.33 minutes. This is well within its 30-minute deadline.",
          "   - Current conditions (battery >60%, no weather issues, no NFZ) meet all its requirements and R4 (battery reserve).",
          "4. **Schedule Drone B (Second Priority):**",
          "   - To comply with Rule R2 (single drone per corridor, 500m spacing), Drone B must launch after Drone A has safely cleared the initial corridor segment. A standard safe separation interval of 5 minutes between consecutive launches is applied.",
          "   - Drone B is scheduled to `launch_after` a `delay_min` of 5 minutes (i.e., at t=5 minutes).",
          "   - Estimated arrival time: 5 (launch) + 5 (flight) = 10 minutes. This is well within its 45-minute deadline.",
          "   - Current conditions state 'No weather issues', so Drone B's wind limit (R3: 12 m/s) is currently met. However, continuous monitoring is required as a condition.",
          "   - Battery >60% meets R4.",
          "5. **Schedule Drone C (Lowest Priority):**",
          "   - Following the same logic for Rule R2, Drone C must launch after Drone B has safely cleared the initial corridor segment. Another 5-minute separation interval is applied.",
          "   - Drone C is scheduled for a `delay_min` of 10 minutes (i.e., at t=10 minutes, 5 minutes after Drone B's launch).",
          "   - Estimated arrival time: 10 (launch) + 3.33 (flight) = 13.33 minutes. Drone C has no deadline, so this timing is acceptable.",
          "   - Battery >60% meets R4.",
          "6. **Overall Compliance:** All drones can be launched sequentially, adhering to priority R1, corridor spacing R2, wind limits R3 (with monitoring), battery reserve R4, and all specified deadlines under current conditions. Therefore, a conditional approval is recommended primarily due to the need to monitor wind for Drone B."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC2_WindForecast",
      "description": "Wind rises to 14 m/s in 15 minutes; B limit is 12 m/s.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC2_WindForecast\n- Description: Wind rises to 14 m/s in 15 minutes; B limit is 12 m/s.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- Current wind 8 m/s\n- Forecast 14 m/s at +15 min\n- B needs 12 min round trip\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"reject\"},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": \"indefinite\"}\n  ],\n  \"conditions\": [\n    \"Monitor actual wind speed during Drone A's flight to ensure safe return, given the rising wind and absence of a specific wind limit for A.\",\n    \"Re-evaluate wind conditions for Drone B and C when the wind forecast indicates speeds consistently below 12 m/s, suitable for Drone B's wind limit.\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Establish Priority (R1)**: According to Global Rule R1, the priority order is medical_emergency (Drone A) > commercial_delivery (Drone B) > infrastructure_inspection (Drone C).\",\n    \"2. **Evaluate Drone A (Medical Emergency)**:\",\n    \"   - **Role**: Medical emergency, highest priority.\",\n    \"   - **Distance/Time**: 5 km distance. Assuming an average speed (e.g., 36 km/h or 10 m/s), a round trip would be approximately 17 minutes (5km * 2 / 36 km/h * 60 min/h). The deadline is 30 minutes, providing ample time for the mission.\",\n    \"   - **Wind**: Current wind is 8 m/s. The forecast indicates wind rising to 14 m/s at +15 minutes. Drone A's profile does not specify a wind limit. Given its critical emergency role and no explicit wind constraint, it is assumed capable of operating under these conditions for its mission duration, or the urgency overrides standard limits. Its estimated return time (T+17) is just after the peak forecasted wind (T+15 at 14m/s), but without a specified limit, an emergency launch is prioritized.\",\n    \"   - **Decision**: Launch immediately.\",\n    \"3. **Evaluate Drone B (Commercial Delivery)**:\",\n    \"   - **Role**: Commercial delivery, medium priority.\",\n    \"   - **Round Trip Time**: 12 minutes (provided in scenario info).\",\n    \"   - **Wind Limit (R3)**: 12 m/s.\",\n    \"   - **Current Conditions**: Current wind is 8 m/s. Forecast is 14 m/s at +15 minutes.\",\n    \"   - **Wind Increase Calculation**: The wind is projected to increase linearly from 8 m/s at T=0 to 14 m/s at T=15. The rate of increase is (14 m/s - 8 m/s) / 15 min = 6 m/s / 15 min = 0.4 m/s per minute.\",\n    \"   - **Safety Analysis**: Let `T_launch` be the launch time for Drone B. Its mission will be completed at `T_completion = T_launch + 12` minutes. The wind speed at any given time `t` is `W(t) = 8 + 0.4 * t` (assuming linear increase from T=0). For Drone B to fly safely, the wind speed at its completion time must be less than or equal to its limit of 12 m/s: `W(T_completion) <= 12`.\",\n    \"   - **Applying the Condition**: `8 + 0.4 * (T_launch + 12) <= 12`.\",\n    \"   - **Solving for T_launch**: `0.4 * (T_launch + 12) <= 4` => `T_launch + 12 <= 10` => `T_launch <= -2` minutes.\",\n    \"   - **Conclusion**: This calculation shows that Drone B needed to have completed its mission 2 minutes *ago* to remain within its 12 m/s wind limit throughout its flight. Therefore, it cannot be safely launched now or at any point in the future under the current wind forecast.\",\n    \"   - **Decision**: Reject.\",\n    \"4. **Evaluate Drone C (Infrastructure Inspection)**:\",\n    \"   - **Role**: Infrastructure inspection, lowest priority.\",\n    \"   - **Distance/Time**: 2 km distance (approx. 7 minutes round trip).\",\n    \"   - **Deadline**: None (highly flexible).\",\n    \"   - **Wind**: No specific wind limit is stated for Drone C. However, given that a higher-priority commercial drone (B) is being rejected due to the wind forecast exceeding its operational limits, and Drone C's mission is non-urgent, it would be unsafe and inconsistent with prioritization and safety best practices to approve its flight under the same adverse conditions.\",\n    \"   - **Decision**: Delay indefinitely until wind conditions improve.\",\n    \"5. **Global Rule R2 (Corridor Spacing)**: This rule is not directly applicable as no corridor information is provided, and the decisions result in Drone B and C not flying immediately, preventing any potential conflicts with Drone A's flight.\",\n    \"6. **Global Rule R4 (15% Battery Reserve)**: No battery data is provided for any drone, so it is assumed that all drones have sufficient battery capacity to meet this reserve requirement for their respective missions if approved.\"\n  ],\n  \"escalation\": [\n    \"For Drone B (Commercial Delivery): Recommend exploring alternative delivery methods, such as ground transport or dispatching a different drone model with a higher wind tolerance, if the delivery is time-sensitive and cannot be delayed until wind conditions subside below 12 m/s.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "allocations": [
          {
            "drone": "A",
            "action": "launch_now"
          },
          {
            "drone": "B",
            "action": "reject"
          },
          {
            "drone": "C",
            "action": "delay",
            "delay_min": "indefinite"
          }
        ],
        "conditions": [
          "Monitor actual wind speed during Drone A's flight to ensure safe return, given the rising wind and absence of a specific wind limit for A.",
          "Re-evaluate wind conditions for Drone B and C when the wind forecast indicates speeds consistently below 12 m/s, suitable for Drone B's wind limit."
        ],
        "reasoning_steps": [
          "1. **Establish Priority (R1)**: According to Global Rule R1, the priority order is medical_emergency (Drone A) > commercial_delivery (Drone B) > infrastructure_inspection (Drone C).",
          "2. **Evaluate Drone A (Medical Emergency)**:",
          "   - **Role**: Medical emergency, highest priority.",
          "   - **Distance/Time**: 5 km distance. Assuming an average speed (e.g., 36 km/h or 10 m/s), a round trip would be approximately 17 minutes (5km * 2 / 36 km/h * 60 min/h). The deadline is 30 minutes, providing ample time for the mission.",
          "   - **Wind**: Current wind is 8 m/s. The forecast indicates wind rising to 14 m/s at +15 minutes. Drone A's profile does not specify a wind limit. Given its critical emergency role and no explicit wind constraint, it is assumed capable of operating under these conditions for its mission duration, or the urgency overrides standard limits. Its estimated return time (T+17) is just after the peak forecasted wind (T+15 at 14m/s), but without a specified limit, an emergency launch is prioritized.",
          "   - **Decision**: Launch immediately.",
          "3. **Evaluate Drone B (Commercial Delivery)**:",
          "   - **Role**: Commercial delivery, medium priority.",
          "   - **Round Trip Time**: 12 minutes (provided in scenario info).",
          "   - **Wind Limit (R3)**: 12 m/s.",
          "   - **Current Conditions**: Current wind is 8 m/s. Forecast is 14 m/s at +15 minutes.",
          "   - **Wind Increase Calculation**: The wind is projected to increase linearly from 8 m/s at T=0 to 14 m/s at T=15. The rate of increase is (14 m/s - 8 m/s) / 15 min = 6 m/s / 15 min = 0.4 m/s per minute.",
          "   - **Safety Analysis**: Let `T_launch` be the launch time for Drone B. Its mission will be completed at `T_completion = T_launch + 12` minutes. The wind speed at any given time `t` is `W(t) = 8 + 0.4 * t` (assuming linear increase from T=0). For Drone B to fly safely, the wind speed at its completion time must be less than or equal to its limit of 12 m/s: `W(T_completion) <= 12`.",
          "   - **Applying the Condition**: `8 + 0.4 * (T_launch + 12) <= 12`.",
          "   - **Solving for T_launch**: `0.4 * (T_launch + 12) <= 4` => `T_launch + 12 <= 10` => `T_launch <= -2` minutes.",
          "   - **Conclusion**: This calculation shows that Drone B needed to have completed its mission 2 minutes *ago* to remain within its 12 m/s wind limit throughout its flight. Therefore, it cannot be safely launched now or at any point in the future under the current wind forecast.",
          "   - **Decision**: Reject.",
          "4. **Evaluate Drone C (Infrastructure Inspection)**:",
          "   - **Role**: Infrastructure inspection, lowest priority.",
          "   - **Distance/Time**: 2 km distance (approx. 7 minutes round trip).",
          "   - **Deadline**: None (highly flexible).",
          "   - **Wind**: No specific wind limit is stated for Drone C. However, given that a higher-priority commercial drone (B) is being rejected due to the wind forecast exceeding its operational limits, and Drone C's mission is non-urgent, it would be unsafe and inconsistent with prioritization and safety best practices to approve its flight under the same adverse conditions.",
          "   - **Decision**: Delay indefinitely until wind conditions improve.",
          "5. **Global Rule R2 (Corridor Spacing)**: This rule is not directly applicable as no corridor information is provided, and the decisions result in Drone B and C not flying immediately, preventing any potential conflicts with Drone A's flight.",
          "6. **Global Rule R4 (15% Battery Reserve)**: No battery data is provided for any drone, so it is assumed that all drones have sufficient battery capacity to meet this reserve requirement for their respective missions if approved."
        ],
        "escalation": [
          "For Drone B (Commercial Delivery): Recommend exploring alternative delivery methods, such as ground transport or dispatching a different drone model with a higher wind tolerance, if the delivery is time-sensitive and cannot be delayed until wind conditions subside below 12 m/s."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC3_TemporaryNFZ",
      "description": "A+B corridor blocked 10 min from now for 15 min.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC3_TemporaryNFZ\n- Description: A+B corridor blocked 10 min from now for 15 min.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- NFZ starts in 10 min\n- A flight time 15 min\n- B flight time 9 min\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_now\"},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 25}\n  ],\n  \"conditions\": [\n    \"A's mission requires a viable reroute path, avoiding the A+B corridor, with a flight time not exceeding 29 minutes to ensure arrival within the 30-minute deadline.\",\n    \"Monitor current wind speed; abort Drone B's mission if wind exceeds 12 m/s during flight.\",\n    \"Monitor NFZ activation and deactivation times precisely.\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Establish Priority (R1):** Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection).\",\n    \"2. **Analyze NFZ:** The A+B corridor will be blocked from 10 minutes from now (t=10 min) for 15 minutes, meaning it is active from t=10 min to t=25 min.\",\n    \"3. **Evaluate Drone A (Medical Emergency):**\",\n    \"   - Flight time: 15 min. Deadline: 30 min.\",\n    \"   - If A launches now (t=0) in the original corridor, it would be in the air from t=0 to t=15 min. This means it would fly through the NFZ from t=10 to t=15 min, which is a violation. As per the rule, 'Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ.'\",\n    \"   - If A waits for the NFZ to clear, it could launch at t=25 min. Arrival would be t=25 + 15 = t=40 min. This is beyond its 30-minute deadline.\",\n    \"   - Therefore, Drone A cannot use its original corridor. Given its high priority ('medical_emergency'), a reroute is the only viable option to meet the deadline and avoid the NFZ. Assuming a reroute adds 3-5 minutes (e.g., to 18-20 minutes flight time), launching now (t=0) via a reroute would result in arrival at t=18-20 min, which is well within the 30-minute deadline and avoids the blocked corridor entirely. This is approved conditionally on the availability and viability of such a reroute.\",\n    \"4. **Evaluate Drone B (Commercial Delivery):**\",\n    \"   - Flight time: 9 min. Deadline: 45 min. Wind limit: 12 m/s (R3).\",\n    \"   - If B launches now (t=0) in the original A+B corridor, it will complete its flight at t=9 min. The NFZ starts at t=10 min. Therefore, Drone B completes its mission *before* the NFZ activates, making it a valid flight in the A+B corridor.\",\n    \"   - Rule R2 (single drone per corridor) is respected because Drone A is rerouting and using a different corridor.\",\n    \"   - Drone B's arrival at t=9 min is well within its 45-minute deadline. This action is approved, subject to monitoring the wind speed (R3).\",\n    \"5. **Evaluate Drone C (Infrastructure Inspection):**\",\n    \"   - Flight time: Estimated 6 min (proportional to B's speed: 2km / 3km * 9min = 6min). No deadline.\",\n    \"   - C cannot launch now (t=0) because B is using the A+B corridor (R2).\",\n    \"   - If C were to launch immediately after B clears (at t=9 min), its flight (t=9 to t=15 min) would occur during the NFZ (t=10 to t=25 min), which is a violation.\",\n    \"   - Therefore, C must wait until the NFZ clears at t=25 min. Launching at t=25 min, C would arrive at t=25 + 6 = t=31 min. Since there is no deadline for C, this delay is acceptable.\",\n    \"6. **Battery Reserve (R4):** 15% battery reserve is a general rule assumed to be met by the flight planning. No specific battery level data is provided to calculate against.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "allocations": [
          {
            "drone": "A",
            "action": "launch_now"
          },
          {
            "drone": "B",
            "action": "launch_now"
          },
          {
            "drone": "C",
            "action": "delay",
            "delay_min": 25
          }
        ],
        "conditions": [
          "A's mission requires a viable reroute path, avoiding the A+B corridor, with a flight time not exceeding 29 minutes to ensure arrival within the 30-minute deadline.",
          "Monitor current wind speed; abort Drone B's mission if wind exceeds 12 m/s during flight.",
          "Monitor NFZ activation and deactivation times precisely."
        ],
        "reasoning_steps": [
          "1. **Establish Priority (R1):** Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection).",
          "2. **Analyze NFZ:** The A+B corridor will be blocked from 10 minutes from now (t=10 min) for 15 minutes, meaning it is active from t=10 min to t=25 min.",
          "3. **Evaluate Drone A (Medical Emergency):**",
          "   - Flight time: 15 min. Deadline: 30 min.",
          "   - If A launches now (t=0) in the original corridor, it would be in the air from t=0 to t=15 min. This means it would fly through the NFZ from t=10 to t=15 min, which is a violation. As per the rule, 'Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ.'",
          "   - If A waits for the NFZ to clear, it could launch at t=25 min. Arrival would be t=25 + 15 = t=40 min. This is beyond its 30-minute deadline.",
          "   - Therefore, Drone A cannot use its original corridor. Given its high priority ('medical_emergency'), a reroute is the only viable option to meet the deadline and avoid the NFZ. Assuming a reroute adds 3-5 minutes (e.g., to 18-20 minutes flight time), launching now (t=0) via a reroute would result in arrival at t=18-20 min, which is well within the 30-minute deadline and avoids the blocked corridor entirely. This is approved conditionally on the availability and viability of such a reroute.",
          "4. **Evaluate Drone B (Commercial Delivery):**",
          "   - Flight time: 9 min. Deadline: 45 min. Wind limit: 12 m/s (R3).",
          "   - If B launches now (t=0) in the original A+B corridor, it will complete its flight at t=9 min. The NFZ starts at t=10 min. Therefore, Drone B completes its mission *before* the NFZ activates, making it a valid flight in the A+B corridor.",
          "   - Rule R2 (single drone per corridor) is respected because Drone A is rerouting and using a different corridor.",
          "   - Drone B's arrival at t=9 min is well within its 45-minute deadline. This action is approved, subject to monitoring the wind speed (R3).",
          "5. **Evaluate Drone C (Infrastructure Inspection):**",
          "   - Flight time: Estimated 6 min (proportional to B's speed: 2km / 3km * 9min = 6min). No deadline.",
          "   - C cannot launch now (t=0) because B is using the A+B corridor (R2).",
          "   - If C were to launch immediately after B clears (at t=9 min), its flight (t=9 to t=15 min) would occur during the NFZ (t=10 to t=25 min), which is a violation.",
          "   - Therefore, C must wait until the NFZ clears at t=25 min. Launching at t=25 min, C would arrive at t=25 + 6 = t=31 min. Since there is no deadline for C, this delay is acceptable.",
          "6. **Battery Reserve (R4):** 15% battery reserve is a general rule assumed to be met by the flight planning. No specific battery level data is provided to calculate against."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC4_ChargingStation",
      "description": "A must charge but station free in 20 min.",
      "expected_decision": "REJECT",
      "llm_decision": "REJECT_WITH_ALTERNATIVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC4_ChargingStation\n- Description: A must charge but station free in 20 min.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- A battery 40% (needs 55%)\n- Charge takes 15 min plus 20 min wait\n- Mission deadline 30 min\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"REJECT_WITH_ALTERNATIVE\",\n  \"allocations\": [\n    {\n      \"drone\": \"A\",\n      \"action\": \"reject\",\n      \"reason\": \"Mission deadline cannot be met due to required charging time.\"\n    },\n    {\n      \"drone\": \"B\",\n      \"action\": \"launch_now\"\n    },\n    {\n      \"drone\": \"C\",\n      \"action\": \"launch_now\"\n    }\n  ],\n  \"conditions\": [\n    \"Monitor wind speed for Drone B. Abort mission if wind exceeds 12 m/s (R3) at any point during its flight.\"\n  ],\n  \"reasoning_steps\": [\n    \"Step 1: Prioritize drones based on Global Rule R1: medical_emergency (A) > commercial_delivery (B) > infrastructure_inspection (C).\",\n    \"Step 2: Evaluate Drone A (medical_emergency). Drone A has 40% battery and needs 55% to launch while maintaining the 15% battery reserve (R4 is implicitly met by the 'needs 55%' requirement). This means Drone A requires charging.\",\n    \"Step 3: Calculate Drone A's charging timeline. The charging station requires a 20-minute wait before it becomes free. After the wait, charging itself takes 15 minutes. Therefore, Drone A's total pre-launch time (wait + charge) is 20 min + 15 min = 35 minutes.\",\n    \"Step 4: Compare Drone A's pre-launch time to its deadline. Drone A has a mission deadline of 30 minutes. Since the earliest it can launch is 35 minutes from now, it cannot even begin its mission before its deadline has passed (35 min > 30 min).\",\n    \"Step 5: Decision for Drone A: REJECT. The mission is infeasible due to the charging delay exceeding the mission deadline. As per the retrieved evidence, 'If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.' For a medical emergency, recommend dispatching a backup UAV or seeking an alternative immediate charging/launch solution.\",\n    \"Step 6: Evaluate Drone B (commercial_delivery). Drone B is next in priority. No battery issues are stated for Drone B, so it is assumed to have sufficient charge and does not require the charging station.\",\n    \"Step 7: Check Drone B's constraints. Drone B has a wind limit of 12 m/s (R3). Current wind conditions are not provided. Its deadline is 45 minutes. Assuming flight time is less than the deadline, the primary unaddressed constraint is wind.\",\n    \"Step 8: Decision for Drone B: CONDITIONAL_APPROVE. It can launch now, provided that wind conditions are continuously monitored and remain below 12 m/s throughout the mission. If wind data were available and exceeded this limit, it would be rejected.\",\n    \"Step 9: Evaluate Drone C (infrastructure_inspection). Drone C is the lowest priority. No battery issues are stated, so it is assumed to have sufficient charge and does not require the charging station. It has no specified deadline or wind limits.\",\n    \"Step 10: Check for corridor conflicts (R2). R2 states 'single drone per corridor (500m spacing)'. Since Drone A is rejected and B and C are not explicitly stated to be using the same corridor or launch point, they can launch simultaneously using separate corridors or with sufficient spacing. The charging station bottleneck is not relevant to B and C.\",\n    \"Step 11: Decision for Drone C: APPROVE. It can launch now.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "REJECT_WITH_ALTERNATIVE",
        "allocations": [
          {
            "drone": "A",
            "action": "reject",
            "reason": "Mission deadline cannot be met due to required charging time."
          },
          {
            "drone": "B",
            "action": "launch_now"
          },
          {
            "drone": "C",
            "action": "launch_now"
          }
        ],
        "conditions": [
          "Monitor wind speed for Drone B. Abort mission if wind exceeds 12 m/s (R3) at any point during its flight."
        ],
        "reasoning_steps": [
          "Step 1: Prioritize drones based on Global Rule R1: medical_emergency (A) > commercial_delivery (B) > infrastructure_inspection (C).",
          "Step 2: Evaluate Drone A (medical_emergency). Drone A has 40% battery and needs 55% to launch while maintaining the 15% battery reserve (R4 is implicitly met by the 'needs 55%' requirement). This means Drone A requires charging.",
          "Step 3: Calculate Drone A's charging timeline. The charging station requires a 20-minute wait before it becomes free. After the wait, charging itself takes 15 minutes. Therefore, Drone A's total pre-launch time (wait + charge) is 20 min + 15 min = 35 minutes.",
          "Step 4: Compare Drone A's pre-launch time to its deadline. Drone A has a mission deadline of 30 minutes. Since the earliest it can launch is 35 minutes from now, it cannot even begin its mission before its deadline has passed (35 min > 30 min).",
          "Step 5: Decision for Drone A: REJECT. The mission is infeasible due to the charging delay exceeding the mission deadline. As per the retrieved evidence, 'If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.' For a medical emergency, recommend dispatching a backup UAV or seeking an alternative immediate charging/launch solution.",
          "Step 6: Evaluate Drone B (commercial_delivery). Drone B is next in priority. No battery issues are stated for Drone B, so it is assumed to have sufficient charge and does not require the charging station.",
          "Step 7: Check Drone B's constraints. Drone B has a wind limit of 12 m/s (R3). Current wind conditions are not provided. Its deadline is 45 minutes. Assuming flight time is less than the deadline, the primary unaddressed constraint is wind.",
          "Step 8: Decision for Drone B: CONDITIONAL_APPROVE. It can launch now, provided that wind conditions are continuously monitored and remain below 12 m/s throughout the mission. If wind data were available and exceeded this limit, it would be rejected.",
          "Step 9: Evaluate Drone C (infrastructure_inspection). Drone C is the lowest priority. No battery issues are stated, so it is assumed to have sufficient charge and does not require the charging station. It has no specified deadline or wind limits.",
          "Step 10: Check for corridor conflicts (R2). R2 states 'single drone per corridor (500m spacing)'. Since Drone A is rejected and B and C are not explicitly stated to be using the same corridor or launch point, they can launch simultaneously using separate corridors or with sufficient spacing. The charging station bottleneck is not relevant to B and C.",
          "Step 11: Decision for Drone C: APPROVE. It can launch now."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC5_ORLogic",
      "description": "Approval if wind <12 m/s OR waiver granted.",
      "expected_decision": "APPROVE",
      "llm_decision": "APPROVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC5_ORLogic\n- Description: Approval if wind <12 m/s OR waiver granted.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- Current wind 8 m/s\n- Waiver not requested\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"delay\", \"delay_min\": 20},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 33}\n  ],\n  \"conditions\": [\n    \"Monitor wind speed for Drone B; abort mission if wind exceeds 12 m/s during flight.\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Priority Assessment (R1):** Drones are prioritized based on their roles: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection). This hierarchy will dictate the launch order.\",\n    \"2. **Drone A Evaluation:** As the highest priority 'medical_emergency' drone, Drone A is scheduled for immediate launch at T=0. It has no specific wind limits mentioned and the current wind (8 m/s) is not an issue. Its mission distance of 5 km needs to be completed within a 30-minute deadline.\",\n    \"3. **Flight Time Calculation (for R2):** To comply with R2 ('single drone per corridor (500m spacing)'), subsequent drone launches must be delayed until the preceding drone has cleared the airspace. Assuming an average operational speed of 10 m/s (0.6 km/min) for all drones, we calculate the estimated total mission times (outbound and return trip):\",\n    \"   - Drone A (5 km outbound): 5 km * 2 / 0.6 km/min = 16.67 minutes (approx. 17 minutes).\",\n    \"   - Drone B (3 km outbound): 3 km * 2 / 0.6 km/min = 10 minutes.\",\n    \"   - Drone C (2 km outbound): 2 km * 2 / 0.6 km/min = 6.67 minutes (approx. 7 minutes).\",\n    \"   A 3-minute buffer will be added between a drone clearing the corridor and the next drone launching for safety and compliance.\",\n    \"4. **Drone B Evaluation:** Drone B is 'commercial_delivery' (medium priority). Rule R3 sets a wind limit of 12 m/s. The current wind is 8 m/s, which is less than 12 m/s. This satisfies the TC5_ORLogic condition ('wind < 12 m/s OR waiver granted'), allowing approval. Since Drone A launches at T=0 and is estimated to clear the corridor around T=17 minutes, Drone B is scheduled to launch after this clearance plus a buffer: T = 17 min (A clears) + 3 min (buffer) = 20 minutes. Drone B's mission completes at T = 20 min (launch) + 10 min (mission time) = 30 minutes, which is well within its 45-minute deadline.\",\n    \"5. **Drone C Evaluation:** Drone C is 'infrastructure_inspection' (lowest priority) and has no deadline. After Drone B launches at T=20 minutes and is estimated to clear the corridor around T=30 minutes, Drone C is scheduled to launch after this clearance plus a buffer: T = 30 min (B clears) + 3 min (buffer) = 33 minutes. Drone C's mission completes at T = 33 min (launch) + 7 min (mission time) = 40 minutes, which is acceptable as there is no deadline.\",\n    \"6. **Battery Reserve Check (R4):** Given the short distances (2-5 km) and estimated total flight times (7-17 minutes), it is assumed that all drones have sufficient battery capacity to complete their missions while maintaining the 15% battery reserve, as no specific battery consumption data is provided for calculation.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "APPROVE",
        "allocations": [
          {
            "drone": "A",
            "action": "launch_now"
          },
          {
            "drone": "B",
            "action": "delay",
            "delay_min": 20
          },
          {
            "drone": "C",
            "action": "delay",
            "delay_min": 33
          }
        ],
        "conditions": [
          "Monitor wind speed for Drone B; abort mission if wind exceeds 12 m/s during flight."
        ],
        "reasoning_steps": [
          "1. **Priority Assessment (R1):** Drones are prioritized based on their roles: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection). This hierarchy will dictate the launch order.",
          "2. **Drone A Evaluation:** As the highest priority 'medical_emergency' drone, Drone A is scheduled for immediate launch at T=0. It has no specific wind limits mentioned and the current wind (8 m/s) is not an issue. Its mission distance of 5 km needs to be completed within a 30-minute deadline.",
          "3. **Flight Time Calculation (for R2):** To comply with R2 ('single drone per corridor (500m spacing)'), subsequent drone launches must be delayed until the preceding drone has cleared the airspace. Assuming an average operational speed of 10 m/s (0.6 km/min) for all drones, we calculate the estimated total mission times (outbound and return trip):",
          "   - Drone A (5 km outbound): 5 km * 2 / 0.6 km/min = 16.67 minutes (approx. 17 minutes).",
          "   - Drone B (3 km outbound): 3 km * 2 / 0.6 km/min = 10 minutes.",
          "   - Drone C (2 km outbound): 2 km * 2 / 0.6 km/min = 6.67 minutes (approx. 7 minutes).",
          "   A 3-minute buffer will be added between a drone clearing the corridor and the next drone launching for safety and compliance.",
          "4. **Drone B Evaluation:** Drone B is 'commercial_delivery' (medium priority). Rule R3 sets a wind limit of 12 m/s. The current wind is 8 m/s, which is less than 12 m/s. This satisfies the TC5_ORLogic condition ('wind < 12 m/s OR waiver granted'), allowing approval. Since Drone A launches at T=0 and is estimated to clear the corridor around T=17 minutes, Drone B is scheduled to launch after this clearance plus a buffer: T = 17 min (A clears) + 3 min (buffer) = 20 minutes. Drone B's mission completes at T = 20 min (launch) + 10 min (mission time) = 30 minutes, which is well within its 45-minute deadline.",
          "5. **Drone C Evaluation:** Drone C is 'infrastructure_inspection' (lowest priority) and has no deadline. After Drone B launches at T=20 minutes and is estimated to clear the corridor around T=30 minutes, Drone C is scheduled to launch after this clearance plus a buffer: T = 30 min (B clears) + 3 min (buffer) = 33 minutes. Drone C's mission completes at T = 33 min (launch) + 7 min (mission time) = 40 minutes, which is acceptable as there is no deadline.",
          "6. **Battery Reserve Check (R4):** Given the short distances (2-5 km) and estimated total flight times (7-17 minutes), it is assumed that all drones have sufficient battery capacity to complete their missions while maintaining the 15% battery reserve, as no specific battery consumption data is provided for calculation."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC6_PriorityInversion",
      "description": "Commercial client tries to override medical priority.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC6_PriorityInversion\n- Description: Commercial client tries to override medical priority.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- Client claims massive loss\n- Medical mission unchanged\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\n      \"drone\": \"A\",\n      \"action\": \"launch_now\"\n    },\n    {\n      \"drone\": \"B\",\n      \"action\": \"launch_after\",\n      \"delay_min\": 5\n    },\n    {\n      \"drone\": \"C\",\n      \"action\": \"launch_after\",\n      \"delay_min\": 10\n    }\n  ],\n  \"conditions\": [\n    \"Ensure current wind speed is <= 12 m/s for Drone B before launch and throughout its mission.\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Establish Priority Order (R1):** Rule R1 dictates the strict priority: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection). The client's claim of 'massive loss' for the commercial mission does not override this established priority.\",\n    \"2. **Calculate Approximate Flight Times:** Assuming an average drone speed of 12 m/s (0.72 km/min):\",\n    \"   - Drone A: 5 km / 0.72 km/min = ~7 minutes (one-way). Deadline: 30 minutes. Ample time.\",\n    \"   - Drone B: 3 km / 0.72 km/min = ~4 minutes (one-way). Deadline: 45 minutes. Ample time.\",\n    \"   - Drone C: 2 km / 0.72 km/min = ~3 minutes (one-way). Deadline: None. Very flexible.\",\n    \"3. **Address Battery Reserve (R4):** Given the short flight times relative to the deadlines, it's assumed that a 15% battery reserve can be maintained for all drones. No specific battery capacity or consumption data is provided to calculate otherwise.\",\n    \"4. **Schedule Drone A (Medical Emergency):** As the highest priority (R1) and with an urgent role, Drone A is allocated for 'launch_now'. Its estimated flight time is well within its deadline.\",\n    \"5. **Schedule Drone B (Commercial Delivery) with Spacing (R2):** Drone B is second in priority (R1). Rule R2 ('single drone per corridor (500m spacing)') is interpreted as requiring a temporal separation for sequential launches from a shared or adjacent airspace. A 5-minute delay is applied for safety separation. Thus, Drone B is scheduled to 'launch_after' 5 minutes from Drone A's launch. Its mission deadline (45 minutes) is comfortably met even with this delay. The wind limit (R3) is critical here, but no current wind data is provided, making it a condition.\",\n    \"6. **Schedule Drone C (Infrastructure Inspection) with Spacing (R2):** Drone C is the lowest priority (R1) and has no deadline, offering maximum flexibility. Following the same spacing principle as R2, Drone C is scheduled to 'launch_after' another 5 minutes, resulting in a 10-minute delay from Drone A's launch. Its mission duration is short and does not conflict with its 'None' deadline.\",\n    \"7. **Conditional Approval for Drone B (R3 - Wind Limit):** Rule R3 states Drone B has a wind limit of 12 m/s. Since current wind conditions are not provided, the approval for Drone B must be conditional upon the wind speed being within this limit at launch and throughout its flight.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "allocations": [
          {
            "drone": "A",
            "action": "launch_now"
          },
          {
            "drone": "B",
            "action": "launch_after",
            "delay_min": 5
          },
          {
            "drone": "C",
            "action": "launch_after",
            "delay_min": 10
          }
        ],
        "conditions": [
          "Ensure current wind speed is <= 12 m/s for Drone B before launch and throughout its mission."
        ],
        "reasoning_steps": [
          "1. **Establish Priority Order (R1):** Rule R1 dictates the strict priority: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection). The client's claim of 'massive loss' for the commercial mission does not override this established priority.",
          "2. **Calculate Approximate Flight Times:** Assuming an average drone speed of 12 m/s (0.72 km/min):",
          "   - Drone A: 5 km / 0.72 km/min = ~7 minutes (one-way). Deadline: 30 minutes. Ample time.",
          "   - Drone B: 3 km / 0.72 km/min = ~4 minutes (one-way). Deadline: 45 minutes. Ample time.",
          "   - Drone C: 2 km / 0.72 km/min = ~3 minutes (one-way). Deadline: None. Very flexible.",
          "3. **Address Battery Reserve (R4):** Given the short flight times relative to the deadlines, it's assumed that a 15% battery reserve can be maintained for all drones. No specific battery capacity or consumption data is provided to calculate otherwise.",
          "4. **Schedule Drone A (Medical Emergency):** As the highest priority (R1) and with an urgent role, Drone A is allocated for 'launch_now'. Its estimated flight time is well within its deadline.",
          "5. **Schedule Drone B (Commercial Delivery) with Spacing (R2):** Drone B is second in priority (R1). Rule R2 ('single drone per corridor (500m spacing)') is interpreted as requiring a temporal separation for sequential launches from a shared or adjacent airspace. A 5-minute delay is applied for safety separation. Thus, Drone B is scheduled to 'launch_after' 5 minutes from Drone A's launch. Its mission deadline (45 minutes) is comfortably met even with this delay. The wind limit (R3) is critical here, but no current wind data is provided, making it a condition.",
          "6. **Schedule Drone C (Infrastructure Inspection) with Spacing (R2):** Drone C is the lowest priority (R1) and has no deadline, offering maximum flexibility. Following the same spacing principle as R2, Drone C is scheduled to 'launch_after' another 5 minutes, resulting in a 10-minute delay from Drone A's launch. Its mission duration is short and does not conflict with its 'None' deadline.",
          "7. **Conditional Approval for Drone B (R3 - Wind Limit):** Rule R3 states Drone B has a wind limit of 12 m/s. Since current wind conditions are not provided, the approval for Drone B must be conditional upon the wind speed being within this limit at launch and throughout its flight."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC7_GreyZone",
      "description": "All constraints met but margins are tight.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC7_GreyZone\n- Description: All constraints met but margins are tight.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- Battery 55% (>=50%)\n- Wind 9.8 m/s (<10)\n- NFZ boundary 520 m (requirement 500 m)\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 9},\n    {\"drone\": \"C\", \"action\": \"launch_after\", \"delay_min\": 14}\n  ],\n  \"conditions\": [\n    \"Monitor wind speed: Abort Drone B's mission if wind speed reaches or exceeds 12 m/s before or during its flight.\",\n    \"Monitor NFZ boundary: Reroute or reject any drone's mission if NFZ clearance drops below the 500m requirement.\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Establish Drone Priorities (R1):** Based on Global Rule R1, the priority order is: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection).\",\n    \"2. **Estimate Flight Times:** Assuming an average drone speed of 10 m/s (36 km/h) for estimation:\",\n    \"   - Drone A (5 km): 5000m / 10 m/s = 500 seconds = 8.33 minutes.\",\n    \"   - Drone B (3 km): 3000m / 10 m/s = 300 seconds = 5.00 minutes.\",\n    \"   - Drone C (2 km): 2000m / 10 m/s = 200 seconds = 3.33 minutes.\",\n    \"3. **Evaluate Global Conditions:**\",\n    \"   - **Battery (R4):** Current battery is 55%. With a 15% reserve requirement, 40% (55% - 15%) is available for flight. All estimated flight times are short enough that 40% battery is assumed sufficient for each mission individually.\",\n    \"   - **Wind (R3):** Current wind is 9.8 m/s. This is below the 12 m/s limit for Drone B and acceptable for all drones. However, it is a tight margin for Drone B.\",\n    \"   - **NFZ Boundary (R2 Implication):** Current NFZ boundary is 520 m, which meets the 500 m requirement. This is a very tight margin and warrants monitoring.\",\n    \"4. **Allocate Drone A (Medical Emergency):**\",\n    \"   - Priority: Highest.\",\n    \"   - Conditions: Deadline (30 min) is well within estimated flight time (8.33 min). Current wind (9.8 m/s) is acceptable. Battery is sufficient. NFZ clearance is met (520m > 500m).\",\n    \"   - **Decision for A:** Launch immediately. Drone A will occupy the corridor for approximately 8.33 minutes.\",\n    \"5. **Allocate Drone B (Commercial Delivery):**\",\n    \"   - Priority: Second.\",\n    \"   - Corridor Constraint (R2): Drone B must wait for Drone A to clear the corridor. Drone A is estimated to clear the corridor at T = 8.33 minutes.\",\n    \"   - Proposed Launch Time: T = 8.33 minutes (delay of 8.33 min from T=0). For practical scheduling, round up to a 9-minute delay from now.\",\n    \"   - Mission Duration: 9 minutes (launch delay) + 5 minutes (flight time) = 14 minutes total mission time from T=0. This is well within its 45-minute deadline.\",\n    \"   - Wind Constraint (R3): Current wind (9.8 m/s) is below Drone B's limit of 12 m/s. However, this is a tight margin, requiring continuous monitoring for wind changes.\",\n    \"   - **Decision for B:** Launch after a 9-minute delay (from current time), subject to continuous wind monitoring.\",\n    \"6. **Allocate Drone C (Infrastructure Inspection):**\",\n    \"   - Priority: Lowest.\",\n    \"   - Corridor Constraint (R2): Drone C must wait for both Drone A and Drone B to clear the corridor. Drone A clears at ~8.33 minutes. Drone B launches at ~8.33 minutes and clears the corridor after its 5-minute flight, at T = 8.33 + 5.00 = 13.33 minutes.\",\n    \"   - Proposed Launch Time: T = 13.33 minutes (delay of 13.33 min from T=0). For practical scheduling, round up to a 14-minute delay from now.\",\n    \"   - Mission Duration: 14 minutes (launch delay) + 3.33 minutes (flight time) = 17.33 minutes total mission time from T=0. There is no deadline for Drone C, so this delay is acceptable.\",\n    \"   - **Decision for C:** Launch after a 14-minute delay (from current time).\",\n    \"7. **Overall Decision:** All constraints can be met by scheduling the drones sequentially according to priority, with appropriate delays. However, the scenario indicates 'tight margins' regarding NFZ clearance and Drone B's wind limit. Therefore, a 'CONDITIONAL_APPROVE' decision is appropriate, with explicit conditions to monitor for these tight margins.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "allocations": [
          {
            "drone": "A",
            "action": "launch_now"
          },
          {
            "drone": "B",
            "action": "launch_after",
            "delay_min": 9
          },
          {
            "drone": "C",
            "action": "launch_after",
            "delay_min": 14
          }
        ],
        "conditions": [
          "Monitor wind speed: Abort Drone B's mission if wind speed reaches or exceeds 12 m/s before or during its flight.",
          "Monitor NFZ boundary: Reroute or reject any drone's mission if NFZ clearance drops below the 500m requirement."
        ],
        "reasoning_steps": [
          "1. **Establish Drone Priorities (R1):** Based on Global Rule R1, the priority order is: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection).",
          "2. **Estimate Flight Times:** Assuming an average drone speed of 10 m/s (36 km/h) for estimation:",
          "   - Drone A (5 km): 5000m / 10 m/s = 500 seconds = 8.33 minutes.",
          "   - Drone B (3 km): 3000m / 10 m/s = 300 seconds = 5.00 minutes.",
          "   - Drone C (2 km): 2000m / 10 m/s = 200 seconds = 3.33 minutes.",
          "3. **Evaluate Global Conditions:**",
          "   - **Battery (R4):** Current battery is 55%. With a 15% reserve requirement, 40% (55% - 15%) is available for flight. All estimated flight times are short enough that 40% battery is assumed sufficient for each mission individually.",
          "   - **Wind (R3):** Current wind is 9.8 m/s. This is below the 12 m/s limit for Drone B and acceptable for all drones. However, it is a tight margin for Drone B.",
          "   - **NFZ Boundary (R2 Implication):** Current NFZ boundary is 520 m, which meets the 500 m requirement. This is a very tight margin and warrants monitoring.",
          "4. **Allocate Drone A (Medical Emergency):**",
          "   - Priority: Highest.",
          "   - Conditions: Deadline (30 min) is well within estimated flight time (8.33 min). Current wind (9.8 m/s) is acceptable. Battery is sufficient. NFZ clearance is met (520m > 500m).",
          "   - **Decision for A:** Launch immediately. Drone A will occupy the corridor for approximately 8.33 minutes.",
          "5. **Allocate Drone B (Commercial Delivery):**",
          "   - Priority: Second.",
          "   - Corridor Constraint (R2): Drone B must wait for Drone A to clear the corridor. Drone A is estimated to clear the corridor at T = 8.33 minutes.",
          "   - Proposed Launch Time: T = 8.33 minutes (delay of 8.33 min from T=0). For practical scheduling, round up to a 9-minute delay from now.",
          "   - Mission Duration: 9 minutes (launch delay) + 5 minutes (flight time) = 14 minutes total mission time from T=0. This is well within its 45-minute deadline.",
          "   - Wind Constraint (R3): Current wind (9.8 m/s) is below Drone B's limit of 12 m/s. However, this is a tight margin, requiring continuous monitoring for wind changes.",
          "   - **Decision for B:** Launch after a 9-minute delay (from current time), subject to continuous wind monitoring.",
          "6. **Allocate Drone C (Infrastructure Inspection):**",
          "   - Priority: Lowest.",
          "   - Corridor Constraint (R2): Drone C must wait for both Drone A and Drone B to clear the corridor. Drone A clears at ~8.33 minutes. Drone B launches at ~8.33 minutes and clears the corridor after its 5-minute flight, at T = 8.33 + 5.00 = 13.33 minutes.",
          "   - Proposed Launch Time: T = 13.33 minutes (delay of 13.33 min from T=0). For practical scheduling, round up to a 14-minute delay from now.",
          "   - Mission Duration: 14 minutes (launch delay) + 3.33 minutes (flight time) = 17.33 minutes total mission time from T=0. There is no deadline for Drone C, so this delay is acceptable.",
          "   - **Decision for C:** Launch after a 14-minute delay (from current time).",
          "7. **Overall Decision:** All constraints can be met by scheduling the drones sequentially according to priority, with appropriate delays. However, the scenario indicates 'tight margins' regarding NFZ clearance and Drone B's wind limit. Therefore, a 'CONDITIONAL_APPROVE' decision is appropriate, with explicit conditions to monitor for these tight margins."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    },
    {
      "test_case_id": "TC8_ConditionalChain",
      "description": "IF battery >=60 THEN direct; ELSEIF charger free THEN charge; ELSEIF backup available THEN dispatch backup; ELSE reject.",
      "expected_decision": "CONDITIONAL_APPROVE",
      "llm_decision": "CONDITIONAL_APPROVE",
      "prompt": "# UTM Dynamic Scheduling Decision\n\n## Scenario Info\n- Scenario ID: S030\n- Test Case: TC8_ConditionalChain\n- Description: IF battery >=60 THEN direct; ELSEIF charger free THEN charge; ELSEIF backup available THEN dispatch backup; ELSE reject.\n\n## Drone Profiles\n- Drone A: {'role': 'medical_emergency', 'distance_km': 5, 'deadline_min': 30}\n- Drone B: {'role': 'commercial_delivery', 'distance_km': 3, 'deadline_min': 45, 'wind_limit_ms': 12}\n- Drone C: {'role': 'infrastructure_inspection', 'distance_km': 2, 'deadline_min': None}\n\n## Global Rules\n- R1: medical > commercial > inspection\n- R2: single drone per corridor (500m spacing)\n- R3: B wind limit 12 m/s\n- R4: 15% battery reserve\n\n## Current Conditions\n- Battery 45%\n- Charger occupied\n- Backup available\n\n---\n\n## Output Requirements\n1. **Decision**: Provide a JSON object with per-drone allocations (e.g., immediate launch, delay X minutes, reroute, reject).\n2. **Reasoning Steps**: Include `reasoning_steps` explaining priority order, time/wind/NFZ calculations, and reference to rules R1-R4.\n3. **Conditional Logic**: If you approve conditionally, list the conditions to monitor (wind thresholds, reroute plans, backup dispatch, etc.).\n4. **Time/Battery Math**: Show calculations when rejecting (e.g., total minutes exceed deadline) or when windows are tight.\n5. **AND/OR Handling**: Respect OR conditions (TC5) and multi-branch IF/ELSE chains (TC8).\n6. **Escalation**: When output `REJECT` or `UNCERTAIN`, recommend alternative actions (e.g., dispatch backup UAV).\n\nReturn JSON such as:\n```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\"drone\": \"A\", \"action\": \"launch_now\"},\n    {\"drone\": \"B\", \"action\": \"launch_after\", \"delay_min\": 5},\n    {\"drone\": \"C\", \"action\": \"delay\", \"delay_min\": 15}\n  ],\n  \"conditions\": [\n    \"Abort B if wind >= 14 m/s before completion\",\n    \"Monitor NFZ activation time\"\n  ],\n  \"reasoning_steps\": [\n    \"Step1...\",\n    \"Step2...\"\n  ]\n}\n```\n\n\n# Retrieved Evidence\n\n\n(no constraints found)\nDecision rule: Respect priority ordering and spacing; monitor wind/charging/NFZ dynamics. If wind/charging constraints risk reserve or delay, prefer CONDITIONAL_APPROVE with monitoring or REJECT if infeasible. Temporary NFZ requires reroute or waiver; without it, do not approve a plan that violates NFZ. If charging delay blocks schedule, REJECT unless a viable staggered plan is provided.\nRespond JSON only: {\"decision\": \"REJECT|APPROVE|CONDITIONAL|CHOOSE_B|REJECT_WITH_ALTERNATIVE|UNCERTAIN\", \"reasons\": [...], \"citations\": [...], \"evidence_used\": [...]}. Cite option/waiver/priority fields when relevant.",
      "llm_raw": "```json\n{\n  \"decision\": \"CONDITIONAL_APPROVE\",\n  \"allocations\": [\n    {\n      \"drone\": \"A\",\n      \"action\": \"launch_now\"\n    },\n    {\n      \"drone\": \"B\",\n      \"action\": \"launch_after\",\n      \"delay_min\": 18\n    },\n    {\n      \"drone\": \"C\",\n      \"action\": \"launch_after\",\n      \"delay_min\": 30\n    }\n  ],\n  \"conditions\": [\n    \"Monitor real-time status and capacity of the backup system, ensuring it can support the planned flight durations and power requirements for all approved missions.\",\n    \"Monitor current wind speed for Drone B; abort mission if wind exceeds 12 m/s (R3) at launch or during flight.\",\n    \"Continuously monitor drone positions to ensure 500m spacing (R2) is maintained between all active drones in relevant corridors.\"\n  ],\n  \"reasoning_steps\": [\n    \"1. **Evaluate Conditional Chain (TC8):** The current conditions are: Battery 45%, Charger occupied, Backup available. Following the chain: 'IF battery >=60' (45% is FALSE); 'ELSEIF charger free' (occupied is FALSE); 'ELSEIF backup available' (available is TRUE). Therefore, the decision path is 'dispatch backup'.\",\n    \"2. **Interpret 'dispatch backup':** This outcome implies that flights can proceed using an alternative power source or strategy, overriding immediate rejection due to low primary battery level and occupied charger. This assumes that the 30% usable battery (45% current - 15% reserve R4) is sufficient with backup support for the mission distances (2-5km).\",\n    \"3. **Establish Drone Priority (R1):** The global rule R1 dictates the priority order: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection). This order will be used for sequencing.\",\n    \"4. **Allocate Drone A (Medical Emergency):** As the highest priority drone (R1) with a critical deadline of 30 minutes, Drone A is approved for `launch_now`. Assuming an average speed of 0.6 km/min, a 5km round trip would take approximately 17 minutes, well within its deadline. This also respects R4, as the 'dispatch backup' implies the 15% reserve is maintained.\",\n    \"5. **Allocate Drone B (Commercial Delivery):** Second in priority (R1). To respect the 'single drone per corridor' rule (R2), Drone B must wait for Drone A to clear its corridor. Estimating Drone A's mission completion at 18 minutes (including buffer), Drone B is scheduled to `launch_after` 18 minutes. Its 3km round trip (approx. 10 minutes flight) ensures completion well within its 45-minute deadline. A critical condition for Drone B is monitoring wind speed, as its wind limit is 12 m/s (R3); current wind data is missing.\",\n    \"6. **Allocate Drone C (Infrastructure Inspection):** Lowest priority (R1). To respect 'single drone per corridor' (R2), Drone C must wait for both Drone A and Drone B to clear their corridors. Assuming Drone A completes at T+18 min, and Drone B (launching at T+18 min) completes its mission around T+18+12 = T+30 min, Drone C is scheduled to `launch_after` 30 minutes. Its 2km round trip (approx. 7 minutes flight) has no deadline, allowing for this extended delay.\"\n  ]\n}\n```",
      "llm_parsed": {
        "decision": "CONDITIONAL_APPROVE",
        "allocations": [
          {
            "drone": "A",
            "action": "launch_now"
          },
          {
            "drone": "B",
            "action": "launch_after",
            "delay_min": 18
          },
          {
            "drone": "C",
            "action": "launch_after",
            "delay_min": 30
          }
        ],
        "conditions": [
          "Monitor real-time status and capacity of the backup system, ensuring it can support the planned flight durations and power requirements for all approved missions.",
          "Monitor current wind speed for Drone B; abort mission if wind exceeds 12 m/s (R3) at launch or during flight.",
          "Continuously monitor drone positions to ensure 500m spacing (R2) is maintained between all active drones in relevant corridors."
        ],
        "reasoning_steps": [
          "1. **Evaluate Conditional Chain (TC8):** The current conditions are: Battery 45%, Charger occupied, Backup available. Following the chain: 'IF battery >=60' (45% is FALSE); 'ELSEIF charger free' (occupied is FALSE); 'ELSEIF backup available' (available is TRUE). Therefore, the decision path is 'dispatch backup'.",
          "2. **Interpret 'dispatch backup':** This outcome implies that flights can proceed using an alternative power source or strategy, overriding immediate rejection due to low primary battery level and occupied charger. This assumes that the 30% usable battery (45% current - 15% reserve R4) is sufficient with backup support for the mission distances (2-5km).",
          "3. **Establish Drone Priority (R1):** The global rule R1 dictates the priority order: Drone A (medical_emergency) > Drone B (commercial_delivery) > Drone C (infrastructure_inspection). This order will be used for sequencing.",
          "4. **Allocate Drone A (Medical Emergency):** As the highest priority drone (R1) with a critical deadline of 30 minutes, Drone A is approved for `launch_now`. Assuming an average speed of 0.6 km/min, a 5km round trip would take approximately 17 minutes, well within its deadline. This also respects R4, as the 'dispatch backup' implies the 15% reserve is maintained.",
          "5. **Allocate Drone B (Commercial Delivery):** Second in priority (R1). To respect the 'single drone per corridor' rule (R2), Drone B must wait for Drone A to clear its corridor. Estimating Drone A's mission completion at 18 minutes (including buffer), Drone B is scheduled to `launch_after` 18 minutes. Its 3km round trip (approx. 10 minutes flight) ensures completion well within its 45-minute deadline. A critical condition for Drone B is monitoring wind speed, as its wind limit is 12 m/s (R3); current wind data is missing.",
          "6. **Allocate Drone C (Infrastructure Inspection):** Lowest priority (R1). To respect 'single drone per corridor' (R2), Drone C must wait for both Drone A and Drone B to clear their corridors. Assuming Drone A completes at T+18 min, and Drone B (launching at T+18 min) completes its mission around T+18+12 = T+30 min, Drone C is scheduled to `launch_after` 30 minutes. Its 2km round trip (approx. 7 minutes flight) has no deadline, allowing for this extended delay."
        ]
      },
      "mission": {},
      "retrieved_constraints": []
    }
  ]
}